<!doctype html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBTC Library Ai</title>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="/_sdk/data_sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        html {
            height: 100%;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            margin: 20px;
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
                margin: 10px;
                border-radius: 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                width: 100%;
                padding: 15px;
                margin: 0;
                border-radius: 0;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            color: #667eea;
            margin: 0 0 10px 0;
            font-size: 32px;
        }

        .header p {
            color: #666;
            margin: 0;
            font-size: 16px;
        }

        .admin-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: #764ba2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .admin-toggle:hover {
            background: #653a8a;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .header p {
                font-size: 14px;
            }

            .admin-toggle {
                position: static;
                display: block;
                margin: 15px auto 0;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 20px;
            }

            .header p {
                font-size: 13px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-box h2 {
            color: #667eea;
            margin: 0 0 20px 0;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .api-setup {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .api-setup h3 {
            margin: 0 0 15px 0;
            color: #667eea;
            font-size: 18px;
        }

        .search-section {
            margin-bottom: 25px;
        }

        .search-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .search-controls {
                flex-direction: column;
            }

            .search-input {
                width: 100%;
            }
        }

        .search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 15px;
            }
        }

        @media (max-width: 480px) {
            .btn {
                padding: 10px 15px;
                font-size: 14px;
            }
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-voice {
            background: #764ba2;
            color: white;
        }

        .btn-voice:hover {
            background: #653a8a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        .btn-voice.listening {
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }

        .status-message.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        .status-message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

        .status-message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .results-section {
            margin-top: 25px;
        }

        .results-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .book-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .book-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .book-call-number {
            font-size: 14px;
            color: #764ba2;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .book-title {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .book-info {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .book-info-item {
            font-size: 14px;
            color: #666;
        }

        .book-info-item strong {
            color: #333;
        }

        .book-availability {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 10px;
        }

        .book-availability.available {
            background: #d4edda;
            color: #155724;
        }

        .book-availability.limited {
            background: #fff3cd;
            color: #856404;
        }

        .book-availability.unavailable {
            background: #f8d7da;
            color: #721c24;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .admin-header {
            background: #764ba2;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .admin-header h2 {
            margin: 0;
        }

        .book-management {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .book-management h3 {
            color: #667eea;
            margin: 0 0 15px 0;
        }

        .upload-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-bottom: 15px;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: block;
            padding: 15px;
            background: #f8f9ff;
            border: 2px dashed #667eea;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background: #e8ebff;
            border-color: #5568d3;
        }

        .book-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .admin-book-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .book-details {
            flex: 1;
            min-width: 200px;
        }

        .book-actions {
            display: flex;
            gap: 10px;
        }

        .stats-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
        }

        .stats-section h3 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 18px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .stat-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
        }

        .stat-list li {
            padding: 8px;
            background: #f8f9ff;
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 14px;
        }

        .top-books-grid {
            display: grid;
            gap: 15px;
        }

        .top-book-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .top-book-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .book-rank {
            font-size: 36px;
            font-weight: 900;
            color: #667eea;
            min-width: 50px;
            text-align: center;
        }

        .book-rank.gold {
            color: #FFD700;
        }

        .book-rank.silver {
            color: #C0C0C0;
        }

        .book-rank.bronze {
            color: #CD7F32;
        }

        .book-info-content {
            flex: 1;
        }

        .book-info-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .book-info-meta {
            font-size: 14px;
            color: #666;
        }

        .book-borrow-count {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 700;
            text-align: center;
            min-width: 80px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        @media (max-width: 768px) {
            .categories-grid {
                grid-template-columns: 1fr;
            }
        }

        .category-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #764ba2;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.3);
        }

        .category-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .category-name {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .category-count {
            font-size: 24px;
            font-weight: 900;
            color: #764ba2;
        }

        .category-label {
            font-size: 12px;
            color: #999;
        }

        .search-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .search-tag {
            background: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 15px;
            color: #333;
            border: 2px solid #27ae60;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-tag:hover {
            background: #27ae60;
            color: white;
            transform: scale(1.05);
        }

        .search-tag-count {
            background: #27ae60;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 700;
        }

        .search-tag:hover .search-tag-count {
            background: white;
            color: #27ae60;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
            background: white;
            border-radius: 12px;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .ai-chat-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
        }

        .ai-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .ai-chat-header h3 {
            margin: 0;
            color: #667eea;
            font-size: 20px;
        }

        .ai-chat-messages {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 8px;
        }

        .ai-message,
        .user-message {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            flex-direction: row-reverse;
        }

        .ai-avatar,
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .ai-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .user-avatar {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .ai-message-content,
        .user-message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user-message-content {
            background: #27ae60;
            color: white;
        }

        .ai-typing {
            display: flex;
            gap: 5px;
            padding: 12px 16px;
        }

        .ai-typing span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite;
        }

        .ai-typing span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .ai-typing span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }
        }

        .ai-chat-input-section {
            display: flex;
            gap: 10px;
        }

        .ai-chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .ai-chat-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .ai-book-result {
            background: #f8f9ff;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid #667eea;
        }

        .ai-book-title {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .ai-book-info {
            font-size: 13px;
            color: #666;
            margin-bottom: 3px;
        }

        .ai-speaking {
            display: inline-block;
            padding: 5px 12px;
            background: #27ae60;
            color: white;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 8px;
            animation: pulse 1.5s infinite;
        }

        .admin-menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .admin-menu-grid {
                grid-template-columns: 1fr;
            }
        }

        .admin-menu-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-top: 5px solid #667eea;
        }

        .admin-menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .admin-menu-card:nth-child(2) {
            border-top-color: #764ba2;
        }

        .admin-menu-card:nth-child(2):hover {
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.3);
        }

        .admin-menu-card:nth-child(3) {
            border-top-color: #27ae60;
        }

        .admin-menu-card:nth-child(3):hover {
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .menu-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }

        .menu-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .menu-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .menu-count {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 8px;
        }

        .admin-page {
            display: none;
        }

        .admin-page.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .admin-search-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .admin-search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .admin-search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .news-slider {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .news-slider h3 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 18px;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .news-grid {
                grid-template-columns: 1fr;
            }
        }

        .news-slide {
            display: none;
            animation: fadeIn 0.5s;
        }

        .news-slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .news-card-item {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid #e8ebff;
        }

        .news-card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .news-image {
            width: 100%;
            height: auto;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 12px;
            background: white;
        }

        @media (max-width: 768px) {
            .news-image {
                max-height: 200px;
            }
        }

        @media (max-width: 480px) {
            .news-image {
                max-height: 150px;
            }
        }

        .news-title {
            font-size: 16px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .news-content {
            color: #333;
            line-height: 1.6;
            font-size: 14px;
        }

        .news-indicators {
            display: none;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .news-indicators {
                display: flex;
            }
        }

        .news-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: background 0.3s;
        }

        .news-indicator.active {
            background: #667eea;
        }

        .image-preview {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
        }

        .news-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .news-thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .news-details {
            flex: 1;
        }

        .news-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked+.toggle-slider {
            background-color: #27ae60;
        }

        input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
    <style>
        @view-transition {
            navigation: auto;
        }
    </style>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>

<body>
    <div class="container"><!-- User View -->
        <div id="user-view">
            <div class="header">
                <h1 id="system-title">PBTC Library Ai</h1>
                <p id="welcome-message">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞ AIüîç</p><button class="admin-toggle"
                    id="admin-toggle">üë§ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
            </div><!-- News Slider -->
            <div class="news-slider" id="news-slider" style="display: none;">
                <h3>üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h3>
                <div id="news-slides-container"></div>
                <div class="news-indicators" id="news-indicators"></div>
            </div>
            <div class="api-setup">
                <h3>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h3>
                <div
                    style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;">
                    <span id="connection-status">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
                </div>
            </div>
            <div class="search-section">
                <div class="search-controls"><input type="text" class="search-input" id="search-input"
                        placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô AI, Python, ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û..."> <button class="btn btn-voice"
                        id="voice-btn"> <span>üéôÔ∏è</span> <span id="voice-text">‡∏û‡∏π‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span> </button> <button
                        class="btn btn-primary" id="search-btn"> <span>üîç</span> <span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span> </button> <button
                        class="btn btn-success" id="ai-chat-btn"> <span>ü§ñ</span> <span>AI ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span> </button>
                </div>
                <div class="status-message" id="status-message"></div>
            </div><!-- AI Chat Section -->
            <div class="ai-chat-section" id="ai-chat-section" style="display: none;">
                <div class="ai-chat-header">
                    <h3>ü§ñ AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h3><button class="btn btn-secondary" id="close-ai-chat"
                        style="padding: 8px 15px; font-size: 14px;">‚úï ‡∏õ‡∏¥‡∏î</button>
                </div>
                <div class="ai-chat-messages" id="ai-chat-messages">
                    <div class="ai-message">
                        <div class="ai-avatar">
                            ü§ñ
                        </div>
                        <div class="ai-message-content">
                            ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞! ‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠ AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ üìö<br><br>
                            ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô:<br><br>
                            üí¨ <strong>‡∏ñ‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ:</strong><br>
                            ‚Ä¢ "‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö......." <br>
                            ‚Ä¢ "Python"<br><br>
                            üí¨ <strong>‡∏ñ‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong><br>
                            ‚Ä¢ "‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö............."<br>
                            ‚Ä¢ "‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö......"<br>
                            ‚Ä¢ "‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏î‡πâ‡∏≤‡∏ô......"<br>
                            ‚Ä¢ "‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö....."<br>
                            ‚Ä¢ "‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö......"<br><br>
                            üí¨ <strong>‡∏ñ‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á:</strong><br>
                            ‚Ä¢ "‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á"<br>
                            ‚Ä¢ "‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠"<br>
                            ‚Ä¢ "‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á..."<br><br>
                            ‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏â‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏™‡∏°‡∏≠! üòä
                        </div>
                    </div>
                </div>
                <div class="ai-chat-input-section"><input type="text" class="ai-chat-input" id="ai-chat-input"
                        placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡πÑ‡∏°‡∏Ñ‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö AI..."> <button class="btn btn-voice"
                        id="ai-voice-btn"> <span>üéôÔ∏è</span> </button> <button class="btn btn-primary" id="ai-send-btn">
                        <span>üì§</span> </button>
                </div>
            </div>
            <div class="results-section" id="results-section" style="display: none;">
                <h2>üìö ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2>
                <div id="results-container"></div>
            </div>
            <div class="stats-section">
                <h3>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3><!-- TOP 5 ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î -->
                <div class="top-books-section">
                    <h4
                        style="color: #667eea; margin: 0 0 20px 0; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                        <span>üèÜ</span> <span>TOP 5 ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</span></h4>
                    <div id="most-borrowed-books" class="top-books-grid"></div>
                </div><!-- TOP 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -->
                <div class="top-categories-section" style="margin-top: 30px;">
                    <h4
                        style="color: #764ba2; margin: 0 0 20px 0; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                        <span>üìö</span> <span>TOP 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</span></h4>
                    <div id="most-borrowed-categories" class="categories-grid"></div>
                </div><!-- ‡∏Ñ‡∏≥‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï -->

            </div>
        </div><!-- Admin View -->
        <div id="admin-view" class="admin-section"><!-- Admin Dashboard -->
            <div id="admin-dashboard" class="admin-page">
                <div class="admin-header">
                    <h2>üë®‚Äçüíº ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2><button class="btn btn-secondary" id="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <div class="admin-menu-grid">
                    <div class="admin-menu-card" onclick="showAdminPage('books')">
                        <div class="menu-icon">
                            üìö
                        </div>
                        <div class="menu-title">
                            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
                        </div>
                        <div class="menu-desc">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </div>
                        <div class="menu-count">
                            <span id="dashboard-book-count">0</span> ‡πÄ‡∏•‡πà‡∏°
                        </div>
                    </div>
                    <div class="admin-menu-card" onclick="showAdminPage('news')">
                        <div class="menu-icon">
                            üì∞
                        </div>
                        <div class="menu-title">
                            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£
                        </div>
                        <div class="menu-desc">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                        </div>
                        <div class="menu-count">
                            <span id="dashboard-news-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                    <div class="admin-menu-card" onclick="showAdminPage('stats')">
                        <div class="menu-icon">
                            üìä
                        </div>
                        <div class="menu-title">
                            ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°
                        </div>
                        <div class="menu-desc">
                            ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
                        </div>
                        <div class="menu-count">
                            ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                        </div>
                    </div>
                </div>
            </div><!-- Books Management Page -->
            <div id="admin-books-page" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h2>üìö ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;"><button class="btn btn-success"
                            id="add-book-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <button class="btn btn-secondary"
                            onclick="showAdminPage('dashboard')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                    </div>
                </div>
                <div class="book-management">
                    <h3>üì§ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel</h3>
                    <div class="upload-section">
                        <div class="file-input-wrapper"><input type="file" id="excel-file" accept=".xlsx, .xls"> <label
                                class="file-input-label" for="excel-file"> üìÅ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel<br><small
                                    style="color: #999;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .xlsx ‡πÅ‡∏•‡∏∞ .xls</small> </label>
                        </div><button class="btn btn-primary" id="upload-btn" style="width: 100%;"> <span>üì§</span>
                            <span>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button>
                    </div>
                </div>
                <div class="book-management">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                        <h3 style="margin: 0;">üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<span id="book-count">0</span> ‡πÄ‡∏•‡πà‡∏°)</h3>
                        <div style="display: flex; gap: 10px; align-items: center;"><select id="sort-books"
                                class="admin-search-input" style="width: auto; padding: 10px;">
                                <option value="title">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠</option>
                                <option value="borrowed">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏¢‡∏∑‡∏°</option>
                                <option value="available">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</option>
                                <option value="category">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î</option>
                            </select>
                        </div>
                    </div>
                    <div class="admin-search-section"><input type="text" class="admin-search-input"
                            id="admin-search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á, ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å, ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á, ‡∏´‡∏°‡∏ß‡∏î)">
                    </div>
                    <div class="book-list" id="admin-book-list">
                        <div class="loading">
                            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                        </div>
                    </div>
                </div>
            </div><!-- News Management Page -->
            <div id="admin-news-page" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h2>üì∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;"><button class="btn btn-primary"
                            id="add-news-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button> <button class="btn btn-secondary"
                            onclick="showAdminPage('dashboard')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                    </div>
                </div>
                <div class="book-management">
                    <h3>üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<span id="news-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
                    <div class="book-list" id="admin-news-list">
                        <div class="loading">
                            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                        </div>
                    </div>
                </div>
            </div><!-- Stats Page -->
            <div id="admin-stats-page" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h2><button class="btn btn-secondary" onclick="showAdminPage('dashboard')">‚Üê
                        ‡∏Å‡∏•‡∏±‡∏ö</button>
                </div>
                <div class="stats-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-books">
                                0
                            </div>
                            <div class="stat-label">
                                ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-borrowed">
                                0
                            </div>
                            <div class="stat-label">
                                ‡∏¢‡∏∑‡∏°‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-available">
                                0
                            </div>
                            <div class="stat-label">
                                ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-box">
            <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
            <form id="login-form">
                <div class="form-group"><label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label> <input type="text" id="username"
                        required>
                </div>
                <div class="form-group"><label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="password"
                        required>
                </div>
                <div class="form-buttons"><button type="submit" class="btn btn-primary"
                        style="flex: 1;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button> <button type="button" class="btn btn-secondary"
                        id="cancel-login" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div><!-- Add Book Modal -->
    <div class="modal" id="add-book-modal">
        <div class="modal-box">
            <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="add-book-form">
                <div class="form-group"><label for="book-title">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á *</label> <input type="text" id="book-title"
                        required>
                </div>
                <div class="form-group"><label for="book-author">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text"
                        id="book-author" required>
                </div>
                <div class="form-group"><label for="book-category">‡∏´‡∏°‡∏ß‡∏î *</label> <input type="text" id="book-category"
                        required>
                </div>
                <div class="form-group"><label for="book-call-number">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text"
                        id="book-call-number" required>
                </div>
                <div class="form-group"><label for="book-abstract">‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠</label> <textarea
                        id="book-abstract"></textarea>
                </div>
                <div class="form-group"><label for="book-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="number"
                        id="book-quantity" min="1" value="1" required>
                </div>
                <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;">
                        <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary"
                        id="cancel-add-book" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div><!-- Edit Book Modal -->
    <div class="modal" id="edit-book-modal">
        <div class="modal-box">
            <h2>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
            <form id="edit-book-form"><input type="hidden" id="edit-book-id">
                <div class="form-group"><label for="edit-book-title">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á *</label> <input type="text"
                        id="edit-book-title" required>
                </div>
                <div class="form-group"><label for="edit-book-author">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text"
                        id="edit-book-author" required>
                </div>
                <div class="form-group"><label for="edit-book-category">‡∏´‡∏°‡∏ß‡∏î *</label> <input type="text"
                        id="edit-book-category" required>
                </div>
                <div class="form-group"><label for="edit-book-call-number">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text"
                        id="edit-book-call-number" required>
                </div>
                <div class="form-group"><label for="edit-book-abstract">‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠</label> <textarea
                        id="edit-book-abstract"></textarea>
                </div>
                <div class="form-group"><label for="edit-book-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="number"
                        id="edit-book-quantity" min="0" required>
                </div>
                <div class="form-group"><label for="edit-book-borrowed">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÑ‡∏õ</label> <input type="number"
                        id="edit-book-borrowed" min="0" value="0">
                </div>
                <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;">
                        <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary"
                        id="cancel-edit-book" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div><!-- Add News Modal -->
    <div class="modal" id="add-news-modal">
        <div class="modal-box">
            <h2>üì∞ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="add-news-form">
                <div class="form-group"><label for="news-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß *</label> <input type="text" id="news-title"
                        required>
                </div>
                <div class="form-group"><label for="news-content">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß *</label> <textarea id="news-content"
                        required style="min-height: 120px;"></textarea>
                </div>
                <div class="form-group"><label for="news-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡πà‡∏≤‡∏ß (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏ô‡∏≤‡∏î 400x200 px) *</label> <input
                        type="file" id="news-image" accept="image/*" required> <img id="news-image-preview"
                        class="image-preview" style="display: none;">
                </div>
                <div class="form-group"><label style="display: flex; align-items: center; gap: 10px;"> <input
                            type="checkbox" id="news-visible" checked> <span>‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span> </label>
                </div>
                <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;">
                        <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary"
                        id="cancel-add-news" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div><!-- Edit News Modal -->
    <div class="modal" id="edit-news-modal">
        <div class="modal-box">
            <h2>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h2>
            <form id="edit-news-form"><input type="hidden" id="edit-news-id">
                <div class="form-group"><label for="edit-news-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß *</label> <input type="text"
                        id="edit-news-title" required>
                </div>
                <div class="form-group"><label for="edit-news-content">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß *</label> <textarea
                        id="edit-news-content" required style="min-height: 120px;"></textarea>
                </div>
                <div class="form-group"><label for="edit-news-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡πà‡∏≤‡∏ß (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏ô‡∏≤‡∏î 400x200 px)</label> <input
                        type="file" id="edit-news-image" accept="image/*"> <img id="edit-news-image-preview"
                        class="image-preview" style="display: none;">
                </div>
                <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;">
                        <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary"
                        id="cancel-edit-news" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBZTETR4YN1DQFww57n9h0UV0XT7IBUGLY",
            authDomain: "ai-library-assistant-3d45e.firebaseapp.com",
            projectId: "ai-library-assistant-3d45e",
            storageBucket: "ai-library-assistant-3d45e.firebasestorage.app",
            messagingSenderId: "266038692063",
            appId: "1:266038692063:web:8e5522d9a676e88f24816a",
            measurementId: "G-5W5LJQZVGH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Book database
        let booksDatabase = [];
        let newsDatabase = [];
        let allData = [];
        let isAdmin = false;
        let currentEditBookId = null;
        let currentEditNewsId = null;
        let newsSliderInterval = null;
        let currentSlideIndex = 0;

        // Configuration
        const defaultConfig = {
            system_title: "üîç ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞",
            welcome_message: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞ AI"
        };

        let isListening = false;
        let recognition = null;
        let aiRecognition = null;
        let isAiListening = false;
        let isSpeaking = false;
        let speechSynthesis = window.speechSynthesis;
        let voicesLoaded = false;

        // Initialize Speech Recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'th-TH';
            recognition.continuous = false;
            recognition.interimResults = false;

            aiRecognition = new SpeechRecognition();
            aiRecognition.lang = 'th-TH';
            aiRecognition.continuous = false;
            aiRecognition.interimResults = false;
        }

        // Load voices for Text-to-Speech (important for mobile)
        if (speechSynthesis) {
            // Load voices immediately
            speechSynthesis.getVoices();

            // Listen for voices changed event (important for mobile browsers)
            speechSynthesis.onvoiceschanged = () => {
                voicesLoaded = true;
                console.log('Voices loaded:', speechSynthesis.getVoices().length);
            };

            // Check if voices are already loaded
            setTimeout(() => {
                if (speechSynthesis.getVoices().length > 0) {
                    voicesLoaded = true;
                }
            }, 100);
        }

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                updateStats(data);
            }
        };

        // Initialize SDKs
        async function initializeSdks() {
            const dataResult = await window.dataSdk.init(dataHandler);
            if (!dataResult.isOk) {
                console.error("Failed to initialize data SDK");
            }

            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('system-title').textContent = config.system_title || defaultConfig.system_title;
                        document.getElementById('welcome-message').textContent = config.welcome_message || defaultConfig.welcome_message;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["system_title", config.system_title || defaultConfig.system_title],
                        ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
                    ])
                });
            }
        }

        // Load books from Firebase
        async function loadBooksFromFirebase() {
            const connectionStatus = document.getElementById('connection-status');
            connectionStatus.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

            try {
                const snapshot = await db.collection('books').get();
                booksDatabase = [];

                snapshot.forEach(doc => {
                    const data = doc.data();
                    booksDatabase.push({
                        id: doc.id,
                        callNumber: data.callNumber || '',
                        title: data.title || '',
                        author: data.author || '',
                        category: data.category || '',
                        abstract: data.abstract || '',
                        quantity: data.quantity || 0,
                        borrowed: data.borrowed || 0,
                        available: (data.quantity || 0) - (data.borrowed || 0),
                        keywords: [
                            ...(data.callNumber || '').split(' '),
                            ...(data.title || '').split(' '),
                            ...(data.author || '').split(' '),
                            ...(data.category || '').split(' '),
                            ...(data.abstract || '').split(' ')
                        ].filter(word => word.length > 1)
                    });
                });

                connectionStatus.textContent = `‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${booksDatabase.length} ‡πÄ‡∏•‡πà‡∏°`;
                showStatus(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${booksDatabase.length} ‡πÄ‡∏•‡πà‡∏°`, 'success');

                if (isAdmin) {
                    loadAdminData();
                }

                updateUserStats();

                return true;
            } catch (error) {
                console.error('Load error:', error);
                connectionStatus.textContent = `‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`;
                showStatus(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`, 'error');
                return false;
            }
        }

        // Load news from Firebase
        async function loadNewsFromFirebase() {
            try {
                const snapshot = await db.collection('news').orderBy('createdAt', 'desc').get();
                newsDatabase = [];

                snapshot.forEach(doc => {
                    const data = doc.data();
                    newsDatabase.push({
                        id: doc.id,
                        title: data.title || '',
                        content: data.content || '',
                        imageUrl: data.imageUrl || '',
                        visible: data.visible !== false,
                        createdAt: data.createdAt || ''
                    });
                });

                if (isAdmin) {
                    loadAdminNews();
                } else {
                    loadNewsSlider();
                }

                return true;
            } catch (error) {
                console.error('Load news error:', error);
                return false;
            }
        }

        // Load news slider
        function loadNewsSlider() {
            const visibleNews = newsDatabase.filter(n => n.visible);
            const newsSlider = document.getElementById('news-slider');
            const slidesContainer = document.getElementById('news-slides-container');
            const indicatorsContainer = document.getElementById('news-indicators');

            if (visibleNews.length === 0) {
                newsSlider.style.display = 'none';
                return;
            }

            newsSlider.style.display = 'block';
            slidesContainer.innerHTML = '';
            indicatorsContainer.innerHTML = '';

            // Check if mobile
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                // Mobile: Slider mode (1 news at a time)
                visibleNews.forEach((news, index) => {
                    const slide = document.createElement('div');
                    slide.className = `news-slide ${index === 0 ? 'active' : ''}`;
                    slide.innerHTML = `
                        <div class="news-card-item">
                            <img src="${news.imageUrl}" alt="${news.title}" class="news-image" onerror="this.src=''; this.alt='‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ'; this.style.display='none';">
                            <div class="news-title">${news.title}</div>
                            <div class="news-content">${news.content}</div>
                        </div>
                    `;
                    slidesContainer.appendChild(slide);

                    const indicator = document.createElement('div');
                    indicator.className = `news-indicator ${index === 0 ? 'active' : ''}`;
                    indicator.addEventListener('click', () => showSlide(index));
                    indicatorsContainer.appendChild(indicator);
                });

                currentSlideIndex = 0;
                startNewsSlider();
            } else {
                // Desktop: Grid mode (3 columns, all news visible, no slider)
                const newsGrid = document.createElement('div');
                newsGrid.className = 'news-grid';

                visibleNews.forEach((news) => {
                    const newsCard = document.createElement('div');
                    newsCard.className = 'news-card-item';
                    newsCard.innerHTML = `
                        <img src="${news.imageUrl}" alt="${news.title}" class="news-image" onerror="this.src=''; this.alt='‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ'; this.style.display='none';">
                        <div class="news-title">${news.title}</div>
                        <div class="news-content">${news.content}</div>
                    `;
                    newsGrid.appendChild(newsCard);
                });

                slidesContainer.appendChild(newsGrid);

                // Stop slider on desktop
                if (newsSliderInterval) {
                    clearInterval(newsSliderInterval);
                    newsSliderInterval = null;
                }
            }
        }

        // Handle window resize to switch between mobile and desktop modes
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                loadNewsSlider();
            }, 250);
        });

        // Start news slider
        function startNewsSlider() {
            if (newsSliderInterval) {
                clearInterval(newsSliderInterval);
            }

            newsSliderInterval = setInterval(() => {
                const visibleNews = newsDatabase.filter(n => n.visible);
                if (visibleNews.length > 1) {
                    currentSlideIndex = (currentSlideIndex + 1) % visibleNews.length;
                    showSlide(currentSlideIndex);
                }
            }, 5000);
        }

        // Show specific slide
        function showSlide(index) {
            const slides = document.querySelectorAll('.news-slide');
            const indicators = document.querySelectorAll('.news-indicator');

            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });

            indicators.forEach((indicator, i) => {
                indicator.classList.toggle('active', i === index);
            });

            currentSlideIndex = index;
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';

            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // Login functionality
        document.getElementById('admin-toggle').addEventListener('click', () => {
            document.getElementById('login-modal').classList.add('active');
        });

        document.getElementById('cancel-login').addEventListener('click', () => {
            document.getElementById('login-modal').classList.remove('active');
        });

        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'Admin' && password === '1234') {
                isAdmin = true;
                document.getElementById('login-modal').classList.remove('active');
                document.getElementById('user-view').style.display = 'none';
                document.getElementById('admin-view').classList.add('active');
                loadAdminData();
                showStatus('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } else {
                showStatus('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }

            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            isAdmin = false;
            document.getElementById('user-view').style.display = 'block';
            document.getElementById('admin-view').classList.remove('active');
            showStatus('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        });

        // Add book modal
        document.getElementById('add-book-btn').addEventListener('click', () => {
            document.getElementById('add-book-modal').classList.add('active');
        });

        document.getElementById('cancel-add-book').addEventListener('click', () => {
            document.getElementById('add-book-modal').classList.remove('active');
            document.getElementById('add-book-form').reset();
        });

        document.getElementById('add-book-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const bookData = {
                title: document.getElementById('book-title').value.trim(),
                author: document.getElementById('book-author').value.trim(),
                category: document.getElementById('book-category').value.trim(),
                callNumber: document.getElementById('book-call-number').value.trim(),
                abstract: document.getElementById('book-abstract').value.trim(),
                quantity: parseInt(document.getElementById('book-quantity').value) || 0,
                borrowed: 0,
                createdAt: new Date().toISOString()
            };

            try {
                showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                await db.collection('books').add(bookData);
                showStatus('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                document.getElementById('add-book-modal').classList.remove('active');
                document.getElementById('add-book-form').reset();
                await loadBooksFromFirebase();
            } catch (error) {
                console.error('Error adding book:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', 'error');
            }
        });

        // Edit book modal
        document.getElementById('cancel-edit-book').addEventListener('click', () => {
            document.getElementById('edit-book-modal').classList.remove('active');
            document.getElementById('edit-book-form').reset();
            currentEditBookId = null;
        });

        document.getElementById('edit-book-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!currentEditBookId) return;

            const bookData = {
                title: document.getElementById('edit-book-title').value.trim(),
                author: document.getElementById('edit-book-author').value.trim(),
                category: document.getElementById('edit-book-category').value.trim(),
                callNumber: document.getElementById('edit-book-call-number').value.trim(),
                abstract: document.getElementById('edit-book-abstract').value.trim(),
                quantity: parseInt(document.getElementById('edit-book-quantity').value) || 0,
                borrowed: parseInt(document.getElementById('edit-book-borrowed').value) || 0,
                updatedAt: new Date().toISOString()
            };

            try {
                showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                await db.collection('books').doc(currentEditBookId).update(bookData);
                showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                document.getElementById('edit-book-modal').classList.remove('active');
                document.getElementById('edit-book-form').reset();
                currentEditBookId = null;
                await loadBooksFromFirebase();
            } catch (error) {
                console.error('Error updating book:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        });

        // Excel upload
        document.getElementById('upload-btn').addEventListener('click', async () => {
            const fileInput = document.getElementById('excel-file');
            const file = fileInput.files[0];

            if (!file) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel', 'error');
                return;
            }

            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå...', 'info');

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    if (jsonData.length === 0) {
                        showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                        return;
                    }

                    showStatus(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${jsonData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...`, 'info');

                    let successCount = 0;
                    let errorCount = 0;

                    for (const row of jsonData) {
                        try {
                            const bookData = {
                                title: (row['‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á'] || row['title'] || '').toString().trim(),
                                author: (row['‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á'] || row['author'] || '').toString().trim(),
                                category: (row['‡∏´‡∏°‡∏ß‡∏î'] || row['category'] || '').toString().trim(),
                                callNumber: (row['‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'] || row['callNumber'] || '').toString().trim(),
                                abstract: (row['‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠'] || row['abstract'] || '').toString().trim(),
                                quantity: parseInt(row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'] || row['quantity'] || 0),
                                borrowed: 0,
                                createdAt: new Date().toISOString()
                            };

                            if (bookData.title && bookData.callNumber) {
                                await db.collection('books').add(bookData);
                                successCount++;
                            }
                        } catch (error) {
                            console.error('Error adding book:', error);
                            errorCount++;
                        }
                    }

                    showStatus(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£${errorCount > 0 ? `, ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${errorCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` : ''}`, 'success');
                    fileInput.value = '';
                    await loadBooksFromFirebase();

                } catch (error) {
                    console.error('Error processing file:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                }
            };

            reader.readAsArrayBuffer(file);
        });

        // Voice search
        document.getElementById('voice-btn').addEventListener('click', () => {
            if (!recognition) {
                showStatus('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á', 'error');
                return;
            }

            if (isListening) {
                recognition.stop();
                return;
            }

            isListening = true;
            document.getElementById('voice-btn').classList.add('listening');
            document.getElementById('voice-text').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...';
            showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...', 'info');

            recognition.start();

            recognition.onresult = (event) => {
                let transcript = event.results[0][0].transcript;
                // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô
                transcript = separateStuckWords(transcript);
                document.getElementById('search-input').value = transcript;
                showStatus(`‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á: "${transcript}"`, 'success');

                // ‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏°‡∏Ñ‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
                recognition.stop();
                resetVoiceButton();

                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß
                setTimeout(() => {
                    performSearch(transcript, 'voice');
                }, 100);
            };

            recognition.onerror = (event) => {
                console.error('Voice search error:', event.error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á', 'error');
                resetVoiceButton();
            };

            recognition.onend = () => {
                resetVoiceButton();
            };
        });

        function resetVoiceButton() {
            isListening = false;
            document.getElementById('voice-btn').classList.remove('listening');
            document.getElementById('voice-text').textContent = '‡∏û‡∏π‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
        }

        // Text search
        document.getElementById('search-btn').addEventListener('click', () => {
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                performSearch(query, 'text');
            } else {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'error');
            }
        });

        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = e.target.value.trim();
                if (query) {
                    performSearch(query, 'text');
                }
            }
        });

        // Perform search
        async function performSearch(query, method) {
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...', 'info');

            const results = searchBooks(query);
            displayResults(results, query);
            await logSearch(query, results.length, method);
        }

        // Search books
        function searchBooks(query) {
            const queryLower = query.toLowerCase();
            return booksDatabase.filter(book => {
                const callNumberMatch = book.callNumber.toLowerCase().includes(queryLower);
                const titleMatch = book.title.toLowerCase().includes(queryLower);
                const authorMatch = book.author.toLowerCase().includes(queryLower);
                const categoryMatch = book.category.toLowerCase().includes(queryLower);
                const abstractMatch = book.abstract.toLowerCase().includes(queryLower);
                const keywordMatch = book.keywords.some(kw =>
                    kw.toLowerCase().includes(queryLower) ||
                    queryLower.includes(kw.toLowerCase())
                );

                return callNumberMatch || titleMatch || authorMatch || categoryMatch || abstractMatch || keywordMatch;
            });
        }

        // Display results
        function displayResults(results, query) {
            const resultsSection = document.getElementById('results-section');
            const resultsContainer = document.getElementById('results-container');

            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = '';

            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <p>üòî ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${query}"</p>
                        <p>‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô</p>
                    </div>
                `;
                showStatus(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "${query}"`, 'error');
                return;
            }

            results.forEach(book => {
                const bookCard = document.createElement('div');
                bookCard.className = 'ai-book-result';
                bookCard.style.marginBottom = '15px';
                bookCard.innerHTML = `
                    <div class="ai-book-title">üìñ ${book.title}</div>
                    <div class="ai-book-info">üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author}</div>
                    <div class="ai-book-info">üìö ‡∏´‡∏°‡∏ß‡∏î: ${book.category}</div>
                    <div class="ai-book-info">üìç ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠: ${book.callNumber}</div>
                    <div class="ai-book-info" style="color: ${book.available > 0 ? '#27ae60' : '#e74c3c'}; font-weight: 600;">
                        ${book.available > 0 ? `‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${book.available} ‡πÄ‡∏•‡πà‡∏°` : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°'}
                    </div>
                `;
                resultsContainer.appendChild(bookCard);
            });

            showStatus(`‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${results.length} ‡πÄ‡∏•‡πà‡∏°`, 'success');
        }

        // Log search
        async function logSearch(query, resultsCount, method) {
            const logEntry = {
                query: query,
                timestamp: new Date().toISOString(),
                results_count: resultsCount,
                search_method: method
            };

            const result = await window.dataSdk.create(logEntry);
            if (!result.isOk) {
                console.error("Failed to log search");
            }
        }

        // Update stats
        function updateStats(data) {
            const searches = data;

            // Most searched terms
            const termCounts = {};
            searches.forEach(s => {
                if (s.query) {
                    termCounts[s.query] = (termCounts[s.query] || 0) + 1;
                }
            });
            const topTerms = Object.entries(termCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            const termsEl = document.getElementById('most-searched-terms');
            if (topTerms.length > 0) {
                termsEl.innerHTML = topTerms.map(([term, count]) => `
                    <div class="search-tag">
                        <span>${term}</span>
                        <span class="search-tag-count">${count}</span>
                    </div>
                `).join('');
            } else {
                termsEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p></div>';
            }

            updateUserStats();
        }

        // Update user stats
        function updateUserStats() {
            // TOP 5 ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            const topBorrowed = [...booksDatabase]
                .filter(book => book.borrowed > 0)
                .sort((a, b) => b.borrowed - a.borrowed)
                .slice(0, 5);

            const borrowedEl = document.getElementById('most-borrowed-books');
            if (topBorrowed.length > 0) {
                borrowedEl.innerHTML = topBorrowed.map((book, index) => {
                    let rankClass = '';
                    if (index === 0) rankClass = 'gold';
                    else if (index === 1) rankClass = 'silver';
                    else if (index === 2) rankClass = 'bronze';

                    return `
                        <div class="top-book-card">
                            <div class="book-rank ${rankClass}">${index + 1}</div>
                            <div class="book-info-content">
                                <div class="book-info-title">${book.title}</div>
                                <div class="book-info-meta">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author} | ‡∏´‡∏°‡∏ß‡∏î: ${book.category}</div>
                            </div>
                            <div class="book-borrow-count">${book.borrowed} ‡πÄ‡∏•‡πà‡∏°</div>
                        </div>
                    `;
                }).join('');
            } else {
                borrowedEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìö</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p></div>';
            }

            // TOP 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            const categoryCounts = {};
            booksDatabase.forEach(book => {
                if (book.category && book.borrowed > 0) {
                    categoryCounts[book.category] = (categoryCounts[book.category] || 0) + book.borrowed;
                }
            });
            const topCategories = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const categoryIcons = ['üìñ', 'üìö', 'üìï', 'üìó', 'üìò'];
            const categoriesEl = document.getElementById('most-borrowed-categories');
            if (topCategories.length > 0) {
                categoriesEl.innerHTML = topCategories.map(([cat, count], index) => `
                    <div class="category-card">
                        <div class="category-icon">${categoryIcons[index] || 'üìô'}</div>
                        <div class="category-name">${cat}</div>
                        <div class="category-count">${count}</div>
                        <div class="category-label">‡πÄ‡∏•‡πà‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</div>
                    </div>
                `).join('');
            } else {
                categoriesEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìñ</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p></div>';
            }
        }

        // Show admin page
        window.showAdminPage = function (page) {
            document.querySelectorAll('.admin-page').forEach(p => p.style.display = 'none');

            if (page === 'dashboard') {
                document.getElementById('admin-dashboard').style.display = 'block';
                updateDashboardCounts();
            } else if (page === 'books') {
                document.getElementById('admin-books-page').style.display = 'block';
                filterAdminBooks('');
            } else if (page === 'news') {
                document.getElementById('admin-news-page').style.display = 'block';
                loadAdminNews();
            } else if (page === 'stats') {
                document.getElementById('admin-stats-page').style.display = 'block';
                loadAdminStats();
            }
        };

        // Update dashboard counts
        function updateDashboardCounts() {
            document.getElementById('dashboard-book-count').textContent = booksDatabase.length;
            document.getElementById('dashboard-news-count').textContent = newsDatabase.length;
        }

        // Admin functions
        async function loadAdminData() {
            updateDashboardCounts();
            document.getElementById('admin-dashboard').style.display = 'block';
        }

        // Load admin stats
        function loadAdminStats() {
            let totalQuantity = 0;
            let totalBorrowed = 0;
            let totalAvailable = 0;

            booksDatabase.forEach(book => {
                totalQuantity += book.quantity;
                totalBorrowed += book.borrowed;
                totalAvailable += book.available;
            });

            document.getElementById('total-books').textContent = totalQuantity;
            document.getElementById('total-borrowed').textContent = totalBorrowed;
            document.getElementById('total-available').textContent = totalAvailable;
        }

        // Filter admin books
        function filterAdminBooks(query, sortBy = 'title') {
            const adminBookList = document.getElementById('admin-book-list');
            adminBookList.innerHTML = '';

            const queryLower = query.toLowerCase();
            let filteredBooks = query ? booksDatabase.filter(book =>
                book.title.toLowerCase().includes(queryLower) ||
                book.callNumber.toLowerCase().includes(queryLower) ||
                book.author.toLowerCase().includes(queryLower) ||
                book.category.toLowerCase().includes(queryLower)
            ) : [...booksDatabase];

            // Sort books
            if (sortBy === 'title') {
                filteredBooks.sort((a, b) => a.title.localeCompare(b.title, 'th'));
            } else if (sortBy === 'borrowed') {
                filteredBooks.sort((a, b) => b.borrowed - a.borrowed);
            } else if (sortBy === 'available') {
                filteredBooks.sort((a, b) => b.available - a.available);
            } else if (sortBy === 'category') {
                filteredBooks.sort((a, b) => a.category.localeCompare(b.category, 'th'));
            }

            if (filteredBooks.length === 0) {
                adminBookList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìö</div><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p></div>';
                document.getElementById('book-count').textContent = '0';
                return;
            }

            document.getElementById('book-count').textContent = filteredBooks.length;

            filteredBooks.forEach(book => {
                const availabilityColor = book.available > 5 ? '#27ae60' : book.available > 0 ? '#f39c12' : '#e74c3c';

                const card = document.createElement('div');
                card.className = 'admin-book-card';
                card.innerHTML = `
                    <div class="book-details">
                        <div style="font-weight: 700; color: #667eea; margin-bottom: 5px; font-size: 16px;">${book.title}</div>
                        <div style="font-size: 13px; color: #999; margin-bottom: 5px;">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å: ${book.callNumber}</div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                            <span style="margin-right: 15px;">üë§ ${book.author}</span>
                            <span>üìñ ${book.category}</span>
                        </div>
                        <div style="display: flex; gap: 15px; font-size: 14px; font-weight: 600;">
                            <span style="color: #667eea;">üìö ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${book.quantity}</span>
                            <span style="color: #e74c3c;">üì§ ‡∏¢‡∏∑‡∏°: ${book.borrowed}</span>
                            <span style="color: ${availabilityColor};">‚úÖ ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${book.available}</span>
                        </div>
                    </div>
                    <div class="book-actions">
                        <button class="btn btn-primary" onclick="editBook('${book.id}')" style="padding: 10px 18px; font-size: 14px;">
                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button class="btn btn-danger" onclick="deleteBook('${book.id}', '${book.title.replace(/'/g, "\\'")}')" style="padding: 10px 18px; font-size: 14px;">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                `;
                adminBookList.appendChild(card);
            });
        }

        // Load admin news
        function loadAdminNews() {
            const adminNewsList = document.getElementById('admin-news-list');
            adminNewsList.innerHTML = '';

            if (newsDatabase.length === 0) {
                adminNewsList.innerHTML = '<div class="loading">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';
                document.getElementById('news-count').textContent = '0';
                return;
            }

            document.getElementById('news-count').textContent = newsDatabase.length;

            newsDatabase.forEach(news => {
                const card = document.createElement('div');
                card.className = 'news-card';
                card.innerHTML = `
                    <img src="${news.imageUrl}" alt="${news.title}" class="news-thumbnail" onerror="this.src=''; this.alt='‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ'; this.style.display='none';">
                    <div class="news-details">
                        <div style="font-weight: 700; color: #667eea; margin-bottom: 5px;">${news.title}</div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">${news.content.substring(0, 100)}${news.content.length > 100 ? '...' : ''}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 13px; color: #999;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
                            <label class="toggle-switch">
                                <input type="checkbox" ${news.visible ? 'checked' : ''} onchange="toggleNewsVisibility('${news.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="font-size: 13px; color: ${news.visible ? '#27ae60' : '#999'};">${news.visible ? '‡πÅ‡∏™‡∏î‡∏á' : '‡∏ã‡πà‡∏≠‡∏ô'}</span>
                        </div>
                    </div>
                    <div class="news-actions">
                        <button class="btn btn-primary" onclick="editNews('${news.id}')" style="padding: 8px 15px; font-size: 14px;">
                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button class="btn btn-danger" onclick="deleteNews('${news.id}', '${news.title}')" style="padding: 8px 15px; font-size: 14px;">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                `;
                adminNewsList.appendChild(card);
            });
        }

        // Edit book
        window.editBook = function (bookId) {
            const book = booksDatabase.find(b => b.id === bookId);
            if (!book) return;

            currentEditBookId = bookId;
            document.getElementById('edit-book-id').value = bookId;
            document.getElementById('edit-book-title').value = book.title;
            document.getElementById('edit-book-author').value = book.author;
            document.getElementById('edit-book-category').value = book.category;
            document.getElementById('edit-book-call-number').value = book.callNumber;
            document.getElementById('edit-book-abstract').value = book.abstract;
            document.getElementById('edit-book-quantity').value = book.quantity;
            document.getElementById('edit-book-borrowed').value = book.borrowed;

            document.getElementById('edit-book-modal').classList.add('active');
        };

        // Delete book
        window.deleteBook = async function (bookId, bookTitle) {
            const confirmBox = document.createElement('div');
            confirmBox.className = 'modal active';
            confirmBox.innerHTML = `
                <div class="modal-box" style="max-width: 400px;">
                    <h2>‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h2>
                    <p style="text-align: center; margin: 20px 0;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠<br><strong>"${bookTitle}"</strong><br>‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <div class="form-buttons">
                        <button class="btn btn-danger" id="confirm-delete" style="flex: 1;">‡∏•‡∏ö</button>
                        <button class="btn btn-secondary" id="cancel-delete" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmBox);

            document.getElementById('confirm-delete').addEventListener('click', async () => {
                try {
                    showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                    await db.collection('books').doc(bookId).delete();
                    showStatus('‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.body.removeChild(confirmBox);
                    await loadBooksFromFirebase();
                } catch (error) {
                    console.error('Error deleting book:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', 'error');
                }
            });

            document.getElementById('cancel-delete').addEventListener('click', () => {
                document.body.removeChild(confirmBox);
            });
        };

        // Admin search books
        document.getElementById('admin-search-input').addEventListener('input', (e) => {
            const sortBy = document.getElementById('sort-books').value;
            filterAdminBooks(e.target.value, sortBy);
        });

        // Sort books
        document.getElementById('sort-books').addEventListener('change', (e) => {
            const query = document.getElementById('admin-search-input').value;
            filterAdminBooks(query, e.target.value);
        });

        // Add news modal
        document.getElementById('add-news-btn').addEventListener('click', () => {
            document.getElementById('add-news-modal').classList.add('active');
        });

        document.getElementById('cancel-add-news').addEventListener('click', () => {
            document.getElementById('add-news-modal').classList.remove('active');
            document.getElementById('add-news-form').reset();
            document.getElementById('news-image-preview').style.display = 'none';
        });

        // Preview news image
        document.getElementById('news-image').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const preview = document.getElementById('news-image-preview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Add news form
        document.getElementById('add-news-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const file = document.getElementById('news-image').files[0];
            if (!file) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
                return;
            }

            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');

            const reader = new FileReader();
            reader.onload = async (event) => {
                const newsData = {
                    title: document.getElementById('news-title').value.trim(),
                    content: document.getElementById('news-content').value.trim(),
                    imageUrl: event.target.result,
                    visible: document.getElementById('news-visible').checked,
                    createdAt: new Date().toISOString()
                };

                try {
                    await db.collection('news').add(newsData);
                    showStatus('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.getElementById('add-news-modal').classList.remove('active');
                    document.getElementById('add-news-form').reset();
                    document.getElementById('news-image-preview').style.display = 'none';
                    await loadNewsFromFirebase();
                } catch (error) {
                    console.error('Error adding news:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                }
            };
            reader.readAsDataURL(file);
        });

        // Edit news modal
        document.getElementById('cancel-edit-news').addEventListener('click', () => {
            document.getElementById('edit-news-modal').classList.remove('active');
            document.getElementById('edit-news-form').reset();
            document.getElementById('edit-news-image-preview').style.display = 'none';
            currentEditNewsId = null;
        });

        // Preview edit news image
        document.getElementById('edit-news-image').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const preview = document.getElementById('edit-news-image-preview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Edit news form
        document.getElementById('edit-news-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!currentEditNewsId) return;

            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');

            const file = document.getElementById('edit-news-image').files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const newsData = {
                        title: document.getElementById('edit-news-title').value.trim(),
                        content: document.getElementById('edit-news-content').value.trim(),
                        imageUrl: event.target.result,
                        updatedAt: new Date().toISOString()
                    };

                    try {
                        await db.collection('news').doc(currentEditNewsId).update(newsData);
                        showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        document.getElementById('edit-news-modal').classList.remove('active');
                        document.getElementById('edit-news-form').reset();
                        document.getElementById('edit-news-image-preview').style.display = 'none';
                        currentEditNewsId = null;
                        await loadNewsFromFirebase();
                    } catch (error) {
                        console.error('Error updating news:', error);
                        showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                    }
                };
                reader.readAsDataURL(file);
            } else {
                const newsData = {
                    title: document.getElementById('edit-news-title').value.trim(),
                    content: document.getElementById('edit-news-content').value.trim(),
                    updatedAt: new Date().toISOString()
                };

                try {
                    await db.collection('news').doc(currentEditNewsId).update(newsData);
                    showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.getElementById('edit-news-modal').classList.remove('active');
                    document.getElementById('edit-news-form').reset();
                    currentEditNewsId = null;
                    await loadNewsFromFirebase();
                } catch (error) {
                    console.error('Error updating news:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                }
            }
        });

        // Edit news
        window.editNews = function (newsId) {
            const news = newsDatabase.find(n => n.id === newsId);
            if (!news) return;

            currentEditNewsId = newsId;
            document.getElementById('edit-news-title').value = news.title;
            document.getElementById('edit-news-content').value = news.content;

            if (news.imageUrl) {
                const preview = document.getElementById('edit-news-image-preview');
                preview.src = news.imageUrl;
                preview.style.display = 'block';
            }

            document.getElementById('edit-news-modal').classList.add('active');
        };

        // Delete news
        window.deleteNews = async function (newsId, newsTitle) {
            const confirmBox = document.createElement('div');
            confirmBox.className = 'modal active';
            confirmBox.innerHTML = `
                <div class="modal-box" style="max-width: 400px;">
                    <h2>‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h2>
                    <p style="text-align: center; margin: 20px 0;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£<br><strong>"${newsTitle}"</strong><br>‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <div class="form-buttons">
                        <button class="btn btn-danger" id="confirm-delete-news" style="flex: 1;">‡∏•‡∏ö</button>
                        <button class="btn btn-secondary" id="cancel-delete-news" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmBox);

            document.getElementById('confirm-delete-news').addEventListener('click', async () => {
                try {
                    showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                    await db.collection('news').doc(newsId).delete();
                    showStatus('‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.body.removeChild(confirmBox);
                    await loadNewsFromFirebase();
                } catch (error) {
                    console.error('Error deleting news:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                }
            });

            document.getElementById('cancel-delete-news').addEventListener('click', () => {
                document.body.removeChild(confirmBox);
            });
        };

        // Toggle news visibility
        window.toggleNewsVisibility = async function (newsId, visible) {
            try {
                await db.collection('news').doc(newsId).update({ visible: visible });
                showStatus(`${visible ? '‡πÅ‡∏™‡∏î‡∏á' : '‡∏ã‡πà‡∏≠‡∏ô'}‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
                await loadNewsFromFirebase();
            } catch (error) {
                console.error('Error toggling news visibility:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', 'error');
            }
        };

        // AI Chat Functions
        document.getElementById('ai-chat-btn').addEventListener('click', () => {
            const aiChatSection = document.getElementById('ai-chat-section');
            aiChatSection.style.display = aiChatSection.style.display === 'none' ? 'block' : 'none';
            if (aiChatSection.style.display === 'block') {
                document.getElementById('ai-chat-input').focus();
            }
        });

        document.getElementById('close-ai-chat').addEventListener('click', () => {
            document.getElementById('ai-chat-section').style.display = 'none';
            stopSpeaking();
        });

        // AI Voice Input
        document.getElementById('ai-voice-btn').addEventListener('click', () => {
            if (!aiRecognition) {
                showStatus('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á', 'error');
                return;
            }

            if (isAiListening) {
                aiRecognition.stop();
                return;
            }

            isAiListening = true;
            document.getElementById('ai-voice-btn').classList.add('listening');
            showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...', 'info');

            aiRecognition.start();

            aiRecognition.onresult = (event) => {
                let transcript = event.results[0][0].transcript;
                // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô
                transcript = separateStuckWords(transcript);
                document.getElementById('ai-chat-input').value = transcript;

                // ‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏°‡∏Ñ‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
                aiRecognition.stop();
                resetAiVoiceButton();

                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß
                setTimeout(() => {
                    sendAiMessage(transcript);
                }, 100);
            };

            aiRecognition.onerror = (event) => {
                console.error('AI Voice error:', event.error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á', 'error');
                resetAiVoiceButton();
            };

            aiRecognition.onend = () => {
                resetAiVoiceButton();
            };
        });

        function resetAiVoiceButton() {
            isAiListening = false;
            document.getElementById('ai-voice-btn').classList.remove('listening');
        }

        // AI Send Message
        document.getElementById('ai-send-btn').addEventListener('click', () => {
            const message = document.getElementById('ai-chat-input').value.trim();
            if (message) {
                sendAiMessage(message);
            }
        });

        document.getElementById('ai-chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const message = e.target.value.trim();
                if (message) {
                    sendAiMessage(message);
                }
            }
        });

        // Send AI Message
        async function sendAiMessage(message) {
            const messagesContainer = document.getElementById('ai-chat-messages');

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'user-message';
            userMsg.innerHTML = `
                <div class="user-avatar">üë§</div>
                <div class="user-message-content">${escapeHtml(message)}</div>
            `;
            messagesContainer.appendChild(userMsg);

            // Clear input
            document.getElementById('ai-chat-input').value = '';

            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'ai-message';
            typingIndicator.id = 'typing-indicator';
            typingIndicator.innerHTML = `
                <div class="ai-avatar">ü§ñ</div>
                <div class="ai-typing">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            messagesContainer.appendChild(typingIndicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Process AI response
            setTimeout(() => {
                let response;
                try {
                    response = processAiQuery(message);

                    if (!response || typeof response !== 'object') {
                        throw new Error('Invalid response from processAiQuery');
                    }

                    typingIndicator.remove();

                    const aiMsg = document.createElement('div');
                    aiMsg.className = 'ai-message';
                    aiMsg.innerHTML = `
                        <div class="ai-avatar">ü§ñ</div>
                        <div class="ai-message-content">
                            ${response.text || '‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡πà‡∏∞ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏î‡πâ'}
                            ${response.books && response.books.length > 0 ? response.books.map(book => `
                                <div class="ai-book-result">
                                    <div class="ai-book-title">üìñ ${escapeHtml(book.title || '')}</div>
                                    <div class="ai-book-info">üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${escapeHtml(book.author || '')}</div>
                                    <div class="ai-book-info">üìö ‡∏´‡∏°‡∏ß‡∏î: ${escapeHtml(book.category || '')}</div>
                                    <div class="ai-book-info">üìç ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å: ${escapeHtml(book.callNumber || '')}</div>
                                    <div class="ai-book-info" style="color: ${book.available > 0 ? '#27ae60' : '#e74c3c'}; font-weight: 600;">
                                        ${book.available > 0 ? `‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${book.available} ‡πÄ‡∏•‡πà‡∏°` : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°'}
                                    </div>
                                </div>
                            `).join('') : ''}
                            <div class="ai-speaking" id="speaking-indicator" style="display: none;">üîä ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå...</div>
                        </div>
                    `;
                    messagesContainer.appendChild(aiMsg);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;

                    // Speak the response (with improved mobile support)
                    if (response.speechText) {
                        speakText(response.speechText);
                    }

                    // Log search
                    logSearch(message, response.books ? response.books.length : 0, 'ai_chat');
                } catch (error) {
                    console.error('AI Error:', error);
                    console.error('Error details:', error.message, error.stack);

                    typingIndicator.remove();

                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'ai-message';
                    errorMsg.innerHTML = `
                        <div class="ai-avatar">ü§ñ</div>
                        <div class="ai-message-content">
                            ‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•<br>
                            <small style="color: #999;">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${escapeHtml(error.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏')}</small><br>
                            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏∞ üôè
                        </div>
                    `;
                    messagesContainer.appendChild(errorMsg);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }, 1000);
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Process AI Query with Smart Understanding
        function processAiQuery(query) {
            const queryLower = query.toLowerCase();

            // Extract keywords and understand intent
            const keywords = extractSmartKeywords(queryLower);

            // Search for books with smart matching
            let results = smartSearchBooks(keywords, queryLower);

            // Limit to top 3 results
            results = results.slice(0, 3);

            let responseText = '';
            let speechText = '';

            if (results.length === 0) {
                // Suggest alternative searches
                const suggestions = getSuggestions(queryLower);
                responseText = `‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡πà‡∏∞ ‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö "${query}" üòî<br>`;
                speechText = `‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡πà‡∏∞ ‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö ${query} `;

                if (suggestions.length > 0) {
                    responseText += `<br>‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏î‡∏π‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞:<br>`;
                    speechText += `‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏î‡∏π‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞ `;
                    suggestions.forEach(sug => {
                        responseText += `‚Ä¢ ${sug}<br>`;
                        speechText += `${sug} `;
                    });
                } else {
                    responseText += `‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°‡∏â‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏∞`;
                    speechText += `‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°‡∏â‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏∞`;
                }
            } else {
                // Generate friendly response based on query type
                const responseIntro = generateResponseIntro(queryLower, results.length);
                responseText = responseIntro.text;
                speechText = responseIntro.speech;

                results.forEach((book, index) => {
                    speechText += `‡πÄ‡∏•‡πà‡∏°‡∏ó‡∏µ‡πà ${index + 1} ${book.title} ‡πÇ‡∏î‡∏¢ ${book.author} ‡∏´‡∏°‡∏ß‡∏î ${book.category} `;
                    if (book.available > 0) {
                        speechText += `‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${book.available} ‡πÄ‡∏•‡πà‡∏° `;
                    } else {
                        speechText += `‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° `;
                    }
                });
            }

            return {
                text: responseText,
                books: results,
                speechText: speechText
            };
        }

        // Separate stuck words automatically
        function separateStuckWords(text) {
            // Common phrases that often have words stuck to them
            const commonPhrases = [
                '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏î‡πâ‡∏≤‡∏ô', '‡∏ó‡∏≤‡∏á', 'about', 'on',
                '‡∏°‡∏µ', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏≠‡∏¢‡∏≤‡∏Å', '‡∏´‡∏≤', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡∏™‡∏ô‡πÉ‡∏à',
                '‡∏≠‡πà‡∏≤‡∏ô', '‡∏¢‡∏∑‡∏°', '‡∏î‡∏π', '‡πÉ‡∏ô', '‡∏Ç‡∏≠‡∏á', '‡∏ó‡∏µ‡πà', '‡∏à‡∏∞', '‡πÑ‡∏î‡πâ', '‡πÑ‡∏´‡∏ô',
                '‡∏≠‡∏∞‡πÑ‡∏£', '‡∏ä‡πà‡∏ß‡∏¢', '‡∏´‡∏ô‡πà‡∏≠‡∏¢', '‡πÉ‡∏´‡πâ', '‡∏â‡∏±‡∏ô', '‡∏ú‡∏°', '‡∏î‡∏¥‡∏â‡∏±‡∏ô', '‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏Ñ‡πà‡∏∞'
                , '‡πÑ‡∏´‡∏°', '‡∏ö‡πâ‡∏≤‡∏á'
            ];

            let processedText = text;

            // Sort by length (longest first) for better matching
            const sortedPhrases = commonPhrases.sort((a, b) => b.length - a.length);

            sortedPhrases.forEach(phrase => {
                // Pattern: phrase + Thai/English characters without space
                const stuckPattern = new RegExp(`(${phrase})([‡∏Å-‡πôa-zA-Z]+)`, 'gi');
                processedText = processedText.replace(stuckPattern, '$1 $2');
            });

            // Also separate any Thai word followed immediately by English or vice versa
            processedText = processedText.replace(/([‡∏Å-‡πô]+)([a-zA-Z]+)/g, '$1 $2');
            processedText = processedText.replace(/([a-zA-Z]+)([‡∏Å-‡πô]+)/g, '$1 $2');

            return processedText;
        }

        // Escape special regex characters
        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Extract smart keywords from query
        function extractSmartKeywords(query) {
            // Remove common words (expanded list)
            const stopWords = ['‡∏°‡∏µ', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß', '‡∏Å‡∏±‡∏ö', '‡∏ö‡πâ‡∏≤‡∏á', '‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏Ñ‡πà‡∏∞',
                '‡∏≠‡∏¢‡∏≤‡∏Å', '‡∏´‡∏≤', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡∏™‡∏ô‡πÉ‡∏à', '‡∏≠‡πà‡∏≤‡∏ô', '‡∏¢‡∏∑‡∏°', '‡∏î‡∏π', '‡πÄ‡∏•‡πà‡∏°', '‡πÉ‡∏ô', '‡∏Ç‡∏≠‡∏á',
                '‡∏ó‡∏µ‡πà', '‡∏à‡∏∞', '‡πÑ‡∏î‡πâ', '‡πÑ‡∏´‡∏ô', '‡∏≠‡∏∞‡πÑ‡∏£', '‡∏ä‡πà‡∏ß‡∏¢', '‡∏´‡∏ô‡πà‡∏≠‡∏¢', '‡πÉ‡∏´‡πâ', '‡∏â‡∏±‡∏ô', '‡∏ú‡∏°', '‡∏î‡∏¥‡∏â‡∏±‡∏ô',
                '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', '‡πÅ‡∏•‡∏∞', '‡∏´‡∏£‡∏∑‡∏≠', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏î‡πâ‡∏≤‡∏ô', '‡∏ó‡∏≤‡∏á', 'about', 'on', 'the', 'a', 'an',
                'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does',
                'did', 'will', 'would', 'could', 'should', 'may', 'might', 'can', 'must',
                '‡∏Ç‡∏≠', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏ä‡∏∑‡πà‡∏≠', '‡πÅ‡∏ô‡∏ß', '‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á', '‡∏´‡∏°‡∏ß‡∏î', '‡πÅ‡∏•‡∏∞', '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠',
                '‡∏£‡∏π‡πâ', '‡∏ß‡πà‡∏≤', '‡πÅ‡∏ï‡πà‡∏á', '‡πÇ‡∏î‡∏¢', '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', '‡∏Ñ‡∏∑‡∏≠', '‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á'];

            // Known keywords that should be extracted (in lowercase)
            const knownKeywords = [
                'machine learning', 'deep learning', 'data science', 'artificial intelligence',
                'ai', 'python', 'java', 'javascript', 'php', 'sql', 'html', 'css', 'c++', 'c#',
                '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î', '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢',
                '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤', '‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡πÑ‡∏ó‡∏¢',
                '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', '‡∏®‡∏¥‡∏•‡∏õ‡∏∞', '‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢', '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ',
                '‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', '‡∏û‡∏±‡∏í‡∏ô‡∏≤', '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö', '‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°',
                'management', 'business', 'marketing', 'finance', 'health', 'sales',
                'programming', 'coding', 'software', 'computer', 'science', 'development',
                'mathematics', 'english', 'history', 'psychology', 'art', 'law', 'accounting',
                'economics', '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°', '‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', '‡∏Ñ‡∏£‡∏π', '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå',
                '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°', 'engineering', 'architecture', 'design', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢',
                '‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£', 'nutrition', 'fitness', 'exercise', '‡πÅ‡∏û‡∏ó‡∏¢‡πå', 'medical',
                '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•', 'nursing', '‡πÄ‡∏†‡∏™‡∏±‡∏ä', 'pharmacy', '‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå', 'dental'
            ];

            // Sort keywords by length (longest first) for better matching
            const sortedKeywords = knownKeywords.sort((a, b) => b.length - a.length);

            // STEP 1: Pre-process query to separate stuck words after common phrases
            let processedQuery = query;

            // Common phrases that often have words stuck to them (expanded)
            const commonPhrases = [
                '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏î‡πâ‡∏≤‡∏ô', '‡∏ó‡∏≤‡∏á', '‡πÅ‡∏•‡∏∞', 'about', 'on',
                '‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô', '‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á',
                '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏ß', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á', '‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤', '‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ',
                '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏î', '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤',
                '‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏î‡∏¢', '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∑‡∏≠', '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á'
            ];

            commonPhrases.forEach(phrase => {
                // Find pattern: phrase + any word (no space)
                // Match phrase followed by Thai/English characters without space
                const escapedPhrase = escapeRegex(phrase);
                const stuckPattern = new RegExp(`(${escapedPhrase})([‡∏Å-‡πôa-zA-Z]+)`, 'gi');
                processedQuery = processedQuery.replace(stuckPattern, '$1 $2');
            });

            // STEP 2: Extract known keywords from the processed query
            let extractedKeywords = [];
            let remainingQuery = processedQuery;

            sortedKeywords.forEach(keyword => {
                const escapedKeyword = escapeRegex(keyword);
                const regex = new RegExp(`\\b${escapedKeyword}\\b`, 'gi');
                const matches = remainingQuery.match(regex);
                if (matches) {
                    extractedKeywords.push(keyword);
                    remainingQuery = remainingQuery.replace(regex, ' ');
                }
            });

            // STEP 3: Split remaining query by spaces and filter
            const words = remainingQuery.split(/\s+/).filter(word =>
                word.trim().length > 1 && !stopWords.includes(word.trim().toLowerCase())
            );

            // STEP 4: Combine extracted keywords with remaining words
            const allKeywords = [...extractedKeywords, ...words].filter(w => w.trim().length > 0);

            return allKeywords;
        }

        // Smart search with keyword expansion
        function smartSearchBooks(keywords, originalQuery) {
            // Keyword synonyms and related terms
            const synonyms = {
                'ai': ['‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå', 'artificial intelligence', 'machine learning', 'deep learning', 'ai', '‡πÄ‡∏≠‡πÑ‡∏≠'],
                '‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå': ['ai', 'artificial intelligence', 'machine learning', 'deep learning', '‡πÄ‡∏≠‡πÑ‡∏≠'],
                '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£': ['‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', 'management', '‡∏ú‡∏π‡πâ‡∏ô‡∏≥', 'leadership', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', '‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£'],
                '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£': ['‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', 'management', '‡∏ú‡∏π‡πâ‡∏ô‡∏≥', 'leadership', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', '‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£'],
                '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û': ['health', '‡πÅ‡∏û‡∏ó‡∏¢‡πå', '‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå', '‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•', '‡πÄ‡∏†‡∏™‡∏±‡∏ä'],
                'health': ['‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡πÅ‡∏û‡∏ó‡∏¢‡πå', '‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå', '‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢'],
                '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°': ['programming', 'coding', '‡πÇ‡∏Ñ‡πâ‡∏î', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'software', '‡∏û‡∏±‡∏í‡∏ô‡∏≤', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'],
                'programming': ['‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'coding', '‡πÇ‡∏Ñ‡πâ‡∏î', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'software', '‡∏û‡∏±‡∏í‡∏ô‡∏≤'],
                '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°': ['programming', 'coding', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'software', '‡∏û‡∏±‡∏í‡∏ô‡∏≤'],
                'python': ['python', '‡πÑ‡∏û‡∏ò‡∏≠‡∏ô', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'programming', 'coding'],
                'java': ['java', '‡∏à‡∏≤‡∏ß‡∏≤', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'programming'],
                'javascript': ['javascript', 'js', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'web'],
                '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à': ['business', '‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î'],
                'business': ['‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', '‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î'],
                '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î': ['marketing', '‡∏Ç‡∏≤‡∏¢', '‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', '‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢'],
                'marketing': ['‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î', '‡∏Ç‡∏≤‡∏¢', '‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤', '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢'],
                '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢': ['sales', '‡∏Ç‡∏≤‡∏¢', '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î', 'marketing', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à'],
                'sales': ['‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', '‡∏Ç‡∏≤‡∏¢', '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î'],
                '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå': ['computer', 'it', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'software', 'hardware'],
                'computer': ['‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', 'it', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°'],
                '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['science', '‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå', '‡πÄ‡∏Ñ‡∏°‡∏µ', '‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
                'science': ['‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå', '‡πÄ‡∏Ñ‡∏°‡∏µ', '‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤'],
                '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['math', 'mathematics', '‡πÄ‡∏•‡∏Ç', '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥', '‡∏û‡∏µ‡∏ä‡∏Ñ‡∏ì‡∏¥‡∏ï'],
                'math': ['‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 'mathematics', '‡πÄ‡∏•‡∏Ç', '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥'],
                'mathematics': ['‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 'math', '‡πÄ‡∏•‡∏Ç', '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥'],
                '‡∏†‡∏≤‡∏©‡∏≤': ['language', '‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', 'english', '‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®'],
                '‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©': ['english', '‡∏†‡∏≤‡∏©‡∏≤', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©'],
                'english': ['‡∏†‡∏≤‡∏©‡∏≤', '‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©'],
                '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['history', '‡∏≠‡∏î‡∏µ‡∏ï', '‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå', '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥'],
                'history': ['‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏≠‡∏î‡∏µ‡∏ï', '‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå'],
                '‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤': ['psychology', '‡∏à‡∏¥‡∏ï‡πÉ‡∏à', '‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°', '‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤'],
                'psychology': ['‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', '‡∏à‡∏¥‡∏ï‡πÉ‡∏à', '‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°'],
                '‡∏®‡∏¥‡∏•‡∏õ‡∏∞': ['art', '‡∏î‡∏ô‡∏ï‡∏£‡∏µ', '‡∏à‡∏¥‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏°', '‡∏õ‡∏£‡∏∞‡∏ï‡∏¥‡∏°‡∏≤‡∏Å‡∏£‡∏£‡∏°', '‡∏®‡∏¥‡∏•‡∏õ‡πå'],
                'art': ['‡∏®‡∏¥‡∏•‡∏õ‡∏∞', '‡∏î‡∏ô‡∏ï‡∏£‡∏µ', '‡∏à‡∏¥‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏°', '‡∏®‡∏¥‡∏•‡∏õ‡πå'],
                '‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢': ['law', 'legal', '‡∏ô‡∏¥‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏Å‡∏é', '‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö'],
                'law': ['‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢', 'legal', '‡∏ô‡∏¥‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
                '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô': ['finance', '‡πÄ‡∏á‡∏¥‡∏ô', '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', '‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£', '‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô'],
                'finance': ['‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', '‡πÄ‡∏á‡∏¥‡∏ô', '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', '‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô'],
                '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ': ['accounting', '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', 'finance'],
                'accounting': ['‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', 'finance'],
                '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['economics', '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô'],
                'economics': ['‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à'],
                '‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': ['education', '‡∏Ñ‡∏£‡∏π', '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå', '‡∏™‡∏≠‡∏ô', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'],
                'education': ['‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', '‡∏Ñ‡∏£‡∏π', '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå'],
                '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°': ['engineering', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£', '‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ'],
                'engineering': ['‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£', '‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ'],
                '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö': ['design', '‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå', '‡∏®‡∏¥‡∏•‡∏õ‡∏∞'],
                'design': ['‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö', '‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå'],
                '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢': ['exercise', 'fitness', '‡∏Å‡∏µ‡∏¨‡∏≤', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û'],
                'exercise': ['‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', 'fitness', '‡∏Å‡∏µ‡∏¨‡∏≤'],
                'fitness': ['‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', 'exercise', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û'],
                '‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£': ['nutrition', '‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡πÇ‡∏†‡∏ä‡∏ô‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
                'nutrition': ['‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£', '‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û'],
                '‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢': ['novel', 'fiction', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡πâ‡∏ô', '‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°', '‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏Å‡πâ‡∏ß'],
                'novel': ['‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢', 'fiction', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡πâ‡∏ô', '‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°'],
                'fiction': ['‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢', 'novel', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡πâ‡∏ô', '‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°'],
                '‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°': ['literature', '‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢', '‡∏ö‡∏ó‡∏Å‡∏ß‡∏µ', '‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏Å‡πâ‡∏ß', '‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡∏£‡∏≠‡∏á'],
                'literature': ['‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°', '‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢', '‡∏ö‡∏ó‡∏Å‡∏ß‡∏µ'],
                '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ': ['technology', 'tech', 'it', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', '‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•'],
                'technology': ['‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', 'tech', 'it', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'],
                'tech': ['‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', 'technology', 'it', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'],
                '‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•': ['digital', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå'],
                'digital': ['‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'],
                '‡∏Å‡∏µ‡∏¨‡∏≤': ['sport', 'sports', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', '‡∏ü‡∏¥‡∏ï‡πÄ‡∏ô‡∏™', 'exercise'],
                'sport': ['‡∏Å‡∏µ‡∏¨‡∏≤', 'sports', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', 'exercise'],
                'sports': ['‡∏Å‡∏µ‡∏¨‡∏≤', 'sport', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢'],
                '‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß': ['travel', 'tourism', '‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', '‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß'],
                'travel': ['‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', 'tourism', '‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß'],
                'tourism': ['‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', 'travel', '‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß'],
                '‡∏®‡∏≤‡∏™‡∏ô‡∏≤': ['religion', '‡∏û‡∏∏‡∏ó‡∏ò', '‡∏ò‡∏£‡∏£‡∏°', '‡∏®‡∏≤‡∏™‡∏ô‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
                'religion': ['‡∏®‡∏≤‡∏™‡∏ô‡∏≤', '‡∏û‡∏∏‡∏ó‡∏ò', '‡∏ò‡∏£‡∏£‡∏°'],
                '‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤': ['philosophy', '‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤', '‡∏ç‡∏≤‡∏ì‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤'],
                'philosophy': ['‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤', '‡∏ç‡∏≤‡∏ì‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤'],
                '‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°': ['environment', 'environmental', '‡∏ô‡∏¥‡πÄ‡∏ß‡∏®', '‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥'],
                'environment': ['‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°', 'environmental', '‡∏ô‡∏¥‡πÄ‡∏ß‡∏®'],
                '‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£': ['communication', '‡∏™‡∏∑‡πà‡∏≠', '‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£'],
                'communication': ['‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£', '‡∏™‡∏∑‡πà‡∏≠', '‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
                '‡∏™‡∏∑‡πà‡∏≠': ['media', 'communication', '‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£', '‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
                'media': ['‡∏™‡∏∑‡πà‡∏≠', 'communication', '‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£']
            };

            // Expand keywords with synonyms
            let expandedKeywords = [...keywords];
            keywords.forEach(keyword => {
                if (synonyms[keyword]) {
                    expandedKeywords = [...expandedKeywords, ...synonyms[keyword]];
                }
            });

            // Remove duplicates
            expandedKeywords = [...new Set(expandedKeywords)];

            // Score each book
            const scoredBooks = booksDatabase.map(book => {
                let score = 0;
                const bookText = `${book.title} ${book.author} ${book.category} ${book.abstract} ${book.callNumber}`.toLowerCase();

                // Exact phrase match (highest priority)
                if (bookText.includes(originalQuery)) {
                    score += 100;
                }

                // Keyword matches
                expandedKeywords.forEach(keyword => {
                    const keywordLower = keyword.toLowerCase();

                    // Title match (high priority)
                    if (book.title.toLowerCase().includes(keywordLower)) {
                        score += 50;
                    }

                    // Category match (high priority)
                    if (book.category.toLowerCase().includes(keywordLower)) {
                        score += 40;
                    }

                    // Author match
                    if (book.author.toLowerCase().includes(keywordLower)) {
                        score += 30;
                    }

                    // Abstract match
                    if (book.abstract.toLowerCase().includes(keywordLower)) {
                        score += 20;
                    }

                    // Call number match
                    if (book.callNumber.toLowerCase().includes(keywordLower)) {
                        score += 10;
                    }
                });

                return { ...book, score };
            });

            // Filter books with score > 0 and sort by score
            return scoredBooks
                .filter(book => book.score > 0)
                .sort((a, b) => b.score - a.score);
        }

        // Generate friendly response intro
        function generateResponseIntro(query, count) {
            const intros = [
                { text: `‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞! ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à ${count} ‡πÄ‡∏•‡πà‡∏° üìö‚ú®`, speech: `‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à ${count} ‡πÄ‡∏•‡πà‡∏° ` },
                { text: `‡∏°‡∏µ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞! ‡∏â‡∏±‡∏ô‡∏´‡∏≤‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ${count} ‡πÄ‡∏•‡πà‡∏° üéØ`, speech: `‡∏°‡∏µ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏â‡∏±‡∏ô‡∏´‡∏≤‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ${count} ‡πÄ‡∏•‡πà‡∏° ` },
                { text: `‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${count} ‡πÄ‡∏•‡πà‡∏°‡∏Ñ‡πà‡∏∞ üìñ`, speech: `‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${count} ‡πÄ‡∏•‡πà‡∏°‡∏Ñ‡πà‡∏∞ ` },
                { text: `‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ ${count} ‡πÄ‡∏•‡πà‡∏°‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ üåü`, speech: `‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ ${count} ‡πÄ‡∏•‡πà‡∏°‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ` },
                { text: `‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô ${count} ‡πÄ‡∏•‡πà‡∏°‡∏Ñ‡πà‡∏∞ üìö`, speech: `‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô ${count} ‡πÄ‡∏•‡πà‡∏°‡∏Ñ‡πà‡∏∞ ` }
            ];

            // Check query type for more specific responses
            if (query.includes('‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥') || query.includes('‡πÅ‡∏ô‡∏∞')) {
                return { text: `‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ ${count} ‡πÄ‡∏•‡πà‡∏°‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ üåü`, speech: `‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ ${count} ‡πÄ‡∏•‡πà‡∏°‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ` };
            } else if (query.includes('‡∏™‡∏ô‡πÉ‡∏à') || query.includes('‡∏≠‡∏¢‡∏≤‡∏Å')) {
                return { text: `‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞! ‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏ô‡πÉ‡∏à ${count} ‡πÄ‡∏•‡πà‡∏° üí°`, speech: `‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏ô‡πÉ‡∏à ${count} ‡πÄ‡∏•‡πà‡∏° ` };
            } else if (query.includes('‡∏°‡∏µ') && query.includes('‡πÑ‡∏´‡∏°')) {
                return { text: `‡∏°‡∏µ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞! ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${count} ‡πÄ‡∏•‡πà‡∏° üìö`, speech: `‡∏°‡∏µ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${count} ‡πÄ‡∏•‡πà‡∏° ` };
            }

            // Random friendly intro
            return intros[Math.floor(Math.random() * intros.length)];
        }

        // Get search suggestions based on available categories
        function getSuggestions(query) {
            const categories = [...new Set(booksDatabase.map(book => book.category))];

            // Return random 3 categories as suggestions
            const shuffled = categories.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 3);
        }

        // Text to Speech - MOBILE OPTIMIZED
        function speakText(text) {
            // Stop any ongoing speech
            if (isSpeaking) {
                speechSynthesis.cancel();
                isSpeaking = false;
            }

            if (!speechSynthesis) {
                console.log('‚ùå Speech Synthesis not supported');
                return;
            }

            const speakingIndicator = document.getElementById('speaking-indicator');

            console.log('üé§ Starting speech for mobile...');
            console.log('üìù Text to speak:', text.substring(0, 50) + '...');

            // CRITICAL: Cancel any pending speech and wait longer for mobile
            speechSynthesis.cancel();

            // Show speaking indicator
            if (speakingIndicator) {
                speakingIndicator.style.display = 'inline-block';
            }

            // Mobile browsers need more time to initialize
            setTimeout(() => {
                // Force reload voices for mobile
                const voices = speechSynthesis.getVoices();
                console.log('üîä Available voices:', voices.length);

                // Create utterance
                const utterance = new SpeechSynthesisUtterance(text);

                // Try to find Thai voice (mobile-friendly approach)
                let thaiVoice = null;

                // Method 1: Look for exact Thai voice
                thaiVoice = voices.find(voice => voice.lang === 'th-TH');

                // Method 2: Look for any Thai variant
                if (!thaiVoice) {
                    thaiVoice = voices.find(voice => voice.lang.startsWith('th'));
                }

                // Method 3: Look for Thai in name
                if (!thaiVoice) {
                    thaiVoice = voices.find(voice =>
                        voice.name.toLowerCase().includes('thai') ||
                        voice.name.includes('‡πÑ‡∏ó‡∏¢')
                    );
                }

                if (thaiVoice) {
                    utterance.voice = thaiVoice;
                    console.log('‚úÖ Using Thai voice:', thaiVoice.name, thaiVoice.lang);
                } else {
                    console.log('‚ö†Ô∏è No Thai voice found, using default');
                    // Use first available voice on mobile
                    if (voices.length > 0) {
                        utterance.voice = voices[0];
                        console.log('Using voice:', voices[0].name, voices[0].lang);
                    }
                }

                // Mobile-optimized speech parameters
                utterance.lang = 'th-TH';
                utterance.rate = 0.85; // Slightly slower for mobile
                utterance.pitch = 1.0;
                utterance.volume = 1.0;

                // Event handlers
                utterance.onstart = () => {
                    isSpeaking = true;
                    console.log('‚úÖ Speech started on mobile');
                };

                utterance.onend = () => {
                    isSpeaking = false;
                    if (speakingIndicator) {
                        speakingIndicator.style.display = 'none';
                    }
                    console.log('‚úÖ Speech ended');
                };

                utterance.onerror = (event) => {
                    isSpeaking = false;
                    if (speakingIndicator) {
                        speakingIndicator.style.display = 'none';
                    }
                    console.error('‚ùå Speech error:', event.error, event);

                    // Try fallback for mobile
                    if (event.error === 'not-allowed' || event.error === 'interrupted') {
                        console.log('‚ö†Ô∏è Speech blocked, may need user interaction first');
                    }
                };

                // MOBILE FIX: Speak immediately without additional delays
                try {
                    isSpeaking = true;
                    speechSynthesis.speak(utterance);
                    console.log('üé§ Speaking on mobile...');

                    // Mobile-specific: Resume if paused (iOS fix)
                    setTimeout(() => {
                        if (speechSynthesis.paused) {
                            console.log('‚ö†Ô∏è Speech paused, resuming...');
                            speechSynthesis.resume();
                        }

                        // Check if speech actually started
                        if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                            console.log('‚ö†Ô∏è Speech not started on mobile, retrying...');
                            speechSynthesis.cancel();

                            // Retry with shorter text for mobile
                            const shortUtterance = new SpeechSynthesisUtterance(text);
                            shortUtterance.lang = 'th-TH';
                            shortUtterance.rate = 0.85;
                            shortUtterance.pitch = 1.0;
                            shortUtterance.volume = 1.0;
                            if (thaiVoice) shortUtterance.voice = thaiVoice;

                            shortUtterance.onend = () => {
                                isSpeaking = false;
                                if (speakingIndicator) {
                                    speakingIndicator.style.display = 'none';
                                }
                            };

                            speechSynthesis.speak(shortUtterance);
                        }
                    }, 300);

                } catch (error) {
                    console.error('‚ùå Exception while speaking:', error);
                    isSpeaking = false;
                    if (speakingIndicator) {
                        speakingIndicator.style.display = 'none';
                    }
                }

            }, 250); // Longer delay for mobile initialization
        }

        // Stop Speaking
        function stopSpeaking() {
            if (speechSynthesis && isSpeaking) {
                speechSynthesis.cancel();
                isSpeaking = false;
                const speakingIndicator = document.getElementById('speaking-indicator');
                if (speakingIndicator) {
                    speakingIndicator.style.display = 'none';
                }
                console.log('Speech stopped');
            }
        }

        // Initialize on load
        initializeSdks();
        loadBooksFromFirebase();
        loadNewsFromFirebase();
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'99ae2cfe742c55a1',t:'MTc2MjUzMjYxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>