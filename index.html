<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        html {
            height: 100%;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            margin: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
                margin: 10px;
                border-radius: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                width: 100%;
                padding: 15px;
                margin: 0;
                border-radius: 0;
            }
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .header h1 {
            color: #667eea;
            margin: 0 0 10px 0;
            font-size: 32px;
        }
        
        .header p {
            color: #666;
            margin: 0;
            font-size: 16px;
        }
        
        .admin-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: #764ba2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .admin-toggle:hover {
            background: #653a8a;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 14px;
            }
            
            .admin-toggle {
                position: static;
                display: block;
                margin: 15px auto 0;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 20px;
            }
            
            .header p {
                font-size: 13px;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            margin: 20px;
        }
        
        .modal-box h2 {
            color: #667eea;
            margin: 0 0 20px 0;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .api-setup {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }
        
        .api-setup h3 {
            margin: 0 0 15px 0;
            color: #667eea;
            font-size: 18px;
        }
        
        .search-section {
            margin-bottom: 25px;
        }
        
        .search-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .search-controls {
                flex-direction: column;
            }
            
            .search-input {
                width: 100%;
            }
        }
        
        .search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        @media (max-width: 768px) {
            .btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .btn {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-voice {
            background: #764ba2;
            color: white;
        }
        
        .btn-voice:hover {
            background: #653a8a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }
        
        .btn-voice.listening {
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }
        
        .status-message.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }
        
        .status-message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        
        .status-message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }
        
        .results-section {
            margin-top: 25px;
        }
        
        .results-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        .book-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .book-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .book-call-number {
            font-size: 14px;
            color: #764ba2;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .book-title {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .book-info {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-top: 10px;
        }
        
        .book-info-item {
            font-size: 14px;
            color: #666;
        }
        
        .book-info-item strong {
            color: #333;
        }
        
        .book-availability {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .book-availability.available {
            background: #d4edda;
            color: #155724;
        }
        
        .book-availability.limited {
            background: #fff3cd;
            color: #856404;
        }
        
        .book-availability.unavailable {
            background: #f8d7da;
            color: #721c24;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .admin-section {
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .admin-header {
            background: #764ba2;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .admin-header h2 {
            margin: 0;
        }
        
        .book-management {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .book-management h3 {
            color: #667eea;
            margin: 0 0 15px 0;
        }
        
        .upload-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 15px;
            background: #f8f9ff;
            border: 2px dashed #667eea;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-input-label:hover {
            background: #e8ebff;
            border-color: #5568d3;
        }
        
        .book-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .admin-book-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .book-details {
            flex: 1;
            min-width: 200px;
        }
        
        .book-actions {
            display: flex;
            gap: 10px;
        }
        
        .stats-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
        }
        
        .stats-section h3 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 18px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .stat-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
        }
        
        .stat-list li {
            padding: 8px;
            background: #f8f9ff;
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        
        .admin-search-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .admin-search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .admin-search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .news-slider {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .news-slider h3 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 18px;
        }
        
        .news-slide {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .news-slide.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .news-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .news-content {
            color: #333;
            line-height: 1.6;
        }
        
        .news-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        
        .news-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .news-indicator.active {
            background: #667eea;
        }
        
        .image-preview {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .news-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        .news-thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .news-details {
            flex: 1;
        }
        
        .news-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #27ae60;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- User View -->
   <div id="user-view">
    <div class="header">
     <h1 id="system-title">üîç ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h1>
     <p id="welcome-message">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞ AI</p><button class="admin-toggle" id="admin-toggle">üë§ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
    </div><!-- News Slider -->
    <div class="news-slider" id="news-slider" style="display: none;">
     <h3>üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h3>
     <div id="news-slides-container"></div>
     <div class="news-indicators" id="news-indicators"></div>
    </div>
    <div class="api-setup">
     <h3>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h3>
     <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;"><span id="connection-status">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
     </div>
    </div>
    <div class="search-section">
     <div class="search-controls"><input type="text" class="search-input" id="search-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô AI, Python, ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û..."> <button class="btn btn-voice" id="voice-btn"> <span>üéôÔ∏è</span> <span id="voice-text">‡∏û‡∏π‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span> </button> <button class="btn btn-primary" id="search-btn"> <span>üîç</span> <span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span> </button>
     </div>
     <div class="status-message" id="status-message"></div>
    </div>
    <div class="results-section" id="results-section" style="display: none;">
     <h2>üìö ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2>
     <div id="results-container"></div>
    </div>
    <div class="stats-section">
     <h3>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
     <div class="stats-grid">
      <div class="stat-card">
       <div class="stat-value" id="total-searches">
        0
       </div>
       <div class="stat-label">
        ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-label">
        üìö TOP 5 ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
       </div>
       <ul class="stat-list" id="most-borrowed-books"></ul>
      </div>
      <div class="stat-card">
       <div class="stat-label">
        üî• ‡∏Ñ‡∏≥‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
       </div>
       <ul class="stat-list" id="most-searched-terms"></ul>
      </div>
      <div class="stat-card">
       <div class="stat-label">
        üìñ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
       </div>
       <ul class="stat-list" id="most-borrowed-categories"></ul>
      </div>
     </div>
    </div>
   </div><!-- Admin View -->
   <div id="admin-view" class="admin-section">
    <div class="admin-header">
     <h2>üë®‚Äçüíº ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
     <div style="display: flex; gap: 10px; flex-wrap: wrap;"><button class="btn btn-success" id="add-book-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <button class="btn btn-primary" id="add-news-btn">üì∞ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button> <button class="btn btn-secondary" id="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
     </div>
    </div>
    <div class="book-management">
     <h3>üì§ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel</h3>
     <div class="upload-section">
      <div class="file-input-wrapper"><input type="file" id="excel-file" accept=".xlsx, .xls"> <label class="file-input-label" for="excel-file"> üìÅ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel<br><small style="color: #999;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .xlsx ‡πÅ‡∏•‡∏∞ .xls</small> </label>
      </div><button class="btn btn-primary" id="upload-btn" style="width: 100%;"> <span>üì§</span> <span>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button>
     </div>
    </div>
    <div class="book-management">
     <h3>üìö ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<span id="book-count">0</span> ‡πÄ‡∏•‡πà‡∏°)</h3>
     <div class="admin-search-section"><input type="text" class="admin-search-input" id="admin-search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á, ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å, ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á, ‡∏´‡∏°‡∏ß‡∏î)">
     </div>
     <div class="book-list" id="admin-book-list">
      <div class="loading">
       ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
      </div>
     </div>
    </div>
    <div class="book-management">
     <h3>üì∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ (<span id="news-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
     <div class="book-list" id="admin-news-list">
      <div class="loading">
       ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
      </div>
     </div>
    </div>
    <div class="stats-section">
     <h3>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h3>
     <div class="stats-grid">
      <div class="stat-card">
       <div class="stat-value" id="total-books">
        0
       </div>
       <div class="stat-label">
        ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-value" id="total-borrowed">
        0
       </div>
       <div class="stat-label">
        ‡∏¢‡∏∑‡∏°‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-value" id="total-available">
        0
       </div>
       <div class="stat-label">
        ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Login Modal -->
  <div class="modal" id="login-modal">
   <div class="modal-box">
    <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
    <form id="login-form">
     <div class="form-group"><label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label> <input type="text" id="username" required>
     </div>
     <div class="form-group"><label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="password" required>
     </div>
     <div class="form-buttons"><button type="submit" class="btn btn-primary" style="flex: 1;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button> <button type="button" class="btn btn-secondary" id="cancel-login" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- Add Book Modal -->
  <div class="modal" id="add-book-modal">
   <div class="modal-box">
    <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</h2>
    <form id="add-book-form">
     <div class="form-group"><label for="book-title">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á *</label> <input type="text" id="book-title" required>
     </div>
     <div class="form-group"><label for="book-author">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text" id="book-author" required>
     </div>
     <div class="form-group"><label for="book-category">‡∏´‡∏°‡∏ß‡∏î *</label> <input type="text" id="book-category" required>
     </div>
     <div class="form-group"><label for="book-call-number">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="book-call-number" required>
     </div>
     <div class="form-group"><label for="book-abstract">‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠</label> <textarea id="book-abstract"></textarea>
     </div>
     <div class="form-group"><label for="book-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="number" id="book-quantity" min="1" value="1" required>
     </div>
     <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;"> <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary" id="cancel-add-book" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- Edit Book Modal -->
  <div class="modal" id="edit-book-modal">
   <div class="modal-box">
    <h2>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
    <form id="edit-book-form"><input type="hidden" id="edit-book-id">
     <div class="form-group"><label for="edit-book-title">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á *</label> <input type="text" id="edit-book-title" required>
     </div>
     <div class="form-group"><label for="edit-book-author">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text" id="edit-book-author" required>
     </div>
     <div class="form-group"><label for="edit-book-category">‡∏´‡∏°‡∏ß‡∏î *</label> <input type="text" id="edit-book-category" required>
     </div>
     <div class="form-group"><label for="edit-book-call-number">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="edit-book-call-number" required>
     </div>
     <div class="form-group"><label for="edit-book-abstract">‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠</label> <textarea id="edit-book-abstract"></textarea>
     </div>
     <div class="form-group"><label for="edit-book-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="number" id="edit-book-quantity" min="0" required>
     </div>
     <div class="form-group"><label for="edit-book-borrowed">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÑ‡∏õ</label> <input type="number" id="edit-book-borrowed" min="0" value="0">
     </div>
     <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;"> <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary" id="cancel-edit-book" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- Add News Modal -->
  <div class="modal" id="add-news-modal">
   <div class="modal-box">
    <h2>üì∞ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
    <form id="add-news-form">
     <div class="form-group"><label for="news-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß *</label> <input type="text" id="news-title" required>
     </div>
     <div class="form-group"><label for="news-content">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß *</label> <textarea id="news-content" required style="min-height: 120px;"></textarea>
     </div>
     <div class="form-group"><label for="news-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡πà‡∏≤‡∏ß (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏ô‡∏≤‡∏î 400x200 px) *</label> <input type="file" id="news-image" accept="image/*" required> <img id="news-image-preview" class="image-preview" style="display: none;">
     </div>
     <div class="form-group"><label style="display: flex; align-items: center; gap: 10px;"> <input type="checkbox" id="news-visible" checked> <span>‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span> </label>
     </div>
     <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;"> <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary" id="cancel-add-news" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- Edit News Modal -->
  <div class="modal" id="edit-news-modal">
   <div class="modal-box">
    <h2>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h2>
    <form id="edit-news-form"><input type="hidden" id="edit-news-id">
     <div class="form-group"><label for="edit-news-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß *</label> <input type="text" id="edit-news-title" required>
     </div>
     <div class="form-group"><label for="edit-news-content">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß *</label> <textarea id="edit-news-content" required style="min-height: 120px;"></textarea>
     </div>
     <div class="form-group"><label for="edit-news-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡πà‡∏≤‡∏ß (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏ô‡∏≤‡∏î 400x200 px)</label> <input type="file" id="edit-news-image" accept="image/*"> <img id="edit-news-image-preview" class="image-preview" style="display: none;">
     </div>
     <div class="form-buttons"><button type="submit" class="btn btn-success" style="flex: 1;"> <span>üíæ</span> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> </button> <button type="button" class="btn btn-secondary" id="cancel-edit-news" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div>
  <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBZTETR4YN1DQFww57n9h0UV0XT7IBUGLY",
            authDomain: "ai-library-assistant-3d45e.firebaseapp.com",
            projectId: "ai-library-assistant-3d45e",
            storageBucket: "ai-library-assistant-3d45e.firebasestorage.app",
            messagingSenderId: "266038692063",
            appId: "1:266038692063:web:8e5522d9a676e88f24816a",
            measurementId: "G-5W5LJQZVGH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Book database
        let booksDatabase = [];
        let newsDatabase = [];
        let allData = [];
        let isAdmin = false;
        let currentEditBookId = null;
        let currentEditNewsId = null;
        let newsSliderInterval = null;
        let currentSlideIndex = 0;
        
        // Configuration
        const defaultConfig = {
            system_title: "üîç ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞",
            welcome_message: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞ AI"
        };

        let isListening = false;
        let recognition = null;

        // Initialize Speech Recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'th-TH';
            recognition.continuous = false;
            recognition.interimResults = false;
        }

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                updateStats(data);
            }
        };

        // Initialize SDKs
        async function initializeSdks() {
            const dataResult = await window.dataSdk.init(dataHandler);
            if (!dataResult.isOk) {
                console.error("Failed to initialize data SDK");
            }

            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('system-title').textContent = config.system_title || defaultConfig.system_title;
                        document.getElementById('welcome-message').textContent = config.welcome_message || defaultConfig.welcome_message;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["system_title", config.system_title || defaultConfig.system_title],
                        ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
                    ])
                });
            }
        }

        // Load books from Firebase
        async function loadBooksFromFirebase() {
            const connectionStatus = document.getElementById('connection-status');
            connectionStatus.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
            
            try {
                const snapshot = await db.collection('books').get();
                booksDatabase = [];
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    booksDatabase.push({
                        id: doc.id,
                        callNumber: data.callNumber || '',
                        title: data.title || '',
                        author: data.author || '',
                        category: data.category || '',
                        abstract: data.abstract || '',
                        quantity: data.quantity || 0,
                        borrowed: data.borrowed || 0,
                        available: (data.quantity || 0) - (data.borrowed || 0),
                        keywords: [
                            ...(data.callNumber || '').split(' '),
                            ...(data.title || '').split(' '),
                            ...(data.author || '').split(' '),
                            ...(data.category || '').split(' '),
                            ...(data.abstract || '').split(' ')
                        ].filter(word => word.length > 1)
                    });
                });
                
                connectionStatus.textContent = `‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${booksDatabase.length} ‡πÄ‡∏•‡πà‡∏°`;
                showStatus(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${booksDatabase.length} ‡πÄ‡∏•‡πà‡∏°`, 'success');
                
                if (isAdmin) {
                    loadAdminData();
                }
                
                updateUserStats();
                
                return true;
            } catch (error) {
                console.error('Load error:', error);
                connectionStatus.textContent = `‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`;
                showStatus(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Load news from Firebase
        async function loadNewsFromFirebase() {
            try {
                const snapshot = await db.collection('news').orderBy('createdAt', 'desc').get();
                newsDatabase = [];
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    newsDatabase.push({
                        id: doc.id,
                        title: data.title || '',
                        content: data.content || '',
                        imageUrl: data.imageUrl || '',
                        visible: data.visible !== false,
                        createdAt: data.createdAt || ''
                    });
                });
                
                if (isAdmin) {
                    loadAdminNews();
                } else {
                    loadNewsSlider();
                }
                
                return true;
            } catch (error) {
                console.error('Load news error:', error);
                return false;
            }
        }
        
        // Load news slider
        function loadNewsSlider() {
            const visibleNews = newsDatabase.filter(n => n.visible);
            const newsSlider = document.getElementById('news-slider');
            const slidesContainer = document.getElementById('news-slides-container');
            const indicatorsContainer = document.getElementById('news-indicators');
            
            if (visibleNews.length === 0) {
                newsSlider.style.display = 'none';
                return;
            }
            
            newsSlider.style.display = 'block';
            slidesContainer.innerHTML = '';
            indicatorsContainer.innerHTML = '';
            
            visibleNews.forEach((news, index) => {
                const slide = document.createElement('div');
                slide.className = `news-slide ${index === 0 ? 'active' : ''}`;
                slide.innerHTML = `
                    <img src="${news.imageUrl}" alt="${news.title}" class="news-image" onerror="this.src=''; this.alt='‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ'; this.style.display='none';">
                    <h4 style="color: #667eea; margin: 0 0 10px 0;">${news.title}</h4>
                    <div class="news-content">${news.content}</div>
                `;
                slidesContainer.appendChild(slide);
                
                const indicator = document.createElement('div');
                indicator.className = `news-indicator ${index === 0 ? 'active' : ''}`;
                indicator.addEventListener('click', () => showSlide(index));
                indicatorsContainer.appendChild(indicator);
            });
            
            currentSlideIndex = 0;
            startNewsSlider();
        }
        
        // Start news slider
        function startNewsSlider() {
            if (newsSliderInterval) {
                clearInterval(newsSliderInterval);
            }
            
            newsSliderInterval = setInterval(() => {
                const visibleNews = newsDatabase.filter(n => n.visible);
                if (visibleNews.length > 1) {
                    currentSlideIndex = (currentSlideIndex + 1) % visibleNews.length;
                    showSlide(currentSlideIndex);
                }
            }, 5000);
        }
        
        // Show specific slide
        function showSlide(index) {
            const slides = document.querySelectorAll('.news-slide');
            const indicators = document.querySelectorAll('.news-indicator');
            
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            
            indicators.forEach((indicator, i) => {
                indicator.classList.toggle('active', i === index);
            });
            
            currentSlideIndex = index;
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // Login functionality
        document.getElementById('admin-toggle').addEventListener('click', () => {
            document.getElementById('login-modal').classList.add('active');
        });

        document.getElementById('cancel-login').addEventListener('click', () => {
            document.getElementById('login-modal').classList.remove('active');
        });

        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'Admin' && password === '1234') {
                isAdmin = true;
                document.getElementById('login-modal').classList.remove('active');
                document.getElementById('user-view').style.display = 'none';
                document.getElementById('admin-view').classList.add('active');
                loadAdminData();
                showStatus('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } else {
                showStatus('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }
            
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            isAdmin = false;
            document.getElementById('user-view').style.display = 'block';
            document.getElementById('admin-view').classList.remove('active');
            showStatus('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        });

        // Add book modal
        document.getElementById('add-book-btn').addEventListener('click', () => {
            document.getElementById('add-book-modal').classList.add('active');
        });

        document.getElementById('cancel-add-book').addEventListener('click', () => {
            document.getElementById('add-book-modal').classList.remove('active');
            document.getElementById('add-book-form').reset();
        });

        document.getElementById('add-book-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const bookData = {
                title: document.getElementById('book-title').value.trim(),
                author: document.getElementById('book-author').value.trim(),
                category: document.getElementById('book-category').value.trim(),
                callNumber: document.getElementById('book-call-number').value.trim(),
                abstract: document.getElementById('book-abstract').value.trim(),
                quantity: parseInt(document.getElementById('book-quantity').value) || 0,
                borrowed: 0,
                createdAt: new Date().toISOString()
            };
            
            try {
                showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                await db.collection('books').add(bookData);
                showStatus('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                document.getElementById('add-book-modal').classList.remove('active');
                document.getElementById('add-book-form').reset();
                await loadBooksFromFirebase();
            } catch (error) {
                console.error('Error adding book:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', 'error');
            }
        });

        // Edit book modal
        document.getElementById('cancel-edit-book').addEventListener('click', () => {
            document.getElementById('edit-book-modal').classList.remove('active');
            document.getElementById('edit-book-form').reset();
            currentEditBookId = null;
        });

        document.getElementById('edit-book-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentEditBookId) return;
            
            const bookData = {
                title: document.getElementById('edit-book-title').value.trim(),
                author: document.getElementById('edit-book-author').value.trim(),
                category: document.getElementById('edit-book-category').value.trim(),
                callNumber: document.getElementById('edit-book-call-number').value.trim(),
                abstract: document.getElementById('edit-book-abstract').value.trim(),
                quantity: parseInt(document.getElementById('edit-book-quantity').value) || 0,
                borrowed: parseInt(document.getElementById('edit-book-borrowed').value) || 0,
                updatedAt: new Date().toISOString()
            };
            
            try {
                showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                await db.collection('books').doc(currentEditBookId).update(bookData);
                showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                document.getElementById('edit-book-modal').classList.remove('active');
                document.getElementById('edit-book-form').reset();
                currentEditBookId = null;
                await loadBooksFromFirebase();
            } catch (error) {
                console.error('Error updating book:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        });

        // Excel upload
        document.getElementById('upload-btn').addEventListener('click', async () => {
            const fileInput = document.getElementById('excel-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel', 'error');
                return;
            }
            
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå...', 'info');
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (jsonData.length === 0) {
                        showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                        return;
                    }
                    
                    showStatus(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${jsonData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...`, 'info');
                    
                    let successCount = 0;
                    let errorCount = 0;
                    
                    for (const row of jsonData) {
                        try {
                            const bookData = {
                                title: (row['‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á'] || row['title'] || '').toString().trim(),
                                author: (row['‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á'] || row['author'] || '').toString().trim(),
                                category: (row['‡∏´‡∏°‡∏ß‡∏î'] || row['category'] || '').toString().trim(),
                                callNumber: (row['‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'] || row['callNumber'] || '').toString().trim(),
                                abstract: (row['‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠'] || row['abstract'] || '').toString().trim(),
                                quantity: parseInt(row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'] || row['quantity'] || 0),
                                borrowed: 0,
                                createdAt: new Date().toISOString()
                            };
                            
                            if (bookData.title && bookData.callNumber) {
                                await db.collection('books').add(bookData);
                                successCount++;
                            }
                        } catch (error) {
                            console.error('Error adding book:', error);
                            errorCount++;
                        }
                    }
                    
                    showStatus(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£${errorCount > 0 ? `, ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${errorCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` : ''}`, 'success');
                    fileInput.value = '';
                    await loadBooksFromFirebase();
                    
                } catch (error) {
                    console.error('Error processing file:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        });

        // Voice search
        document.getElementById('voice-btn').addEventListener('click', () => {
            if (!recognition) {
                showStatus('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á', 'error');
                return;
            }

            if (isListening) {
                recognition.stop();
                return;
            }

            isListening = true;
            document.getElementById('voice-btn').classList.add('listening');
            document.getElementById('voice-text').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...';
            showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...', 'info');

            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('search-input').value = transcript;
                showStatus(`‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á: "${transcript}"`, 'success');
                performSearch(transcript, 'voice');
            };

            recognition.onerror = (event) => {
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á', 'error');
                resetVoiceButton();
            };

            recognition.onend = () => {
                resetVoiceButton();
            };
        });

        function resetVoiceButton() {
            isListening = false;
            document.getElementById('voice-btn').classList.remove('listening');
            document.getElementById('voice-text').textContent = '‡∏û‡∏π‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
        }

        // Text search
        document.getElementById('search-btn').addEventListener('click', () => {
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                performSearch(query, 'text');
            } else {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'error');
            }
        });

        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = e.target.value.trim();
                if (query) {
                    performSearch(query, 'text');
                }
            }
        });

        // Perform search
        async function performSearch(query, method) {
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...', 'info');
            
            const results = searchBooks(query);
            displayResults(results, query);
            await logSearch(query, results.length, method);
        }

        // Search books
        function searchBooks(query) {
            const queryLower = query.toLowerCase();
            return booksDatabase.filter(book => {
                const callNumberMatch = book.callNumber.toLowerCase().includes(queryLower);
                const titleMatch = book.title.toLowerCase().includes(queryLower);
                const authorMatch = book.author.toLowerCase().includes(queryLower);
                const categoryMatch = book.category.toLowerCase().includes(queryLower);
                const abstractMatch = book.abstract.toLowerCase().includes(queryLower);
                const keywordMatch = book.keywords.some(kw => 
                    kw.toLowerCase().includes(queryLower) || 
                    queryLower.includes(kw.toLowerCase())
                );
                
                return callNumberMatch || titleMatch || authorMatch || categoryMatch || abstractMatch || keywordMatch;
            });
        }

        // Display results
        function displayResults(results, query) {
            const resultsSection = document.getElementById('results-section');
            const resultsContainer = document.getElementById('results-container');
            
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = '';
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <p>üòî ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${query}"</p>
                        <p>‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô</p>
                    </div>
                `;
                showStatus(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "${query}"`, 'error');
                return;
            }
            
            results.forEach(book => {
                const available = book.available;
                
                let availabilityClass = 'unavailable';
                let availabilityText = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°';
                
                if (available > 5) {
                    availabilityClass = 'available';
                    availabilityText = `‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${available} ‡πÄ‡∏•‡πà‡∏°`;
                } else if (available > 0) {
                    availabilityClass = 'limited';
                    availabilityText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${available} ‡πÄ‡∏•‡πà‡∏°`;
                }
                
                const bookCard = document.createElement('div');
                bookCard.className = 'book-card';
                bookCard.innerHTML = `
                    <div class="book-call-number">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠: ${book.callNumber}</div>
                    <div class="book-title">${book.title}</div>
                    <div class="book-info">
                        <div class="book-info-item"><strong>‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á:</strong> ${book.author}</div>
                        <div class="book-info-item"><strong>‡∏´‡∏°‡∏ß‡∏î:</strong> ${book.category}</div>
                        ${book.abstract ? `<div class="book-info-item"><strong>‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠:</strong> ${book.abstract}</div>` : ''}
                    </div>
                    <span class="book-availability ${availabilityClass}">${availabilityText}</span>
                `;
                resultsContainer.appendChild(bookCard);
            });
            
            showStatus(`‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ${results.length} ‡πÄ‡∏•‡πà‡∏°`, 'success');
        }

        // Log search
        async function logSearch(query, resultsCount, method) {
            const logEntry = {
                query: query,
                timestamp: new Date().toISOString(),
                results_count: resultsCount,
                search_method: method
            };
            
            const result = await window.dataSdk.create(logEntry);
            if (!result.isOk) {
                console.error("Failed to log search");
            }
        }

        // Update stats
        function updateStats(data) {
            const searches = data;
            document.getElementById('total-searches').textContent = searches.length;
            
            // Most searched terms
            const termCounts = {};
            searches.forEach(s => {
                if (s.query) {
                    termCounts[s.query] = (termCounts[s.query] || 0) + 1;
                }
            });
            const topTerms = Object.entries(termCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const termsListEl = document.getElementById('most-searched-terms');
            termsListEl.innerHTML = topTerms.length > 0 
                ? topTerms.map(([term, count]) => `<li>${term} (${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</li>`).join('')
                : '<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>';
            
            updateUserStats();
        }
        
        // Update user stats
        function updateUserStats() {
            // TOP 5 ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            const topBorrowed = [...booksDatabase]
                .sort((a, b) => b.borrowed - a.borrowed)
                .slice(0, 5);
            
            const borrowedListEl = document.getElementById('most-borrowed-books');
            borrowedListEl.innerHTML = topBorrowed.length > 0
                ? topBorrowed.map(book => `<li>${book.title} (${book.borrowed} ‡πÄ‡∏•‡πà‡∏°)</li>`).join('')
                : '<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>';
            
            // TOP 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            const categoryCounts = {};
            booksDatabase.forEach(book => {
                if (book.category && book.borrowed > 0) {
                    categoryCounts[book.category] = (categoryCounts[book.category] || 0) + book.borrowed;
                }
            });
            const topCategories = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const categoriesListEl = document.getElementById('most-borrowed-categories');
            categoriesListEl.innerHTML = topCategories.length > 0
                ? topCategories.map(([cat, count]) => `<li>${cat} (${count} ‡πÄ‡∏•‡πà‡∏°)</li>`).join('')
                : '<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>';
        }

        // Admin functions
        async function loadAdminData() {
            filterAdminBooks('');
            
            let totalQuantity = 0;
            let totalBorrowed = 0;
            let totalAvailable = 0;
            
            booksDatabase.forEach(book => {
                totalQuantity += book.quantity;
                totalBorrowed += book.borrowed;
                totalAvailable += book.available;
            });
            
            document.getElementById('total-books').textContent = totalQuantity;
            document.getElementById('total-borrowed').textContent = totalBorrowed;
            document.getElementById('total-available').textContent = totalAvailable;
        }
        
        // Filter admin books
        function filterAdminBooks(query) {
            const adminBookList = document.getElementById('admin-book-list');
            adminBookList.innerHTML = '';
            
            const queryLower = query.toLowerCase();
            const filteredBooks = query ? booksDatabase.filter(book => 
                book.title.toLowerCase().includes(queryLower) ||
                book.callNumber.toLowerCase().includes(queryLower) ||
                book.author.toLowerCase().includes(queryLower) ||
                book.category.toLowerCase().includes(queryLower)
            ) : booksDatabase;
            
            if (filteredBooks.length === 0) {
                adminBookList.innerHTML = '<div class="loading">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>';
                document.getElementById('book-count').textContent = '0';
                return;
            }
            
            document.getElementById('book-count').textContent = filteredBooks.length;
            
            filteredBooks.forEach(book => {
                const card = document.createElement('div');
                card.className = 'admin-book-card';
                card.innerHTML = `
                    <div class="book-details">
                        <div style="font-weight: 700; color: #667eea; margin-bottom: 5px;">${book.title}</div>
                        <div style="font-size: 14px; color: #666;">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å: ${book.callNumber} | ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author}</div>
                        <div style="font-size: 14px; color: #27ae60; margin-top: 5px;">
                            ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${book.quantity} | ‡∏¢‡∏∑‡∏°: ${book.borrowed} | ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${book.available}
                        </div>
                    </div>
                    <div class="book-actions">
                        <button class="btn btn-primary" onclick="editBook('${book.id}')" style="padding: 8px 15px; font-size: 14px;">
                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button class="btn btn-danger" onclick="deleteBook('${book.id}', '${book.title}')" style="padding: 8px 15px; font-size: 14px;">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                `;
                adminBookList.appendChild(card);
            });
        }
        
        // Load admin news
        function loadAdminNews() {
            const adminNewsList = document.getElementById('admin-news-list');
            adminNewsList.innerHTML = '';
            
            if (newsDatabase.length === 0) {
                adminNewsList.innerHTML = '<div class="loading">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';
                document.getElementById('news-count').textContent = '0';
                return;
            }
            
            document.getElementById('news-count').textContent = newsDatabase.length;
            
            newsDatabase.forEach(news => {
                const card = document.createElement('div');
                card.className = 'news-card';
                card.innerHTML = `
                    <img src="${news.imageUrl}" alt="${news.title}" class="news-thumbnail" onerror="this.src=''; this.alt='‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ'; this.style.display='none';">
                    <div class="news-details">
                        <div style="font-weight: 700; color: #667eea; margin-bottom: 5px;">${news.title}</div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">${news.content.substring(0, 100)}${news.content.length > 100 ? '...' : ''}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 13px; color: #999;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
                            <label class="toggle-switch">
                                <input type="checkbox" ${news.visible ? 'checked' : ''} onchange="toggleNewsVisibility('${news.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="font-size: 13px; color: ${news.visible ? '#27ae60' : '#999'};">${news.visible ? '‡πÅ‡∏™‡∏î‡∏á' : '‡∏ã‡πà‡∏≠‡∏ô'}</span>
                        </div>
                    </div>
                    <div class="news-actions">
                        <button class="btn btn-primary" onclick="editNews('${news.id}')" style="padding: 8px 15px; font-size: 14px;">
                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button class="btn btn-danger" onclick="deleteNews('${news.id}', '${news.title}')" style="padding: 8px 15px; font-size: 14px;">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                `;
                adminNewsList.appendChild(card);
            });
        }

        // Edit book
        window.editBook = function(bookId) {
            const book = booksDatabase.find(b => b.id === bookId);
            if (!book) return;
            
            currentEditBookId = bookId;
            document.getElementById('edit-book-id').value = bookId;
            document.getElementById('edit-book-title').value = book.title;
            document.getElementById('edit-book-author').value = book.author;
            document.getElementById('edit-book-category').value = book.category;
            document.getElementById('edit-book-call-number').value = book.callNumber;
            document.getElementById('edit-book-abstract').value = book.abstract;
            document.getElementById('edit-book-quantity').value = book.quantity;
            document.getElementById('edit-book-borrowed').value = book.borrowed;
            
            document.getElementById('edit-book-modal').classList.add('active');
        };

        // Delete book
        window.deleteBook = async function(bookId, bookTitle) {
            const confirmBox = document.createElement('div');
            confirmBox.className = 'modal active';
            confirmBox.innerHTML = `
                <div class="modal-box" style="max-width: 400px;">
                    <h2>‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h2>
                    <p style="text-align: center; margin: 20px 0;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠<br><strong>"${bookTitle}"</strong><br>‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <div class="form-buttons">
                        <button class="btn btn-danger" id="confirm-delete" style="flex: 1;">‡∏•‡∏ö</button>
                        <button class="btn btn-secondary" id="cancel-delete" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmBox);
            
            document.getElementById('confirm-delete').addEventListener('click', async () => {
                try {
                    showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                    await db.collection('books').doc(bookId).delete();
                    showStatus('‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.body.removeChild(confirmBox);
                    await loadBooksFromFirebase();
                } catch (error) {
                    console.error('Error deleting book:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', 'error');
                }
            });
            
            document.getElementById('cancel-delete').addEventListener('click', () => {
                document.body.removeChild(confirmBox);
            });
        };

        // Admin search books
        document.getElementById('admin-search-input').addEventListener('input', (e) => {
            filterAdminBooks(e.target.value);
        });
        
        // Add news modal
        document.getElementById('add-news-btn').addEventListener('click', () => {
            document.getElementById('add-news-modal').classList.add('active');
        });
        
        document.getElementById('cancel-add-news').addEventListener('click', () => {
            document.getElementById('add-news-modal').classList.remove('active');
            document.getElementById('add-news-form').reset();
            document.getElementById('news-image-preview').style.display = 'none';
        });
        
        // Preview news image
        document.getElementById('news-image').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const preview = document.getElementById('news-image-preview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Add news form
        document.getElementById('add-news-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const file = document.getElementById('news-image').files[0];
            if (!file) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
                return;
            }
            
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
            
            const reader = new FileReader();
            reader.onload = async (event) => {
                const newsData = {
                    title: document.getElementById('news-title').value.trim(),
                    content: document.getElementById('news-content').value.trim(),
                    imageUrl: event.target.result,
                    visible: document.getElementById('news-visible').checked,
                    createdAt: new Date().toISOString()
                };
                
                try {
                    await db.collection('news').add(newsData);
                    showStatus('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.getElementById('add-news-modal').classList.remove('active');
                    document.getElementById('add-news-form').reset();
                    document.getElementById('news-image-preview').style.display = 'none';
                    await loadNewsFromFirebase();
                } catch (error) {
                    console.error('Error adding news:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                }
            };
            reader.readAsDataURL(file);
        });
        
        // Edit news modal
        document.getElementById('cancel-edit-news').addEventListener('click', () => {
            document.getElementById('edit-news-modal').classList.remove('active');
            document.getElementById('edit-news-form').reset();
            document.getElementById('edit-news-image-preview').style.display = 'none';
            currentEditNewsId = null;
        });
        
        // Preview edit news image
        document.getElementById('edit-news-image').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const preview = document.getElementById('edit-news-image-preview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Edit news form
        document.getElementById('edit-news-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentEditNewsId) return;
            
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
            
            const file = document.getElementById('edit-news-image').files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const newsData = {
                        title: document.getElementById('edit-news-title').value.trim(),
                        content: document.getElementById('edit-news-content').value.trim(),
                        imageUrl: event.target.result,
                        updatedAt: new Date().toISOString()
                    };
                    
                    try {
                        await db.collection('news').doc(currentEditNewsId).update(newsData);
                        showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        document.getElementById('edit-news-modal').classList.remove('active');
                        document.getElementById('edit-news-form').reset();
                        document.getElementById('edit-news-image-preview').style.display = 'none';
                        currentEditNewsId = null;
                        await loadNewsFromFirebase();
                    } catch (error) {
                        console.error('Error updating news:', error);
                        showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                    }
                };
                reader.readAsDataURL(file);
            } else {
                const newsData = {
                    title: document.getElementById('edit-news-title').value.trim(),
                    content: document.getElementById('edit-news-content').value.trim(),
                    updatedAt: new Date().toISOString()
                };
                
                try {
                    await db.collection('news').doc(currentEditNewsId).update(newsData);
                    showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.getElementById('edit-news-modal').classList.remove('active');
                    document.getElementById('edit-news-form').reset();
                    currentEditNewsId = null;
                    await loadNewsFromFirebase();
                } catch (error) {
                    console.error('Error updating news:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                }
            }
        });
        
        // Edit news
        window.editNews = function(newsId) {
            const news = newsDatabase.find(n => n.id === newsId);
            if (!news) return;
            
            currentEditNewsId = newsId;
            document.getElementById('edit-news-title').value = news.title;
            document.getElementById('edit-news-content').value = news.content;
            
            if (news.imageUrl) {
                const preview = document.getElementById('edit-news-image-preview');
                preview.src = news.imageUrl;
                preview.style.display = 'block';
            }
            
            document.getElementById('edit-news-modal').classList.add('active');
        };
        
        // Delete news
        window.deleteNews = async function(newsId, newsTitle) {
            const confirmBox = document.createElement('div');
            confirmBox.className = 'modal active';
            confirmBox.innerHTML = `
                <div class="modal-box" style="max-width: 400px;">
                    <h2>‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h2>
                    <p style="text-align: center; margin: 20px 0;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£<br><strong>"${newsTitle}"</strong><br>‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <div class="form-buttons">
                        <button class="btn btn-danger" id="confirm-delete-news" style="flex: 1;">‡∏•‡∏ö</button>
                        <button class="btn btn-secondary" id="cancel-delete-news" style="flex: 1;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmBox);
            
            document.getElementById('confirm-delete-news').addEventListener('click', async () => {
                try {
                    showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
                    await db.collection('news').doc(newsId).delete();
                    showStatus('‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.body.removeChild(confirmBox);
                    await loadNewsFromFirebase();
                } catch (error) {
                    console.error('Error deleting news:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£', 'error');
                }
            });
            
            document.getElementById('cancel-delete-news').addEventListener('click', () => {
                document.body.removeChild(confirmBox);
            });
        };
        
        // Toggle news visibility
        window.toggleNewsVisibility = async function(newsId, visible) {
            try {
                await db.collection('news').doc(newsId).update({ visible: visible });
                showStatus(`${visible ? '‡πÅ‡∏™‡∏î‡∏á' : '‡∏ã‡πà‡∏≠‡∏ô'}‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
                await loadNewsFromFirebase();
            } catch (error) {
                console.error('Error toggling news visibility:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', 'error');
            }
        };
        
        // Initialize on load
        initializeSdks();
        loadBooksFromFirebase();
        loadNewsFromFirebase();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99ac77c6058b55a1',t:'MTc2MjUxNDcwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>