<!doctype html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBTC Library Ai</title>
    <script src="/_sdk/data_sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="icon" type="image/png" href="image/PBTClOgo.png"/>
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô head -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>

<body><!-- Login Selection Container -->
    <div id="login-selection-container">
        <div class="container" style="max-width: 600px; margin-top: 100px;">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 30px;">üîê ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;"><button class="btn btn-primary"
                        onclick="showAdminLogin()"
                        style="padding: 40px 20px; font-size: 1.2em; display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <span style="font-size: 3em;">üë®‚Äçüíº</span> <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span> </button> <button
                        class="btn btn-success" onclick="showStudentLogin()"
                        style="padding: 40px 20px; font-size: 1.2em; display: flex; flex-direction: column; align-items: center; gap: 15px;">
                        <span style="font-size: 3em;">üë®‚Äçüéì</span> <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span> </button>
                </div>
            </div>
        </div>
    </div><!-- Admin Login Container -->
    <div id="admin-login-container" style="display: none;">
        <div class="container" style="max-width: 500px; margin-top: 100px;">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 30px;">üë®‚Äçüíº ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
                <div id="admin-login-alert"></div>
                <form id="admin-login-form" onsubmit="handleAdminLogin(event)">
                    <div class="form-group"><label for="admin-username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label> <input type="text"
                            id="admin-username" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
                    </div>
                    <div class="form-group"><label for="admin-password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password"
                            id="admin-password" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                    </div><button type="submit" class="btn btn-primary" style="width: 100%;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form>
                <button class="btn btn-primary" onclick="backToLoginSelection()"
                    style="width: 100%; margin-top: 15px;">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div><!-- Student Login Container -->
    <div id="student-login-container" style="display: none;">
        <div class="container" style="max-width: 500px; margin-top: 100px;">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 30px;">üë®‚Äçüéì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div id="student-login-alert"></div>
                <form id="student-login-form" onsubmit="handleStudentLogin(event)">
                    <div class="form-group"><label for="student-login-id">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input type="text"
                            id="student-login-id" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤" required>
                    </div><button type="submit" class="btn btn-success" style="width: 100%;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form><button class="btn btn-primary" onclick="backToLoginSelection()"
                    style="width: 100%; margin-top: 15px;">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div><!-- Student Interface -->

    <div id="student-container" style="display: none;">
        <div class="container">
            <header class="header">
                <h1>üìö PBTC Library Ai</h1>
                <p id="student-welcome-text">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</p><button class="btn btn-danger"
                    onclick="handleStudentLogout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </header><!-- Student Navigation -->
            <nav class="admin-nav">
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="switchStudentSection('home')">üè†‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
                    <button class="nav-btn" onclick="switchStudentSection('search')">üîç‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
                    <button class="nav-btn" onclick="switchStudentSection('all-books')">üìñ ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="nav-btn" onclick="switchStudentSection('borrowed-books')">üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</button>

                </div>
            </nav><!-- Home Section (Recommended + Stats) -->
            <div id="student-home-section" class="content-section active"><!-- News Section -->
                <div class="card" style="margin-bottom: 30px;">
                    <h2>üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
                    <div class="news-slider-container">
                        <div class="news-slider-wrapper">
                            <div class="news-slider-track" id="student-news-slider-track"></div>
                        </div>
                        <div class="slider-controls" id="student-news-slider-controls" style="display: none;"><button
                                class="slider-btn" id="student-news-prev-btn"
                                onclick="studentNewsSliderPrev()">‚Äπ</button>
                            <div class="slider-dots" id="student-news-slider-dots"></div><button class="slider-btn"
                                id="student-news-next-btn" onclick="studentNewsSliderNext()">‚Ä∫</button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h2>üí° ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</h2>
                    <p style="color: #666; margin-bottom: 20px;">‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì <strong
                            id="student-name-recommend"></strong></p>
                    <div id="recommended-books-grid" class="news-grid"></div>
                </div>
                <div class="card" style="margin-top: 30px;">
                    <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                    <div class="top-list">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üèÜ TOP 5 ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                        <div id="student-home-top-books"></div>
                    </div>
                    <div class="top-list">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìö TOP 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                        <div id="student-home-top-categories"></div>
                    </div>
                </div>
            </div><!-- Student Search Section -->
            <div id="student-search-section" class="content-section">
                <div class="card">
                    <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢ AI</h2><!-- Search Tabs -->
                    <div class="search-tabs"><button class="search-tab active"
                            onclick="switchStudentSearchMode('text')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button> <button
                            class="search-tab" onclick="switchStudentSearchMode('voice')">üé§ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
                        <button class="search-tab" onclick="switchStudentSearchMode('ai')">ü§ñ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢ AI Chat</button>
                    </div><!-- Text Search -->
                    <div id="student-text-search" class="search-mode">
                        <div class="search-input-container"><input type="text" id="student-text-search-input"
                                class="search-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠, ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á, ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà..."
                                onkeypress="handleStudentSearchEnter(event, 'text')"> <button class="btn btn-primary"
                                onclick="studentSearchBooks('text')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                        </div>
                    </div><!-- Voice Search -->
                    <div id="student-voice-search" class="search-mode" style="display: none;">
                        <div class="search-input-container"><input type="text" id="student-voice-search-input"
                                class="search-input" placeholder="‡∏Å‡∏î‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î..." readonly> <button
                                class="btn btn-voice" id="student-voice-btn" onclick="startStudentVoiceSearch()">üé§
                                ‡∏û‡∏π‡∏î‡πÄ‡∏•‡∏¢</button> <button class="btn btn-primary" onclick="studentSearchBooks('voice')">üîç
                                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                        </div>
                    </div><!-- AI Chat Search -->
                    <div id="student-ai-search" class="search-mode" style="display: none;">
                        <div class="ai-chat-container" id="student-ai-chat"></div>
                        <div class="search-input-container"><input type="text" id="student-ai-search-input"
                                class="search-input" placeholder="‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏±‡∏ö AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..."
                                onkeypress="handleStudentSearchEnter(event, 'ai')"> <button class="btn btn-voice"
                                id="student-ai-voice-btn" onclick="startStudentAIVoice()">üé§</button> <button
                                class="btn btn-primary" onclick="sendStudentAIMessage()">‡∏™‡πà‡∏á</button>
                        </div>
                    </div><!-- Search Results -->
                    <div id="student-search-results" style="display: none; margin-top: 30px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: #667eea; margin: 0;">üìñ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3><button class="btn btn-voice"
                                onclick="speakStudentResults()">üîä ‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
                        </div>
                        <div id="student-search-results-content" class="news-grid"></div>
                    </div>
                </div>
            </div><!-- All Books Section -->
            <div id="student-all-books-section" class="content-section">
                <div class="card">
                    <h2>üìñ ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                    <div style="margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;"><input
                            type="text" id="student-search-books" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..."
                            oninput="filterStudentBooks()"> <select id="student-sort-books" class="form-control"
                            onchange="sortStudentBooks()">
                            <option value="title">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
                            <option value="category">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î</option>
                            <option value="author">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</option>
                            <option value="available">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</option>
                        </select>
                    </div>
                    <div id="all-books-grid" class="news-grid"></div>
                </div>
            </div>
            <div id="student-borrowed-books-section" class="content-section">
                <div class="card">
                    <h2>üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà</h2>
                    <div id="student-borrowed-books-list" class="news-grid"></div>
                </div>
            </div>

        </div>
    </div><!-- User Interface -->


    <div id="user-container" style="display: none;">
        <div class="container">
            <header class="header">
                <h1>üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢ AI</h1>
                <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏±‡∏ö AI</p><button class="btn btn-primary"
                    onclick="showLoginSelection()" style="margin-top: 15px;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </header><!-- Search Container -->
            <div class="search-container">
                <div class="search-tabs"><button class="search-tab active" onclick="switchSearchMode('text')">üîç
                        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button> <button class="search-tab" onclick="switchSearchMode('voice')">üé§
                        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button> <button class="search-tab" onclick="switchSearchMode('ai')">ü§ñ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢
                        AI Chat</button>
                </div><!-- Text Search -->
                <div id="text-search" class="search-mode">
                    <div class="search-input-container"><input type="text" id="text-search-input" class="search-input"
                            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠, ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á, ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà..." onkeypress="handleEnterKey(event)">
                        <button class="btn btn-primary" onclick="searchBooks('text')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    </div>
                </div><!-- Voice Search -->
                <div id="voice-search" class="search-mode" style="display: none;">
                    <div class="search-input-container"><input type="text" id="voice-search-input" class="search-input"
                            placeholder="‡∏Å‡∏î‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î..." readonly> <button class="btn btn-voice" id="voice-btn"
                            onclick="startVoiceSearch()">üé§ ‡∏û‡∏π‡∏î‡πÄ‡∏•‡∏¢</button> <button class="btn btn-primary"
                            onclick="searchBooks('voice')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    </div>
                </div><!-- AI Chat Search -->
                <div id="ai-search" class="search-mode" style="display: none;">
                    <div class="ai-chat-container" id="ai-chat"></div>
                    <div class="search-input-container"><input type="text" id="ai-search-input" class="search-input"
                            placeholder="‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏±‡∏ö AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." onkeypress="handleAIEnterKey(event)"> <button
                            class="btn btn-voice" id="ai-voice-btn" onclick="startAIVoice()">üé§</button> <button
                            class="btn btn-primary" onclick="sendAIMessage()">‡∏™‡πà‡∏á</button>
                    </div>
                </div>
            </div><!-- Results Container -->
            <div class="results-container" id="results-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #667eea; margin: 0;">üìñ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2><button class="btn btn-voice"
                        onclick="speakResults()">üîä ‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
                </div>
                <div id="results-content"></div>
            </div><!-- News Section -->
            <div class="news-section" id="news-section">
                <h2>üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
                <div class="news-slider-container">
                    <div class="news-slider-wrapper">
                        <div class="news-slider-track" id="news-slider-track"></div>
                    </div>
                    <div class="slider-controls" id="news-slider-controls" style="display: none;"><button
                            class="slider-btn" id="news-prev-btn" onclick="newsSliderPrev()">‚Äπ</button>
                        <div class="slider-dots" id="news-slider-dots"></div><button class="slider-btn"
                            id="news-next-btn" onclick="newsSliderNext()">‚Ä∫</button>
                    </div>
                </div>
            </div><!-- Stats Section -->
            <div class="stats-section">
                <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                <div class="top-list">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üèÜ TOP 5 ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                    <div id="top-books"></div>
                </div>
                <div class="top-list">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìö TOP 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                    <div id="top-categories"></div>
                </div>
            </div>
        </div>
    </div><!-- Admin Interface -->
    <div id="admin-container" class="admin-container">
        <div class="container">
            <header class="header">
                <h1>üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</h1>
                <p>Admin Dashboard</p><button class="btn btn-danger" onclick="handleLogout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </header>
            <nav class="admin-nav">
                <div class="nav-buttons"><button class="nav-btn active" onclick="switchAdminSection('books')">üìñ
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <button class="nav-btn" onclick="switchAdminSection('students')">üë®‚Äçüéì
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button> <button class="nav-btn" onclick="switchAdminSection('borrow')">üìö
                        ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <button class="nav-btn" onclick="switchAdminSection('news')">üì∞
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button> <button class="nav-btn" onclick="switchAdminSection('stats')">üìä
                        ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
                </div>
            </nav><!-- Books Management -->
            <section id="admin-books-section" class="content-section active">
                <div class="card">
                    <h2>üìñ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
                    <div id="books-alert"></div><!-- Add Book Form -->
                    <form id="book-form" onsubmit="addBook(event)">
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div class="form-group"><label for="book-call-number">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label> <input
                                    type="text" id="book-call-number" class="form-control"
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 808.3 ‡∏™123‡∏Å" required>
                            </div>
                            <div class="form-group"><label for="book-title">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label> <input type="text"
                                    id="book-title" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" required>
                            </div>
                            <div class="form-group"><label for="book-author">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</label> <input type="text"
                                    id="book-author" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á" required>
                            </div>
                            <div class="form-group"><label for="book-category">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label> <input type="text"
                                    id="book-category" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢, ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"
                                    required>
                            </div>
                            <div class="form-group"><label for="book-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏•‡πà‡∏°</label> <input type="number"
                                    id="book-quantity" class="form-control" min="1" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏•‡πà‡∏°"
                                    required>
                            </div>
                        </div>
                        <div class="form-group"><label for="book-abstract">‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠</label> <textarea id="book-abstract"
                                class="form-control" rows="3" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                        </div>
                        <div style="display: flex; gap: 10px;"><button type="submit"
                                class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <label class="btn btn-success"
                                style="margin: 0; cursor: pointer;"> üìÅ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î Excel <input type="file"
                                    id="excel-upload" accept=".xlsx,.xls" onchange="handleExcelUpload(event)"
                                    style="display: none;"> </label>
                        </div>
                    </form><!-- Search and Filter -->
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á</h3>
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <input type="text" id="filter-search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."
                                oninput="filterBooks()"> <select id="filter-category" class="form-control"
                                onchange="filterBooks()">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                            </select> <select id="sort-by" class="form-control" onchange="sortBooks()">
                                <option value="title">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠</option>
                                <option value="borrowed">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏¢‡∏∑‡∏°</option>
                                <option value="available">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</option>
                                <option value="category">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î</option>
                            </select>
                        </div>
                    </div><!-- Books Table -->
                    <div class="table-container">
                        <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th>
                                    <th>‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</th>
                                    <th>‡∏´‡∏°‡∏ß‡∏î</th>
                                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                    <th>‡∏¢‡∏∑‡∏°</th>
                                    <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="books-table">
                                <tr>
                                    <td colspan="8" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section><!-- Students Management -->
            <section id="admin-students-section" class="content-section">
                <div class="card">
                    <h2>üë®‚Äçüéì ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <div id="students-alert"></div><!-- Add Student Form -->
                    <form id="student-form" onsubmit="addStudent(event)">
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div class="form-group"><label for="student-id">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input type="text"
                                    id="student-id" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6501234567" required>
                            </div>
                            <div class="form-group"><label for="student-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input type="text"
                                    id="student-name" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                            </div>
                            <div class="form-group"><label for="student-department">‡πÅ‡∏ú‡∏ô‡∏Å</label> <select
                                    id="student-department" class="form-control" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å --</option>
                                    <option value="‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                                    <option value="‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå">‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</option>
                                    <option value="‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
                                    <option value="‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå">‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå</option>
                                    <option value="‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á">‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
                                    <option value="‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                                    <option value="‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î">‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î</option>
                                    <option value="‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°">‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°</option>
                                    <option value="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</option>
                                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;"><button type="submit"
                                class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button> <label class="btn btn-success"
                                style="margin: 0; cursor: pointer;"> üìÅ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå Excel <input type="file"
                                    id="student-excel-upload" accept=".xlsx,.xls"
                                    onchange="handleStudentExcelUpload(event)" style="display: none;"> </label>
                        </div>
                    </form><!-- Search Student -->
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3><input type="text"
                            id="filter-student" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤..."
                            oninput="filterStudents()">
                    </div><!-- Students Table -->
                    <div class="table-container">
                        <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                    <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="students-table">
                                <tr>
                                    <td colspan="5" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section><!-- Borrow/Return Management -->
            <section id="admin-borrow-section" class="content-section">
                <div class="card">
                    <h2>üìö ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
                    <div id="borrow-alert"></div><!-- Borrow Form -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üìñ ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h3>
                        <form id="borrow-form" onsubmit="borrowBooks(event)">
                            <div class="form-group"><label for="borrow-student-id">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input
                                    type="text" id="borrow-student-id" class="form-control"
                                    placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤" required>
                                <div id="student-info"
                                    style="margin-top: 10px; padding: 10px; background: white; border-radius: 8px; display: none;">
                                    <strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> <span id="student-name-display"></span>
                                </div>
                            </div>
                            <div class="form-group"><label for="borrow-book-select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label> <select
                                    id="borrow-book-select" class="form-control">
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ --</option>
                                </select>
                            </div>
                            <div class="form-group"><label for="borrow-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (‡πÄ‡∏•‡πà‡∏°)</label>
                                <input type="number" id="borrow-quantity" class="form-control" min="1" value="1"
                                    placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                            </div><button type="button" class="btn btn-success"
                                onclick="addBookToBorrowList()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
                            <div id="selected-books-list" style="margin-top: 15px;"></div><button type="submit"
                                class="btn btn-primary" style="margin-top: 15px;">‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
                        </form>
                    </div><!-- Return Form -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 20px;">üì• ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h3>
                        <div class="form-group"><label for="return-student-id">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input type="text"
                                id="return-student-id" class="form-control"
                                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°" oninput="loadBorrowedBooks()">
                        </div>
                        <div id="borrowed-books-list"></div>
                    </div><!-- Borrow History Table -->
                    <div class="table-container">
                        <h3 style="margin-bottom: 15px; color: #667eea;">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h3>
                        <div style="margin-bottom: 15px;"><select id="filter-borrow-status" class="form-control"
                                style="max-width: 300px;" onchange="filterBorrowHistory()">
                                <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà">‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà</option>
                                <option value="‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î">‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option>
                            </select>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="borrow-history-table">
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section><!-- News Management -->
            <section id="admin-news-section" class="content-section">
                <div class="card">
                    <h2>üì∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h2>
                    <div id="news-alert"></div>
                    <form id="news-form" onsubmit="addNews(event)">
                        <div class="form-group"><label for="news-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label> <input type="text"
                                id="news-title" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß" required>
                        </div>
                        <div class="form-group"><label for="news-content">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß</label> <textarea
                                id="news-content" class="form-control" rows="4" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß"
                                required></textarea>
                        </div>
                        <div class="form-group"><label for="news-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡πà‡∏≤‡∏ß</label> <input type="file"
                                id="news-image" class="form-control" accept="image/*" required>
                            <div id="news-image-preview" style="margin-top: 10px;"></div>
                        </div><button type="submit" class="btn btn-primary" id="news-submit-btn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß</button>
                    </form>
                    <div class="table-container">
                        <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                    <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                                    <th>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th>‡πÅ‡∏™‡∏î‡∏á</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="admin-news-table">
                                <tr>
                                    <td colspan="6" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section><!-- Admin Stats -->
            <section id="admin-stats-section" class="content-section">
                <div class="card">
                    <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="admin-total-books">0</h3>
                            <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="admin-total-borrowed">0</h3>
                            <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÑ‡∏õ</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="admin-total-available">0</h3>
                            <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div><!-- Edit Book Modal -->
    <div id="edit-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
        <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 20px; padding: 30px;">
            <h2 style="color: #667eea; margin-bottom: 20px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
            <form id="edit-book-form" onsubmit="saveEditBook(event)"><input type="hidden" id="edit-book-id">
                <div class="form-group"><label for="edit-call-number">‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label> <input type="text"
                        id="edit-call-number" class="form-control" required>
                </div>
                <div class="form-group"><label for="edit-title">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label> <input type="text" id="edit-title"
                        class="form-control" required>
                </div>
                <div class="form-group"><label for="edit-author">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</label> <input type="text" id="edit-author"
                        class="form-control" required>
                </div>
                <div class="form-group"><label for="edit-category">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label> <input type="text"
                        id="edit-category" class="form-control" required>
                </div>
                <div class="form-group"><label for="edit-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏•‡πà‡∏°</label> <input type="number"
                        id="edit-quantity" class="form-control" min="1" required>
                </div>
                <div class="form-group"><label for="edit-borrowed">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</label> <input type="number"
                        id="edit-borrowed" class="form-control" min="0" required>
                </div>
                <div class="form-group"><label for="edit-abstract">‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠</label> <textarea id="edit-abstract"
                        class="form-control" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px;"><button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn btn-danger" onclick="closeEditModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div><!-- Edit Student Modal -->
    <div id="edit-student-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
        <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 20px; padding: 30px;">
            <h2 style="color: #667eea; margin-bottom: 20px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h2>
            <form id="edit-student-form" onsubmit="saveEditStudent(event)"><input type="hidden"
                    id="edit-student-doc-id">
                <div class="form-group"><label for="edit-student-id">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input type="text"
                        id="edit-student-id" class="form-control" required>
                </div>
                <div class="form-group"><label for="edit-student-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input type="text"
                        id="edit-student-name" class="form-control" required>
                </div>
                <div class="form-group"><label for="edit-student-department">‡πÅ‡∏ú‡∏ô‡∏Å</label> <select
                        id="edit-student-department" class="form-control" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å --</option>
                        <option value="‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                        <option value="‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå">‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</option>
                        <option value="‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
                        <option value="‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå">‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå</option>
                        <option value="‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á">‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
                        <option value="‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                        <option value="‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î">‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î</option>
                        <option value="‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°">‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°</option>
                        <option value="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</option>
                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px;"><button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn btn-danger" onclick="closeEditStudentModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div><!-- Edit Borrow Status Modal -->
    <div id="edit-borrow-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
        <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 20px; padding: 30px;">
            <h2 style="color: #667eea; margin-bottom: 20px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h2>
            <form id="edit-borrow-form" onsubmit="saveEditBorrowStatus(event)"><input type="hidden" id="edit-borrow-id">
                <div id="edit-borrow-info"
                    style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°:</strong>
                    <div style="margin-top: 10px; color: #666;">
                        <div>
                            <strong>‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</strong> <span id="edit-borrow-student"></span>
                        </div>
                        <div>
                            <strong>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠:</strong> <span id="edit-borrow-book"></span>
                        </div>
                        <div>
                            <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</strong> <span id="edit-borrow-date"></span>
                        </div>
                    </div>
                </div>
                <div class="form-group"><label for="edit-borrow-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label> <select id="edit-borrow-status"
                        class="form-control" required>
                        <option value="‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà">‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà</option>
                        <option value="‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                    </select>
                </div>
                <div class="form-group"><label for="edit-return-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô</label> <input type="date"
                        id="edit-return-date" class="form-control" required>
                </div>
                <div style="display: flex; gap: 10px;"><button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn btn-danger" onclick="closeEditBorrowModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBZTETR4YN1DQFww57n9h0UV0XT7IBUGLY",
            authDomain: "ai-library-assistant-3d45e.firebaseapp.com",
            projectId: "ai-library-assistant-3d45e",
            storageBucket: "ai-library-assistant-3d45e.firebasestorage.app",
            messagingSenderId: "266038692063",
            appId: "1:266038692063:web:8e5522d9a676e88f24816a",
            measurementId: "G-5W5LJQZVGH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Global Variables
        let books = [];
        let news = [];
        let filteredBooks = [];
        let students = [];
        let filteredStudents = [];
        let borrows = [];
        let filteredBorrows = [];
        let selectedBooksForBorrow = [];
        let currentSearchMode = 'text';
        let recognition = null;
        let synthesis = window.speechSynthesis;
        let isLoggedIn = false;
        let booksUnsubscribe = null;
        let newsUnsubscribe = null;
        let studentsUnsubscribe = null;
        let borrowsUnsubscribe = null;
        let searchLogs = [];

        // News Slider Variables
        let newsSliderIndex = 0;
        let newsSliderInterval = null;
        let studentNewsSliderIndex = 0;
        let studentNewsSliderInterval = null;

        // Enhanced Synonym Dictionary with better coverage
        const synonyms = {
            'ai': ['‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå', 'artificial intelligence', 'machine learning', 'deep learning', '‡πÄ‡∏≠‡πÑ‡∏≠', '‡πÄ‡∏≠.‡πÑ‡∏≠.'],
            '‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå': ['ai', 'artificial intelligence', 'machine learning', 'deep learning', '‡πÄ‡∏≠‡πÑ‡∏≠'],
            '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå': ['computer', '‡∏û‡∏µ‡∏ã‡∏µ', 'pc', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', '‡∏Ñ‡∏≠‡∏°', 'it', '‡πÑ‡∏≠‡∏ó‡∏µ'],
            '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°': ['program', 'software', '‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå', '‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô', 'application', 'app', '‡πÅ‡∏≠‡∏õ', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'coding', 'programming'],
            '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['science', '‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏ß‡∏¥‡∏ó‡∏¢‡πå', 'scientific'],
            '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['math', 'mathematics', '‡∏Ñ‡∏ì‡∏¥‡∏ï', '‡πÄ‡∏•‡∏Ç', 'mathematical'],
            '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['history', '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥', '‡∏≠‡∏î‡∏µ‡∏ï', 'historical'],
            '‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢': ['novel', 'fiction', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡πâ‡∏ô', 'story', '‡∏ô‡∏ß‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢'],
            '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û': ['health', 'wellness', '‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ', 'healthy'],
            '‡∏≠‡∏≤‡∏´‡∏≤‡∏£': ['food', 'cooking', '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô', '‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏Ñ‡∏£‡∏±‡∏ß', '‡∏™‡∏π‡∏ï‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£', 'recipe'],
            '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à': ['business', '‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤', '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à', 'economy', '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó', '‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£'],
            '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô': ['finance', '‡πÄ‡∏á‡∏¥‡∏ô', 'money', '‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô', 'investment', 'financial'],
            '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î': ['marketing', '‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤', 'advertising', '‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ó', 'promotion'],
            '‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤': ['psychology', '‡∏à‡∏¥‡∏ï‡πÉ‡∏à', 'mind', 'psychological', '‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤'],
            '‡∏®‡∏¥‡∏•‡∏õ‡∏∞': ['art', '‡∏®‡∏¥‡∏•‡∏õ‡πå', '‡∏á‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡∏∞', 'artistic', '‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô'],
            '‡∏î‡∏ô‡∏ï‡∏£‡∏µ': ['music', '‡πÄ‡∏û‡∏•‡∏á', 'song', 'musical', '‡∏ô‡∏±‡∏Å‡∏î‡∏ô‡∏ï‡∏£‡∏µ'],
            '‡∏Å‡∏µ‡∏¨‡∏≤': ['sport', 'sports', '‡∏Å‡∏≤‡∏£‡∏Å‡∏µ‡∏¨‡∏≤', 'exercise', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', 'fitness'],
            '‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß': ['travel', 'tourism', '‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', '‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', '‡∏ó‡∏±‡∏ß‡∏£‡πå', 'tour'],
            '‡∏†‡∏≤‡∏©‡∏≤': ['language', '‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®', 'foreign language', 'linguistic'],
            '‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': ['education', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 'study', 'learning', 'educational', '‡∏Ñ‡∏£‡∏π', 'teacher'],
            '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ': ['technology', 'tech', '‡πÄ‡∏ó‡∏Ñ', 'technological'],
            '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°': ['engineering', 'engineer', '‡∏ß‡∏¥‡∏®‡∏ß‡∏∞', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£'],
            '‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå': ['medicine', 'medical', '‡πÅ‡∏û‡∏ó‡∏¢‡πå', 'doctor', '‡∏´‡∏°‡∏≠', '‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å'],
            '‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢': ['law', 'legal', '‡∏Ç‡πâ‡∏≠‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢', '‡∏ó‡∏ô‡∏≤‡∏¢', 'lawyer'],
            '‡∏™‡∏±‡∏á‡∏Ñ‡∏°': ['society', 'social', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 'sociology'],
            '‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°': ['environment', 'environmental', '‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥', 'nature', 'ecology'],
            '‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô': ['energy', 'power', '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤', 'electricity', 'renewable'],
            '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô': ['writing', 'write', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ô‡∏±‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', 'writer'],
            '‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô': ['reading', 'read', '‡∏≠‡πà‡∏≤‡∏ô', '‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'],
            '‡πÄ‡∏î‡πá‡∏Å': ['children', 'kids', 'child', '‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô', 'youth', '‡πÄ‡∏î‡πá‡∏Å‡πÜ'],
            '‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà': ['adult', 'adults', 'grown-up', '‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà'],
            '‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß': ['family', 'families', '‡∏ö‡πâ‡∏≤‡∏ô', 'home', 'household'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å': ['love', 'romance', 'romantic', '‡πÇ‡∏£‡πÅ‡∏°‡∏ô‡∏ï‡∏¥‡∏Å', '‡∏£‡∏±‡∏Å'],
            '‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢': ['adventure', 'adventures', '‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢', 'adventurous'],
            '‡∏•‡∏∂‡∏Å‡∏•‡∏±‡∏ö': ['mystery', 'mysteries', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å‡∏•‡∏±‡∏ö', '‡∏™‡∏∑‡∏ö‡∏™‡∏ß‡∏ô', 'detective'],
            '‡∏™‡∏¢‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç': ['horror', 'scary', '‡∏ô‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ß', '‡∏ú‡∏µ', 'ghost', 'thriller'],
            '‡∏ï‡∏•‡∏Å': ['comedy', 'funny', 'humor', '‡∏Ç‡∏≥‡∏Ç‡∏±‡∏ô', '‡∏ï‡∏•‡∏Å‡∏Ç‡∏ö‡∏Ç‡∏±‡∏ô', 'humorous'],
            '‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï': ['life', 'living', '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï', 'lifestyle', 'biography'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à': ['success', 'successful', 'achievement', '‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'],
            '‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à': ['inspiration', 'inspire', 'motivate', 'motivation', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à', 'inspirational'],
            '‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥': ['leadership', 'leader', '‡∏ú‡∏π‡πâ‡∏ô‡∏≥', '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥'],
            '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£': ['management', 'manage', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', 'administration', '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£'],
            '‡∏ó‡∏±‡∏Å‡∏©‡∏∞': ['skill', 'skills', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ', 'ability', 'competency'],
            '‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£': ['communication', 'communicate', '‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£', 'communicative'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå': ['creativity', 'creative', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå', 'innovation', 'innovative'],
            '‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°': ['innovation', 'innovative', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà', '‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå'],
            '‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤': ['development', 'develop', '‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'improvement', 'developmental'],
            '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢': ['research', 'study', '‡∏ß‡∏¥‡∏à‡∏±‡∏¢', '‡∏®‡∏∂‡∏Å‡∏©‡∏≤', 'researcher'],
            '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': ['data', 'information', 'info', '‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®', 'database'],
            '‡∏£‡∏∞‡∏ö‡∏ö': ['system', 'systems', '‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢', 'network', 'systematic'],
            '‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï': ['internet', 'online', 'web', '‡πÄ‡∏ß‡πá‡∏ö', 'website', '‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå'],
            '‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•': ['social', 'social media', '‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢', 'facebook', 'twitter', 'instagram'],
            '‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û': ['photography', 'photo', '‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢', 'camera', 'photographer'],
            '‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠': ['video', 'videos', '‡∏Ñ‡∏•‡∏¥‡∏õ', 'clip', 'youtube'],
            '‡πÄ‡∏Å‡∏°': ['game', 'games', 'gaming', '‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°', 'gamer'],
            '‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô': ['cartoon', 'comics', 'manga', '‡∏°‡∏±‡∏á‡∏á‡∏∞', 'anime', '‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞'],
            '‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô': ['fashion', 'style', '‡∏™‡πÑ‡∏ï‡∏•‡πå', '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤', 'clothes', 'clothing'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°': ['beauty', 'beautiful', '‡∏™‡∏ß‡∏¢', 'cosmetic', 'makeup'],
            '‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö': ['design', 'designer', '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö', 'graphic', 'ui', 'ux'],
            '‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°': ['architecture', 'architect', '‡∏™‡∏ñ‡∏≤‡∏õ‡∏ô‡∏¥‡∏Å', 'building', 'architectural'],
            '‡∏ö‡πâ‡∏≤‡∏ô': ['home', 'house', 'housing', '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢', 'household'],
            '‡∏™‡∏ß‡∏ô': ['garden', 'gardening', '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ', 'plant', 'botanical'],
            '‡∏™‡∏±‡∏ï‡∏ß‡πå': ['animal', 'animals', 'pet', '‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', 'wildlife'],
            '‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥': ['nature', 'natural', 'environment', 'ecological'],
            '‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤': ['sky', 'space', '‡∏≠‡∏ß‡∏Å‡∏≤‡∏®', '‡∏î‡∏≤‡∏£‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 'astronomy', 'astronaut'],
            '‡∏ó‡∏∞‡πÄ‡∏•': ['sea', 'ocean', 'marine', 'beach', '‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î', 'coastal'],
            '‡∏†‡∏π‡πÄ‡∏Ç‡∏≤': ['mountain', 'mountains', 'hill', '‡πÄ‡∏Ç‡∏≤', 'hiking'],
            '‡∏õ‡πà‡∏≤': ['forest', 'jungle', 'woods', '‡∏õ‡πà‡∏≤‡πÑ‡∏°‡πâ', 'rainforest'],
            '‡πÄ‡∏°‡∏∑‡∏≠‡∏á': ['city', 'urban', 'town', '‡∏ä‡∏∏‡∏°‡∏ä‡∏ô', 'metropolitan'],
            '‡∏ä‡∏ô‡∏ö‡∏ó': ['rural', 'countryside', 'village', '‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô'],
            '‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°': ['culture', 'cultural', '‡∏õ‡∏£‡∏∞‡πÄ‡∏û‡∏ì‡∏µ', 'tradition', 'traditional'],
            '‡∏®‡∏≤‡∏™‡∏ô‡∏≤': ['religion', 'religious', 'faith', '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠', 'spiritual'],
            '‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤': ['philosophy', 'philosophical', '‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤', 'philosopher'],
            '‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°': ['ethics', 'ethical', 'moral', '‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°', 'morality'],
            '‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á': ['politics', 'political', 'government', '‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•', 'politician'],
            '‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°': ['war', 'warfare', 'battle', '‡∏¢‡∏∏‡∏ó‡∏ò‡πå', 'military'],
            '‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏†‡∏≤‡∏û': ['peace', 'peaceful', 'harmony', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏á‡∏ö'],
            '‡∏°‡∏¥‡∏ï‡∏£‡∏†‡∏≤‡∏û': ['friendship', 'friend', '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô', '‡∏°‡∏¥‡∏ï‡∏£', 'buddy'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç': ['happiness', 'happy', 'joy', '‡∏™‡∏∏‡∏Ç', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏î‡∏µ', 'joyful'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤': ['sadness', 'sad', 'sorrow', '‡πÄ‡∏®‡∏£‡πâ‡∏≤', '‡∏ó‡∏∏‡∏Å‡∏Ç‡πå', 'grief'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ß': ['fear', 'afraid', 'scared', '‡∏Å‡∏•‡∏±‡∏ß', 'fearful'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Å‡∏£‡∏ò': ['anger', 'angry', 'mad', '‡πÇ‡∏Å‡∏£‡∏ò', 'furious'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á': ['hope', 'hopeful', '‡∏´‡∏ß‡∏±‡∏á', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∏‡πà‡∏á‡∏´‡∏ß‡∏±‡∏á', 'optimism'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô': ['dream', 'dreams', '‡∏ù‡∏±‡∏ô', '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ù‡πà‡∏ù‡∏±‡∏ô', 'aspiration'],
            '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢': ['goal', 'goals', 'target', 'objective', '‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå', 'aim'],
            '‡πÅ‡∏ú‡∏ô': ['plan', 'planning', 'strategy', '‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå', 'strategic'],
            '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£': ['project', 'projects', 'program', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'initiative'],
            '‡∏á‡∏≤‡∏ô': ['work', 'job', 'career', '‡∏≠‡∏≤‡∏ä‡∏µ‡∏û', 'profession', 'employment'],
            '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': ['salary', 'wage', 'income', '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ', 'compensation'],
            '‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô': ['investment', 'invest', '‡∏•‡∏á‡∏ó‡∏∏‡∏ô', '‡∏´‡∏∏‡πâ‡∏ô', 'stock', 'investor'],
            '‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£': ['bank', 'banking', 'financial institution', 'banker'],
            '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô': ['insurance', 'insure', '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢', 'coverage'],
            '‡∏†‡∏≤‡∏©‡∏µ': ['tax', 'taxes', 'taxation', '‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£', 'revenue'],
            '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ': ['accounting', 'account', 'accounts', '‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', 'accountant'],
            '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢': ['sales', 'selling', 'sell', '‡∏Ç‡∏≤‡∏¢', 'salesperson'],
            '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤': ['customer', 'customers', 'client', 'clients', 'consumer'],
            '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£': ['service', 'services', '‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', 'customer service'],
            '‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û': ['quality', 'qualities', '‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô', 'standard', 'excellence'],
            '‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û': ['efficiency', 'efficient', 'effectiveness', '‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏ú‡∏•', 'productive'],
            '‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô': ['competition', 'competitive', 'compete', '‡πÅ‡∏Ç‡πà‡∏á', 'contest'],
            '‡∏ó‡∏µ‡∏°': ['team', 'teams', 'teamwork', '‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°', 'collaboration'],
            '‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£': ['organization', 'company', 'corporation', '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó', 'enterprise'],
            '‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£': ['entrepreneur', 'entrepreneurship', 'startup', 'business owner'],
            '‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô': ['startup', 'start', 'beginning', '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', 'launch'],
            '‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï': ['growth', 'grow', 'growing', '‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï', '‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'expansion'],
            '‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î': ['library', 'reading room', 'book room', '‡∏Ñ‡∏•‡∏±‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏´‡πâ‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'],
            '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠': ['book', 'books', '‡πÄ‡∏•‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ï‡∏≥‡∏£‡∏≤', '‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°'],
            '‡∏≠‡πà‡∏≤‡∏ô': ['read', 'reading', 'study', 'review', '‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô'],
            '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô': ['write', 'writing', 'compose', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°', '‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'],
            '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ': ['learning', 'study', 'education', '‡∏®‡∏∂‡∏Å‡∏©‡∏≤', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á'],
            'AI chatbot': ['‡πÄ‡∏≠‡πÑ‡∏≠‡πÅ‡∏ä‡∏ó', 'chatbot', '‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó', 'bot', '‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞'],
            '‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ä‡∏ó': ['video chat', '‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠‡∏Ñ‡∏≠‡∏•', 'video call', '‡∏Ñ‡∏≠‡∏•‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠', '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå'],
            '‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå': ['online meeting', 'meeting', 'conference', '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏™‡∏°‡∏∑‡∏≠‡∏ô', 'webinar'],
            '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®': ['information technology', 'IT', '‡πÑ‡∏≠‡∏ó‡∏µ', 'computer technology'],
            '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': ['data analysis', 'analytics', 'data processing', 'data science'],
            '‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå': ['generative AI', 'AI creation', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏î‡πâ‡∏ß‡∏¢ AI'],
            '‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå': ['robot', 'robotics', 'automation', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'],
            '‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü': ['interactive', 'interactive media', '‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö', 'interactive system'],
            '‡πÄ‡∏Å‡∏°‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': ['educational games', 'serious games', 'learning games'],
            '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á': ['audiobook', 'audio book', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ü‡∏±‡∏á', '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'],
            '‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå': ['online learning', 'e-learning', '‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏•', 'distance education'],
            '‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå': ['online course', 'course', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå', 'e-course'],
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á': ['entertainment', 'fun', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å', '‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô', 'leisure'],
            '‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£': ['news', 'information', 'updates', '‡∏Ç‡πà‡∏≤‡∏ß', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£'],
            '‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°': ['article', 'essay', 'paper', '‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£', '‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå'],
            '‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á': ['experiment', 'trial', 'research experiment', '‡∏ó‡∏î‡∏™‡∏≠‡∏ö'],
            '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå': ['device', 'equipment', 'tool', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠', 'gadgets'],
            '‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå': ['software', 'application', 'app', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'],
            '‡∏Æ‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ß‡∏£‡πå': ['hardware', 'computer hardware', '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå']
        };

        // Smart Keyword Extraction Function
        function extractSmartKeywords(query) {
            // Remove common stop words (expanded list)
            const stopWords = [// ‡∏Ñ‡∏≥‡πÑ‡∏ó‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                '‡∏°‡∏µ', '‡∏Ñ‡∏∑‡∏≠', '‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏Ñ‡πà‡∏∞', '‡∏ú‡∏°', '‡∏â‡∏±‡∏ô', '‡∏î‡∏¥‡∏â‡∏±‡∏ô', '‡πÄ‡∏£‡∏≤', '‡∏Ç‡∏≠‡∏á', '‡πÉ‡∏ô', '‡∏ó‡∏µ‡πà', '‡∏à‡∏∞', '‡πÑ‡∏î‡πâ', '‡∏î‡πâ‡∏ß‡∏¢',
                '‡πÅ‡∏•‡∏∞', '‡∏´‡∏£‡∏∑‡∏≠', '‡πÅ‡∏ï‡πà', '‡∏Å‡πá', '‡∏ß‡πà‡∏≤', '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö', '‡πÇ‡∏î‡∏¢', '‡∏Å‡∏±‡∏ö', '‡πÑ‡∏õ', '‡∏°‡∏≤', '‡∏≠‡∏¢‡∏π‡πà', '‡∏¢‡∏±‡∏á', '‡πÄ‡∏•‡∏¢', '‡∏ô‡∏µ‡πà', '‡∏ô‡∏∞',
                '‡∏î‡πâ‡∏ß‡∏¢', '‡πÄ‡∏≠‡∏≤', '‡πÅ‡∏ö‡∏ö', '‡∏ó‡∏≥', '‡∏Ñ‡πà‡∏∞‡∏î‡∏¥‡∏â‡∏±‡∏ô', '‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏°', '‡∏à‡πâ‡∏≤', '‡πÄ‡∏≠‡∏á', '‡πÄ‡∏•‡∏¢‡∏ô‡∏∞', '‡∏ó‡∏µ', '‡∏≠‡∏∑‡πà‡∏ô', '‡∏ó‡∏∏‡∏Å', '‡∏ö‡∏≤‡∏á',
                '‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á', '‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö', '‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞', '‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏°', '‡∏Ñ‡πà‡∏∞‡∏î‡∏¥‡∏â‡∏±‡∏ô', '‡∏ó‡∏±‡πâ‡∏á', '‡πÄ‡∏û‡∏£‡∏≤‡∏∞', '‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å', '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤',
                '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏î‡πâ‡∏≤‡∏ô', '‡∏ó‡∏≤‡∏á', '‡∏ö‡πâ‡∏≤‡∏á', '‡∏≠‡∏∞‡πÑ‡∏£', '‡πÑ‡∏´‡∏ô', '‡∏ó‡∏≥‡πÑ‡∏°', '‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£', '‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡∏Ç‡∏≠', '‡∏ä‡πà‡∏ß‡∏¢', '‡∏´‡∏ô‡πà‡∏≠‡∏¢', '‡πÉ‡∏´‡πâ',
                '‡∏≠‡∏¢‡∏≤‡∏Å', '‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ', '‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤', '‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏≠‡∏Å', '‡∏ö‡∏≠‡∏Å', '‡∏£‡∏π‡πâ', '‡∏ß‡πà‡∏≤', '‡πÅ‡∏ï‡πà‡∏á', '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô',
                '‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á', '‡∏°‡∏µ‡πÑ‡∏´‡∏°', '‡∏°‡∏µ‡∏ö‡πâ‡∏≤‡∏á', '‡∏ä‡∏∑‡πà‡∏≠', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÅ‡∏ô‡∏ß', '‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á', '‡∏´‡∏°‡∏ß‡∏î', '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠', '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                '‡πÄ‡∏•‡∏¢‡∏à‡πâ‡∏≤', '‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏∞', '‡∏à‡∏£‡∏¥‡∏á‡πÜ', '‡∏Ñ‡πà‡∏∞', '‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞', '‡∏î‡∏¥‡∏â‡∏±‡∏ô/‡∏ú‡∏°', '‡∏Ñ‡∏£‡∏±‡∏ö/‡∏ú‡∏°', '‡πÄ‡∏•‡∏¢‡∏ô‡∏∞', '‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞', '‡∏Ñ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏¢',
                '‡∏ô‡∏∞‡∏Ñ‡∏∞', '‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö', '‡∏à‡πä‡∏∞', '‡∏à‡πâ‡∏∞', '‡∏≠‡∏∞', '‡∏≠‡πà‡∏∞', '‡∏ô‡∏µ‡πà‡∏ô‡∏∞', '‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ', '‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá', '‡πÉ‡∏Ñ‡∏£', '‡πÄ‡∏°‡∏∑‡πà‡∏≠', '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô', '‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ',
                '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ', '‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ', '‡∏ó‡∏±‡∏ô‡∏ó‡∏µ', '‡πÄ‡∏•‡∏¢', '‡πÅ‡∏•‡πâ‡∏ß', '‡∏Å‡πà‡∏≠‡∏ô', '‡∏´‡∏•‡∏±‡∏á', '‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô', '‡∏ö‡∏≤‡∏á‡∏ß‡∏±‡∏ô', '‡∏Ñ‡∏£‡∏±‡πâ‡∏á', '‡∏ï‡πà‡∏≠', '‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì',
                '‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô', '‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏â‡∏∞‡∏ô‡∏±‡πâ‡∏ô', '‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å', '‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á', '‡πÄ‡∏û‡∏∑‡πà‡∏≠', '‡πÄ‡∏õ‡πá‡∏ô', '‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ', '‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà',
                '‡πÑ‡∏°‡πà‡∏°‡∏µ', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', '‡∏Å‡πá‡πÑ‡∏î‡πâ', '‡∏Å‡πá‡πÑ‡∏°‡πà', '‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', '‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤', '‡πÉ‡∏ä‡πà', '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà', '‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£', '‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á', '‡∏ö‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢', '‡∏î‡∏π', '‡∏¢‡∏∑‡∏°', '‡∏≠‡πà‡∏≤‡∏ô',
                '‡∏ü‡∏±‡∏á', '‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á', '‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á', '‡πÄ‡∏•‡πà‡∏ô', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ', '‡∏®‡∏∂‡∏Å‡∏©', '‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°', '‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
                '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', '‡∏Ñ‡πâ‡∏ô', '‡∏´‡∏≤', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡∏™‡∏ô‡πÉ‡∏à', '‡∏™‡∏ô‡πÉ‡∏à‡πÉ‡∏ô', '‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏î‡πâ‡∏≤‡∏ô', '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠', '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á',
                '‡πÅ‡∏á‡πà', '‡πÄ‡∏ä‡πà‡∏ô', '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô', '‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô', '‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡∏≠‡∏∑‡πà‡∏ô', '‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á', '‡∏£‡∏ß‡∏°', '‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô', '‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô',
                '‡∏û‡∏£‡πâ‡∏≠‡∏°', '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô', '‡∏Å‡∏±‡∏ô', '‡∏ñ‡∏∂‡∏á', '‡∏ñ‡∏∂‡∏á‡πÅ‡∏°‡πâ', '‡πÅ‡∏°‡πâ', '‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤', '‡πÅ‡∏ï‡πà‡∏•‡∏∞', '‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô', '‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà', '‡∏™‡πà‡∏ß‡∏ô', '‡∏ó‡∏∏‡∏Å‡∏™‡πà‡∏ß‡∏ô', '‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô',
                '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô', '‡πÉ‡∏Ñ‡∏£', '‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ', '‡πÉ‡∏Ñ‡∏£‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô', '‡πÉ‡∏Ñ‡∏£‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô', '‡∏≠‡∏∞‡πÑ‡∏£', '‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á', '‡∏ï‡∏ô‡πÄ‡∏≠‡∏á', '‡∏ï‡∏±‡∏ß', '‡∏ï‡∏ô', '‡∏≠‡∏µ‡∏Å', '‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', '‡∏≠‡∏µ‡∏Å‡∏°‡∏≤‡∏Å', '‡∏°‡∏≤‡∏Å', '‡∏ô‡πâ‡∏≠‡∏¢',
                '‡∏ô‡∏¥‡∏î', '‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢', '‡πÉ‡∏´‡∏ç‡πà', '‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å', '‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î', '‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î', '‡∏™‡∏∏‡∏î', '‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢', '‡∏ó‡πâ‡∏≤‡∏¢', '‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤', '‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å', '‡∏´‡∏•‡∏±‡∏á', '‡∏ï‡πà‡∏≠‡πÑ‡∏õ', '‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á', '‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á', '‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å',

                // ‡∏Ñ‡∏≥‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                'the', 'a', 'an', 'on', 'in', 'at', 'for', 'of', 'to', 'with', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had',
                'do', 'does', 'did', 'will', 'would', 'can', 'could', 'may', 'might', 'must', 'shall', 'should', 'I', 'you', 'he', 'she', 'it', 'we', 'they', 'this', 'that',
                'these', 'those', 'there', 'here', 'then', 'when', 'where', 'why', 'how', 'all', 'any', 'some', 'many', 'much', 'more', 'most', 'other', 'others', 'such', 'no', 'not',
                'none', 'each', 'every', 'both', 'either', 'neither', 'few', 'several', 'one', 'two', 'three', 'first', 'second', 'last', 'next', 'after', 'before', 'about', 'above',
                'below', 'under', 'over', 'again', 'once', 'always', 'never', 'sometimes', 'often', 'usually', 'rarely', 'very', 'really', 'just', 'also', 'even', 'only', 'already',
                'still', 'yet', 'almost', 'nearly', 'quite', 'perhaps', 'maybe', 'probably', 'possible', 'impossible', 'could', 'would', 'should', 'might', 'must', 'shall', 'let', 'let\'s',
                'yes', 'no', 'ok', 'okay', 'please', 'thanks', 'thank', 'welcome', 'hi', 'hello', 'hey', 'good', 'bad', 'best', 'better', 'worst', 'worse', 'much', 'many'];

            // Known important keywords (in lowercase)
            const knownKeywords = [
                // ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå
                'machine learning', 'deep learning', 'data science', 'artificial intelligence', 'ai',
                'python', 'java', 'javascript', 'php', 'sql', 'html', 'css', 'c++', 'c#',
                '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', '‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'software', 'coding', 'programming',
                'science', '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 'mathematics', '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥', 'statistics', 'development',
                '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', 'technology', 'engineering', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°', 'architecture', '‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°', 'design', '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö',
                'robotics', '‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå', 'internet', '‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï', 'web', '‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå', 'database', '‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',

                // ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', 'business', '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î', 'marketing', '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', 'sales', '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', 'finance',
                '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', 'accounting', 'management', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', 'startup', '‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£',
                'economics', '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 'entrepreneur', '‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£', 'leadership', '‡∏ú‡∏π‡πâ‡∏ô‡∏≥',
                'project management', '‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', 'strategy', '‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå', 'innovation', '‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°',

                // ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏©‡∏≤
                '‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', 'education', '‡∏Ñ‡∏£‡∏π', '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 'study', 'learning', '‡∏†‡∏≤‡∏©‡∏≤', 'language',
                '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', 'English', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', 'Thai', 'linguistics', '‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô', 'reading', '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', 'writing',
                '‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£', 'communication', 'writing skills', 'reading skills', 'critical thinking', '‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå',

                // ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏µ‡∏¨‡∏≤
                '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', 'health', '‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£', 'nutrition', '‡∏≠‡∏≤‡∏´‡∏≤‡∏£', 'cooking', 'exercise', '‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', 'fitness',
                '‡πÇ‡∏¢‡∏Ñ‡∏∞', 'yoga', 'meditation', '‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏™‡∏°‡∏≤‡∏ò‡∏¥', '‡πÅ‡∏û‡∏ó‡∏¢‡πå', 'medical', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•', 'nursing',
                '‡πÄ‡∏†‡∏™‡∏±‡∏ä', 'pharmacy', '‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå', 'dental', 'mental health', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï', 'wellness',

                // ‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á
                '‡∏®‡∏¥‡∏•‡∏õ‡∏∞', 'art', 'painting', '‡∏†‡∏≤‡∏û‡∏ß‡∏≤‡∏î', '‡∏î‡∏ô‡∏ï‡∏£‡∏µ', 'music', '‡∏ô‡∏±‡∏Å‡∏î‡∏ô‡∏ï‡∏£‡∏µ', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ',
                '‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á', '‡∏•‡∏∞‡∏Ñ‡∏£', '‡∏•‡∏∞‡∏Ñ‡∏£‡πÄ‡∏ß‡∏ó‡∏µ', '‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå', 'movie', 'film', 'animation', '‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞', 'anime',
                '‡∏°‡∏±‡∏á‡∏á‡∏∞', 'manga', '‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô', 'fashion', '‡∏ö‡∏¥‡∏ß‡∏ï‡∏µ‡πâ', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°', 'makeup', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏≠‡∏≤‡∏á',
                'skincare', '‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡πâ‡∏≤', '‡∏ú‡∏¥‡∏ß‡∏Å‡∏≤‡∏¢', 'hairstyle', '‡∏ó‡∏£‡∏á‡∏ú‡∏°', 'nail', '‡πÄ‡∏•‡πá‡∏ö', 'nail art',

                // ‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°
                '‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°', 'literature', '‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢', 'novel', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡πâ‡∏ô', 'short story', '‡πÅ‡∏ü‡∏ô‡∏ï‡∏≤‡∏ã‡∏µ', 'fantasy',
                '‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢', 'adventure', '‡∏•‡∏∂‡∏Å‡∏•‡∏±‡∏ö', 'mystery', '‡∏™‡∏¢‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç', 'horror', '‡∏ï‡∏•‡∏Å', 'comedy',
                '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å', 'romance', 'biography', '‡∏ä‡∏µ‡∏ß‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥', 'poetry', '‡∏ö‡∏ó‡∏Å‡∏ß‡∏µ', 'historical fiction',

                // ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå
                '‡∏™‡∏±‡∏á‡∏Ñ‡∏°', 'social', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', 'sociology', '‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°', 'culture', '‡∏õ‡∏£‡∏∞‡πÄ‡∏û‡∏ì‡∏µ', 'tradition',
                '‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á', 'politics', '‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•', 'government', '‡∏ä‡∏≤‡∏ï‡∏¥‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', 'ethnology', '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£', 'demography',
                '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 'history', '‡πÇ‡∏ö‡∏£‡∏≤‡∏ì‡∏Ñ‡∏î‡∏µ', 'archaeology', '‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç', 'historical events',

                // ‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à
                'AI ethics', '‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏° AI', 'cloud computing', '‡∏Ñ‡∏•‡∏≤‡∏ß‡∏î‡πå', 'big data', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà',
                'cybersecurity', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå', 'blockchain', '‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ä‡∏ô', 'IoT', '‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏Ç‡∏≠‡∏á‡∏™‡∏£‡∏£‡∏û‡∏™‡∏¥‡πà‡∏á',
                'VR', 'virtual reality', 'AR', 'augmented reality', 'cryptocurrency', '‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•', '‡∏™‡∏±‡∏ï‡∏ß‡πå', 'animal', '‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥', 'nature'
            ];

            // Sort keywords by length (longest first) for better matching
            const sortedKeywords = knownKeywords.sort((a, b) => b.length - a.length);

            // Common phrases that often have words stuck to them
            const commonPhrases = [
                // ‡∏Ñ‡∏≥‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ
                '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏î‡πâ‡∏≤‡∏ô', '‡∏ó‡∏≤‡∏á', '‡πÅ‡∏•‡∏∞', '‡∏´‡∏£‡∏∑‡∏≠', '‡πÉ‡∏ô', '‡∏Ç‡∏≠‡∏á',
                '‡∏ö‡∏ô', '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö', '‡πÄ‡∏õ‡πá‡∏ô', '‡∏°‡∏µ', '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', '‡∏≠‡∏¢‡∏≤‡∏Å', '‡∏ä‡πà‡∏ß‡∏¢', '‡∏´‡∏ô‡πà‡∏≠‡∏¢', '‡πÉ‡∏´‡πâ', '‡∏â‡∏±‡∏ô', '‡∏ú‡∏°', '‡∏î‡∏¥‡∏â‡∏±‡∏ô',

                // ‡∏Ñ‡∏≥/‡∏ß‡∏•‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
                '‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á', '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏ß',
                '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏î', '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤', '‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏î‡∏¢', '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∑‡∏≠',
                '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á', '‡∏â‡∏±‡∏ô‡∏™‡∏ô‡πÉ‡∏à', '‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤', '‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ', '‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠',
                '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏ß', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡πÄ‡∏•‡πà‡∏°‡πÑ‡∏´‡∏ô', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°', '‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠',

                // ‡∏Ñ‡∏≥/‡∏ß‡∏•‡∏µ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
                'about', 'on', 'find books', 'recommend books', 'books by', 'show books', 'list books',
                'books in category', 'looking for', 'i want', 'please find', 'please recommend',

                // ‡∏ß‡∏•‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå
                '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏•‡πà‡∏°', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢', '‡∏°‡∏µ‡πÑ‡∏´‡∏°', '‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏≤‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°',
                '‡∏°‡∏µ‡πÄ‡∏•‡πà‡∏°‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á', '‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏π‡πâ', '‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥',
                '‡∏™‡∏ô‡πÉ‡∏à‡∏≠‡πà‡∏≤‡∏ô', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡πÄ‡∏•‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏ß',
                '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á', '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡πÅ‡∏ô‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ',

                // ‡∏ß‡∏•‡∏µ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ñ‡∏≤‡∏°‡∏ï‡∏≠‡∏ö
                '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏´‡∏°', '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô', '‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°', '‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°',
                '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡πÄ‡∏•‡πà‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà',
                '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°',

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö query ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°
                'looking for books', 'books about', 'books on', 'books by author', 'books in category',
                'recommended books', 'popular books', 'latest books', 'fiction books', 'non-fiction books',
                'children books', 'adult books', 'educational books', 'science books', 'history books'

            ];

            // Pre-process: Add spaces after common phrases
            let processedQuery = query;
            commonPhrases.forEach(phrase => {
                const regex = new RegExp(phrase + '([‡∏Å-‡πôa-zA-Z])', 'gi');
                processedQuery = processedQuery.replace(regex, phrase + ' $1');
            });

            // Extract multi-word keywords first
            let extractedKeywords = [];
            sortedKeywords.forEach(keyword => {
                if (processedQuery.toLowerCase().includes(keyword)) {
                    extractedKeywords.push(keyword);
                    // Remove matched keyword to avoid duplicate processing
                    processedQuery = processedQuery.replace(new RegExp(keyword, 'gi'), ' ');
                }
            });

            // Split remaining text into words
            let words = processedQuery.toLowerCase()
                .replace(/[^\u0E00-\u0E7Fa-zA-Z0-9\s]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 1 && !stopWords.includes(word));

            // Combine extracted keywords with remaining words
            extractedKeywords = [...extractedKeywords, ...words];

            // Expand with synonyms
            let expandedKeywords = [...extractedKeywords];
            extractedKeywords.forEach(keyword => {
                if (synonyms[keyword]) {
                    expandedKeywords.push(...synonyms[keyword]);
                }
            });

            return [...new Set(expandedKeywords)]; // Remove duplicates
        }

        // Data SDK Implementation
        const dataHandler = {
            onDataChanged(data) {
                searchLogs = data;
            }
        };

        // Initialize Data SDK
        async function initDataSDK() {
            try {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error('Failed to initialize Data SDK');
                }
            } catch (error) {
                console.error('Error initializing Data SDK:', error);
            }
        }

        // Log Search Query
        async function logSearch(query, resultsCount) {
            if (window.dataSdk && searchLogs.length < 999) {
                try {
                    await window.dataSdk.create({
                        query: query,
                        timestamp: new Date().toISOString(),
                        resultsCount: resultsCount
                    });
                } catch (error) {
                    console.error('Error logging search:', error);
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            initDataSDK();
            loadBooksRealtime();
            loadNewsRealtime();
            loadStudentsRealtime();
            loadBorrowsRealtime();
            initSpeechRecognition();
            initStudentSpeechRecognition();

            // Image preview for news
            const newsImageInput = document.getElementById('news-image');
            if (newsImageInput) {
                newsImageInput.addEventListener('change', function (e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (event) {
                            document.getElementById('news-image-preview').innerHTML = `
                                <img src="${event.target.result}" style="max-width: 400px; max-height: 200px; border-radius: 10px;">
                            `;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        });

        // Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'th-TH';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = function (event) {
                    const transcript = event.results[0][0].transcript;
                    if (currentSearchMode === 'voice') {
                        document.getElementById('voice-search-input').value = transcript;
                        document.getElementById('voice-btn').classList.remove('listening');
                    } else if (currentSearchMode === 'ai') {
                        document.getElementById('ai-search-input').value = transcript;
                        document.getElementById('ai-voice-btn').classList.remove('listening');
                    }
                };

                recognition.onerror = function (event) {
                    console.error('Speech recognition error:', event.error);
                    if (currentSearchMode === 'voice') {
                        document.getElementById('voice-btn').classList.remove('listening');
                    } else if (currentSearchMode === 'ai') {
                        document.getElementById('ai-voice-btn').classList.remove('listening');
                    }
                };

                recognition.onend = function () {
                    if (currentSearchMode === 'voice') {
                        document.getElementById('voice-btn').classList.remove('listening');
                    } else if (currentSearchMode === 'ai') {
                        document.getElementById('ai-voice-btn').classList.remove('listening');
                    }
                };
            }
        }

        function startVoiceSearch() {
            if (recognition) {
                document.getElementById('voice-btn').classList.add('listening');
                recognition.start();
            } else {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
            }
        }

        function startAIVoice() {
            if (recognition) {
                document.getElementById('ai-voice-btn').classList.add('listening');
                recognition.start();
            } else {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
            }
        }

        // Text-to-Speech
        function speakResults() {
            const resultsContent = document.getElementById('results-content');
            if (!resultsContent.innerHTML || resultsContent.innerHTML.includes('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠')) {
                speak('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
                return;
            }

            const bookCards = resultsContent.querySelectorAll('.book-card');
            if (bookCards.length === 0) {
                speak('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
                return;
            }

            let text = `‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${bookCards.length} ‡πÄ‡∏•‡πà‡∏° ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà `;
            bookCards.forEach((card, index) => {
                const title = card.querySelector('.book-title').textContent;
                const author = card.querySelector('.book-info-item:nth-child(1)').textContent.replace('üë§ ', '');
                text += `${index + 1}. ${title} ‡πÇ‡∏î‡∏¢ ${author}. `;
            });

            speak(text);
        }

        function speak(text) {
            if (synthesis.speaking) {
                synthesis.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'th-TH';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            synthesis.speak(utterance);
        }

        // Search Mode Switching
        function switchSearchMode(mode) {
            currentSearchMode = mode;

            // Update tabs
            document.querySelectorAll('.search-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Hide all search modes
            document.getElementById('text-search').style.display = 'none';
            document.getElementById('voice-search').style.display = 'none';
            document.getElementById('ai-search').style.display = 'none';

            // Show selected mode
            document.getElementById(mode + '-search').style.display = 'block';

            // Show/hide AI chat
            if (mode === 'ai') {
                document.getElementById('ai-chat').classList.add('active');
            } else {
                document.getElementById('ai-chat').classList.remove('active');
            }
        }

        // Handle Enter Key
        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                searchBooks('text');
            }
        }

        function handleAIEnterKey(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }

        // Smart Keyword Extraction (using the enhanced function)
        function extractKeywords(query) {
            return extractSmartKeywords(query);
        }

        // Format AI Response with better styling
        function formatAIResponse(response, results) {
            let formatted = response;

            // Add emojis for better visual appeal
            formatted = formatted.replace(/‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠/g, 'üìö ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠');
            formatted = formatted.replace(/‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥/g, 'üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥');
            formatted = formatted.replace(/‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©/g, 'üòî ‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©');
            formatted = formatted.replace(/‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°/g, '‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°');
            formatted = formatted.replace(/‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°/g, '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°');

            // Format book list with better structure
            if (results.length > 0) {
                const lines = formatted.split('\n');
                formatted = lines.map(line => {
                    // Check if line is a book item (starts with number)
                    if (/^\d+\./.test(line.trim())) {
                        return `<div class="book-item">${line}</div>`;
                    }
                    return line;
                }).join('\n');
            }

            return formatted;
        }

        // Search Algorithm with Scoring
        function searchBooks(mode) {
            let query = '';

            if (mode === 'text') {
                query = document.getElementById('text-search-input').value.trim();
            } else if (mode === 'voice') {
                query = document.getElementById('voice-search-input').value.trim();
            }

            if (!query) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
                return;
            }

            const keywords = extractKeywords(query);
            const results = [];

            books.forEach(book => {
                let score = 0;
                const searchText = `${book.title} ${book.author} ${book.category} ${book.callNumber || ''} ${book.abstract || ''}`.toLowerCase();

                keywords.forEach(keyword => {
                    if (searchText.includes(keyword)) {
                        // Title match = 5 points
                        if (book.title.toLowerCase().includes(keyword)) score += 5;
                        // Author match = 3 points
                        if (book.author.toLowerCase().includes(keyword)) score += 3;
                        // Category match = 4 points
                        if (book.category.toLowerCase().includes(keyword)) score += 4;
                        // Call number match = 2 points
                        if (book.callNumber && book.callNumber.toLowerCase().includes(keyword)) score += 2;
                        // Abstract match = 1 point
                        if (book.abstract && book.abstract.toLowerCase().includes(keyword)) score += 1;
                    }
                });

                if (score > 0) {
                    results.push({ ...book, score });
                }
            });

            // Sort by score (highest first)
            results.sort((a, b) => b.score - a.score);

            displayResults(results, query);
            logSearch(query, results.length);
        }

        // Display Search Results
        function displayResults(results, query) {
            const container = document.getElementById('results-container');
            const content = document.getElementById('results-content');

            container.classList.add('active');

            if (results.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <h3 style="font-size: 2em; margin-bottom: 10px;">üòî</h3>
                        <p style="font-size: 1.2em;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${query}"</p>
                        <p>‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ AI Chat ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
                    </div>
                `;
                return;
            }

            content.innerHTML = results.map(book => {
                const available = book.quantity - (book.borrowed || 0);
                const statusClass = available > 0 ? 'status-available' : 'status-unavailable';
                const statusText = available > 0 ? `‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° (${available} ‡πÄ‡∏•‡πà‡∏°)` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°';

                return `
                    <div class="book-card">
                        <div class="book-title">${book.title}</div>
                        <div class="book-info">
                            <div class="book-info-item">
                                <strong>üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á:</strong> ${book.author}
                            </div>
                            <div class="book-info-item">
                                <strong>üìö ‡∏´‡∏°‡∏ß‡∏î:</strong> ${book.category}
                            </div>
                            <div class="book-info-item">
                                <strong>üî¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å:</strong> ${book.callNumber || '-'}
                            </div>
                            <div class="book-info-item">
                                <strong>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                        </div>
                        ${book.abstract ? `<div style="margin-top: 15px; padding: 15px; background: white; border-radius: 10px;"><strong>üìù ‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠:</strong> ${book.abstract}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // AI Chat
        function sendAIMessage() {
            const input = document.getElementById('ai-search-input');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addChatMessage(message, 'user');
            input.value = '';

            // Process AI response
            setTimeout(() => {
                processAIQuery(message);
            }, 500);
        }

        function addChatMessage(message, sender) {
            const chatContainer = document.getElementById('ai-chat');
            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = `chat-message-wrapper ${sender}`;

            if (sender === 'ai') {
                wrapperDiv.innerHTML = `
                    <div class="chat-avatar">üíé</div>
                    <div style="flex: 1;">
                        <div class="ai-name">‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏ä‡∏£</div>
                        <div class="chat-message">${message}</div>
                    </div>
                `;
            } else {
                wrapperDiv.innerHTML = `
                    <div class="chat-avatar">üë§</div>
                    <div class="chat-message">${message}</div>
                `;
            }

            chatContainer.appendChild(wrapperDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function processAIQuery(query) {
            const keywords = extractKeywords(query);
            const results = [];

            books.forEach(book => {
                let score = 0;
                const searchText = `${book.title} ${book.author} ${book.category} ${book.callNumber || ''} ${book.abstract || ''}`.toLowerCase();

                keywords.forEach(keyword => {
                    if (searchText.includes(keyword)) {
                        if (book.title.toLowerCase().includes(keyword)) score += 5;
                        if (book.author.toLowerCase().includes(keyword)) score += 3;
                        if (book.category.toLowerCase().includes(keyword)) score += 4;
                        if (book.callNumber && book.callNumber.toLowerCase().includes(keyword)) score += 2;
                        if (book.abstract && book.abstract.toLowerCase().includes(keyword)) score += 1;
                    }
                });

                if (score > 0) {
                    results.push({ ...book, score });
                }
            });

            results.sort((a, b) => b.score - a.score);

            let response = '';
            if (results.length === 0) {
                response = `üòî ‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö "<strong>${query}</strong>"\n\nüí° ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`;
            } else if (results.length === 1) {
                const book = results[0];
                const available = book.quantity - (book.borrowed || 0);
                response = `üìö ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ 1 ‡πÄ‡∏•‡πà‡∏°‡∏Ñ‡∏£‡∏±‡∏ö:\n\n<strong>"${book.title}"</strong>\nüë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author}\nüìÇ ‡∏´‡∏°‡∏ß‡∏î: ${book.category}\n${available > 0 ? `‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${available} ‡πÄ‡∏•‡πà‡∏°` : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ'}`;
            } else {
                response = `üìö ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á <strong>${results.length} ‡πÄ‡∏•‡πà‡∏°</strong>‡∏Ñ‡∏£‡∏±‡∏ö\n\nüí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à:\n\n`;
                results.slice(0, 5).forEach((book, index) => {
                    const available = book.quantity - (book.borrowed || 0);
                    response += `<div class="book-item"><strong>${index + 1}. "${book.title}"</strong>\n   üë§ ${book.author} | üìÇ ${book.category}\n   ${available > 0 ? '‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°' : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°'}</div>\n`;
                });
                if (results.length > 5) {
                    response += `\nüìñ ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å <strong>${results.length - 5} ‡πÄ‡∏•‡πà‡∏°</strong> ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏™‡∏ô‡πÉ‡∏à`;
                }
            }

            addChatMessage(response, 'ai');
            displayResults(results, query);
            logSearch(query, results.length);

            // Speak AI response (remove HTML tags and emojis for speech)
            const speechText = response
                .replace(/<[^>]*>/g, '') // Remove HTML tags
                .replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '') // Remove emojis
                .replace(/[üìöüí°üòî‚úÖ‚ùåüë§üìÇüî¢üìùüìñ]/g, '') // Remove specific emojis
                .replace(/\n/g, ' ')
                .trim();
            speak(speechText);
        }

        // Load Books Realtime
        function loadBooksRealtime() {
            booksUnsubscribe = db.collection('books').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                books = [];
                snapshot.forEach((doc) => {
                    books.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                filteredBooks = [...books];
                renderBooks();
                updateTopStats();
                updateAdminStats();
                updateCategoryFilter();
            });
        }

        // Load News Realtime
        function loadNewsRealtime() {
            newsUnsubscribe = db.collection('news').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                news = [];
                snapshot.forEach((doc) => {
                    const newsData = doc.data();
                    if (newsData.visible !== false) {
                        news.push({
                            id: doc.id,
                            ...newsData
                        });
                    }
                });
                renderNews();
                renderAdminNews();
            });
        }

        // Render News with Slider
        function renderNews() {
            const track = document.getElementById('news-slider-track');
            const controls = document.getElementById('news-slider-controls');

            if (news.length === 0) {
                track.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</p>';
                controls.style.display = 'none';
                return;
            }

            const isMobile = window.innerWidth <= 768;
            const itemsPerSlide = isMobile ? 1 : 3;

            // Create slides
            const slides = [];
            for (let i = 0; i < news.length; i += itemsPerSlide) {
                const slideItems = news.slice(i, i + itemsPerSlide);
                slides.push(slideItems);
            }

            // Show controls only if more than one slide
            if (slides.length > 1) {
                controls.style.display = 'flex';
            } else {
                controls.style.display = 'none';
            }

            // Render slides
            track.innerHTML = slides.map((slideItems, slideIndex) => `
                <div class="news-slide">
                    ${slideItems.map(item => `
                        <div class="news-card">
                            ${item.imageUrl ? `<img src="${item.imageUrl}" alt="${item.title}" class="news-image">` : ''}
                            <div class="news-content">
                                <div class="news-title">${item.title}</div>
                                <div class="news-text">${item.content}</div>
                                <div class="news-date">${item.date || new Date().toLocaleDateString('th-TH')}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');

            // Render dots
            const dotsContainer = document.getElementById('news-slider-dots');
            dotsContainer.innerHTML = slides.map((_, index) =>
                `<div class="slider-dot ${index === 0 ? 'active' : ''}" onclick="newsSliderGoTo(${index})"></div>`
            ).join('');

            // Reset slider
            newsSliderIndex = 0;
            updateNewsSlider();

            // Start auto-slide
            startNewsAutoSlide();
        }

        function updateNewsSlider() {
            const track = document.getElementById('news-slider-track');
            const dots = document.querySelectorAll('#news-slider-dots .slider-dot');
            const slides = track.querySelectorAll('.news-slide');

            track.style.transform = `translateX(-${newsSliderIndex * 100}%)`;

            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === newsSliderIndex);
            });

            // Update button states
            document.getElementById('news-prev-btn').disabled = newsSliderIndex === 0;
            document.getElementById('news-next-btn').disabled = newsSliderIndex === slides.length - 1;
        }

        function newsSliderNext() {
            const track = document.getElementById('news-slider-track');
            const slides = track.querySelectorAll('.news-slide');

            if (newsSliderIndex < slides.length - 1) {
                newsSliderIndex++;
                updateNewsSlider();
                resetNewsAutoSlide();
            }
        }

        function newsSliderPrev() {
            if (newsSliderIndex > 0) {
                newsSliderIndex--;
                updateNewsSlider();
                resetNewsAutoSlide();
            }
        }

        function newsSliderGoTo(index) {
            newsSliderIndex = index;
            updateNewsSlider();
            resetNewsAutoSlide();
        }

        function startNewsAutoSlide() {
            stopNewsAutoSlide();
            newsSliderInterval = setInterval(() => {
                const track = document.getElementById('news-slider-track');
                const slides = track.querySelectorAll('.news-slide');

                if (slides.length > 1) {
                    newsSliderIndex = (newsSliderIndex + 1) % slides.length;
                    updateNewsSlider();
                }
            }, 5000); // Auto-slide every 5 seconds
        }

        function stopNewsAutoSlide() {
            if (newsSliderInterval) {
                clearInterval(newsSliderInterval);
                newsSliderInterval = null;
            }
        }

        function resetNewsAutoSlide() {
            startNewsAutoSlide();
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (news.length > 0) {
                renderNews();
            }
        });

        // Update Top Stats
        function updateTopStats() {
            // Top 5 Books
            const topBooks = [...books]
                .filter(book => book.borrowed > 0)
                .sort((a, b) => b.borrowed - a.borrowed)
                .slice(0, 5);

            const topBooksContainer = document.getElementById('top-books');
            if (topBooks.length === 0) {
                topBooksContainer.innerHTML = '<p style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p>';
            } else {
                topBooksContainer.innerHTML = topBooks.map((book, index) => `
                    <div class="top-item">
                        <div class="top-rank">#${index + 1}</div>
                        <div class="top-info">
                            <strong>${book.title}</strong>
                            <div style="color: #666; font-size: 0.9em;">${book.author}</div>
                        </div>
                        <div class="top-count">${book.borrowed} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                    </div>
                `).join('');
            }

            // Top 5 Categories
            const categoryStats = {};
            books.forEach(book => {
                if (book.borrowed > 0) {
                    if (!categoryStats[book.category]) {
                        categoryStats[book.category] = 0;
                    }
                    categoryStats[book.category] += book.borrowed;
                }
            });

            const topCategories = Object.entries(categoryStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const topCategoriesContainer = document.getElementById('top-categories');
            if (topCategories.length === 0) {
                topCategoriesContainer.innerHTML = '<p style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p>';
            } else {
                topCategoriesContainer.innerHTML = topCategories.map(([category, count], index) => `
                    <div class="top-item">
                        <div class="top-rank">#${index + 1}</div>
                        <div class="top-info">
                            <strong>${category}</strong>
                        </div>
                        <div class="top-count">${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                    </div>
                `).join('');
            }
        }

        // Login Functions
        let currentStudent = null;

        function showLoginSelection() {
            document.getElementById('user-container').style.display = 'none';
            document.getElementById('login-selection-container').style.display = 'block';
        }

        function backToUserFromSelection() {
            document.getElementById('login-selection-container').style.display = 'none';
            document.getElementById('user-container').style.display = 'block';
        }

        function showAdminLogin() {
            document.getElementById('login-selection-container').style.display = 'none';
            document.getElementById('admin-login-container').style.display = 'block';
        }

        function showStudentLogin() {
            document.getElementById('login-selection-container').style.display = 'none';
            document.getElementById('student-login-container').style.display = 'block';
        }

        function backToLoginSelection() {
            document.getElementById('admin-login-container').style.display = 'none';
            document.getElementById('student-login-container').style.display = 'none';
            document.getElementById('login-selection-container').style.display = 'block';
        }

        function handleAdminLogin(event) {
            event.preventDefault();

            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;

            if (username === 'Admin' && password === '1234') {
                isLoggedIn = true;
                document.getElementById('admin-login-container').style.display = 'none';
                document.getElementById('admin-container').style.display = 'block';
                updateAdminStats();
            } else {
                showAlert('admin-login-alert', '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'error');
            }
        }

        function handleStudentLogin(event) {
            event.preventDefault();

            const studentId = document.getElementById('student-login-id').value.trim();
            const student = students.find(s => s.studentId === studentId);

            if (student) {
                currentStudent = student;
                document.getElementById('student-login-container').style.display = 'none';
                document.getElementById('student-container').style.display = 'block';

                // Update welcome text
                document.getElementById('student-welcome-text').textContent = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${student.studentName}`;
                document.getElementById('student-name-recommend').textContent = student.studentName;

                // Load recommended books
                loadRecommendedBooks(student.department);
                loadAllBooksForStudent();
                updateStudentHomeStats();
                renderStudentNews();
            } else {
                showAlert('student-login-alert', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö!', 'error');
            }
        }

        function showConfirm(message, callback) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á overlay
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = 0;
            overlay.style.left = 0;
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'rgba(0,0,0,0.5)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = 1000;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            const box = document.createElement('div');
            box.style.backgroundColor = '#fff';
            box.style.padding = '20px';
            box.style.borderRadius = '8px';
            box.style.textAlign = 'center';
            box.style.minWidth = '300px';
            box.innerHTML = `<p>${message}</p>`;

            // ‡∏õ‡∏∏‡πà‡∏° Yes
            const yesBtn = document.createElement('button');
            yesBtn.innerText = '‡∏ï‡∏Å‡∏•‡∏á';
            yesBtn.style.margin = '10px';
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };

            // ‡∏õ‡∏∏‡πà‡∏° No
            const noBtn = document.createElement('button');
            noBtn.innerText = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
            noBtn.style.margin = '10px';
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };

            box.appendChild(yesBtn);
            box.appendChild(noBtn);
            overlay.appendChild(box);
            document.body.appendChild(overlay);
        }

        function showConfirm(message, callback) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á overlay
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = 0;
            overlay.style.left = 0;
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'rgba(0,0,0,0.5)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = 1000;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            const box = document.createElement('div');
            box.style.backgroundColor = '#fff';
            box.style.padding = '20px';
            box.style.borderRadius = '10px';
            box.style.border = '2px solid #4CAF50'; // ‡∏™‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á
            box.style.textAlign = 'center';
            box.style.minWidth = '300px';
            box.innerHTML = `<p style="margin-bottom: 20px;">${message}</p>`;

            // ‡∏õ‡∏∏‡πà‡∏° Yes
            const yesBtn = document.createElement('button');
            yesBtn.innerText = '‡∏ï‡∏Å‡∏•‡∏á';
            yesBtn.style.margin = '10px';
            yesBtn.style.padding = '10px 20px';
            yesBtn.style.backgroundColor = '#4CAF50'; // ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏Å‡∏•‡∏á
            yesBtn.style.color = 'white';
            yesBtn.style.border = 'none';
            yesBtn.style.borderRadius = '5px';
            yesBtn.style.cursor = 'pointer';
            yesBtn.onmouseover = () => yesBtn.style.backgroundColor = '#45a049';
            yesBtn.onmouseout = () => yesBtn.style.backgroundColor = '#4CAF50';
            yesBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(true);
            };

            // ‡∏õ‡∏∏‡πà‡∏° No
            const noBtn = document.createElement('button');
            noBtn.innerText = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
            noBtn.style.margin = '10px';
            noBtn.style.padding = '10px 20px';
            noBtn.style.backgroundColor = '#f44336'; // ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            noBtn.style.color = 'white';
            noBtn.style.border = 'none';
            noBtn.style.borderRadius = '5px';
            noBtn.style.cursor = 'pointer';
            noBtn.onmouseover = () => noBtn.style.backgroundColor = '#da190b';
            noBtn.onmouseout = () => noBtn.style.backgroundColor = '#f44336';
            noBtn.onclick = () => {
                document.body.removeChild(overlay);
                callback(false);
            };

            box.appendChild(yesBtn);
            box.appendChild(noBtn);
            overlay.appendChild(box);
            document.body.appendChild(overlay);
        }

        // Toast ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function showToast(message) {
            const toast = document.createElement('div');
            toast.innerText = message;
            toast.style.position = 'fixed';
            toast.style.bottom = '30px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.backgroundColor = '#4CAF50';
            toast.style.color = 'white';
            toast.style.padding = '16px';
            toast.style.borderRadius = '8px';
            toast.style.fontSize = '16px';
            toast.style.zIndex = 1001;
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.5s';
            document.body.appendChild(toast);

            setTimeout(() => { toast.style.opacity = '1'; }, 100);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => { document.body.removeChild(toast); }, 500);
            }, 3000);
        }

        // ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô handleLogout
        function handleLogout() {
            showConfirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', function (confirm) {
                if (confirm) {
                    isLoggedIn = false;
                    document.getElementById('admin-container').style.display = 'none';
                    document.getElementById('user-container').style.display = 'block';
                    document.getElementById('admin-login-form').reset();
                    showToast('‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            });
        }

        function handleStudentLogout() {
            showConfirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', function (confirm) {
                if (confirm) {
                    currentStudent = null;
                    document.getElementById('student-container').style.display = 'none';
                    document.getElementById('student-login-container').style.display = 'block';
                    document.getElementById('student-login-form').reset();
                    document.getElementById('student-login-alert').innerHTML = '';
                    showToast('‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            });
        }




        // ==================== FUNCTION: ‡∏™‡∏•‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ====================
        function switchStudentSection(section) {
            // Hide all sections
            document.querySelectorAll('#student-container .content-section').forEach(sec => {
                sec.classList.remove('active');
            });

            // Remove active from all nav buttons
            document.querySelectorAll('#student-container .nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected section
            if (section === 'home') {
                document.getElementById('student-home-section').classList.add('active');
                updateStudentHomeStats();
            } else if (section === 'search') {
                document.getElementById('student-search-section').classList.add('active');
            } else if (section === 'all-books') {
                document.getElementById('student-all-books-section').classList.add('active');
            } else if (section === 'borrowed-books') {
                document.getElementById('student-borrowed-books-section').classList.add('active');
                loadStudentBorrowedBooks();
            }

            // Set active nav button
            event.target.classList.add('active');
        }

        // ==================== STUDENT SEARCH FUNCTIONS ====================

        let currentStudentSearchMode = 'text';
        let studentRecognition = null;

        // Initialize Student Speech Recognition
        function initStudentSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                studentRecognition = new SpeechRecognition();
                studentRecognition.lang = 'th-TH';
                studentRecognition.continuous = false;
                studentRecognition.interimResults = false;

                studentRecognition.onresult = function (event) {
                    const transcript = event.results[0][0].transcript;
                    if (currentStudentSearchMode === 'voice') {
                        document.getElementById('student-voice-search-input').value = transcript;
                        document.getElementById('student-voice-btn').classList.remove('listening');
                    } else if (currentStudentSearchMode === 'ai') {
                        document.getElementById('student-ai-search-input').value = transcript;
                        document.getElementById('student-ai-voice-btn').classList.remove('listening');
                        // Auto send message after voice input
                        setTimeout(() => {
                            sendStudentAIMessage();
                        }, 500);
                    }
                };

                studentRecognition.onerror = function (event) {
                    console.error('Speech recognition error:', event.error);
                    if (currentStudentSearchMode === 'voice') {
                        document.getElementById('student-voice-btn').classList.remove('listening');
                    } else if (currentStudentSearchMode === 'ai') {
                        document.getElementById('student-ai-voice-btn').classList.remove('listening');
                    }
                };

                studentRecognition.onend = function () {
                    if (currentStudentSearchMode === 'voice') {
                        document.getElementById('student-voice-btn').classList.remove('listening');
                    } else if (currentStudentSearchMode === 'ai') {
                        document.getElementById('student-ai-voice-btn').classList.remove('listening');
                    }
                };
            }
        }

        // Switch Student Search Mode
        function switchStudentSearchMode(mode) {
            currentStudentSearchMode = mode;

            // Update tabs
            document.querySelectorAll('#student-search-section .search-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Hide all search modes
            document.getElementById('student-text-search').style.display = 'none';
            document.getElementById('student-voice-search').style.display = 'none';
            document.getElementById('student-ai-search').style.display = 'none';

            // Show selected mode
            document.getElementById('student-' + mode + '-search').style.display = 'block';

            // Show/hide AI chat
            if (mode === 'ai') {
                document.getElementById('student-ai-chat').classList.add('active');
            } else {
                document.getElementById('student-ai-chat').classList.remove('active');
            }
        }

        // Start Voice Search
        function startStudentVoiceSearch() {
            if (studentRecognition) {
                document.getElementById('student-voice-btn').classList.add('listening');
                studentRecognition.start();
            } else {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
            }
        }

        function startStudentAIVoice() {
            if (studentRecognition) {
                document.getElementById('student-ai-voice-btn').classList.add('listening');
                studentRecognition.start();
            } else {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
            }
        }

        // Handle Enter Key
        function handleStudentSearchEnter(event, mode) {
            if (event.key === 'Enter') {
                if (mode === 'ai') {
                    sendStudentAIMessage();
                } else {
                    studentSearchBooks(mode);
                }
            }
        }

        // Search Books
        function studentSearchBooks(mode) {
            let query = '';

            if (mode === 'text') {
                query = document.getElementById('student-text-search-input').value.trim();
            } else if (mode === 'voice') {
                query = document.getElementById('student-voice-search-input').value.trim();
            }

            if (!query) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
                return;
            }

            const keywords = extractKeywords(query);
            const results = [];

            books.forEach(book => {
                let score = 0;
                const searchText = `${book.title} ${book.author} ${book.category} ${book.callNumber || ''} ${book.abstract || ''}`.toLowerCase();

                keywords.forEach(keyword => {
                    if (searchText.includes(keyword)) {
                        if (book.title.toLowerCase().includes(keyword)) score += 5;
                        if (book.author.toLowerCase().includes(keyword)) score += 3;
                        if (book.category.toLowerCase().includes(keyword)) score += 4;
                        if (book.callNumber && book.callNumber.toLowerCase().includes(keyword)) score += 2;
                        if (book.abstract && book.abstract.toLowerCase().includes(keyword)) score += 1;
                    }
                });

                if (score > 0) {
                    results.push({ ...book, score });
                }
            });

            results.sort((a, b) => b.score - a.score);

            displayStudentSearchResults(results, query);
            logSearch(query, results.length);
        }

        // Display Search Results
        function displayStudentSearchResults(results, query) {
            const container = document.getElementById('student-search-results');
            const content = document.getElementById('student-search-results-content');

            container.style.display = 'block';

            if (results.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999; grid-column: 1 / -1;">
                        <h3 style="font-size: 2em; margin-bottom: 10px;">üòî</h3>
                        <p style="font-size: 1.2em;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${query}"</p>
                        <p>‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ AI Chat ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
                    </div>
                `;
                return;
            }

            content.innerHTML = results.map(book => {
                const available = book.quantity - (book.borrowed || 0);
                const statusClass = available > 0 ? 'status-available' : 'status-unavailable';
                const statusText = available > 0 ? `‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° (${available} ‡πÄ‡∏•‡πà‡∏°)` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°';

                return `
                    <div class="news-card">
                        <div class="news-content">
                            <div class="news-title" style="color: #667eea;">${book.title}</div>
                            <div style="color: #666; margin: 10px 0;">
                                <strong>üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á:</strong> ${book.author}<br>
                                <strong>üìö ‡∏´‡∏°‡∏ß‡∏î:</strong> ${book.category}<br>
                                <strong>üî¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å:</strong> ${book.callNumber || '-'}
                            </div>
                            <div style="margin-top: 10px;">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            ${book.abstract ? `<div class="news-text" style="margin-top: 10px;">${book.abstract.substring(0, 100)}...</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // AI Chat
        function sendStudentAIMessage() {
            const input = document.getElementById('student-ai-search-input');
            const message = input.value.trim();

            if (!message) return;

            addStudentChatMessage(message, 'user');
            input.value = '';

            setTimeout(() => {
                processStudentAIQuery(message);
            }, 500);
        }

        function addStudentChatMessage(message, sender) {
            const chatContainer = document.getElementById('student-ai-chat');
            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = `chat-message-wrapper ${sender}`;

            if (sender === 'ai') {
                wrapperDiv.innerHTML = `
                    <div class="chat-avatar">üíé</div>
                    <div style="flex: 1;">
                        <div class="ai-name">‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏ä‡∏£</div>
                        <div class="chat-message">${message}</div>
                    </div>
                `;
            } else {
                wrapperDiv.innerHTML = `
                    <div class="chat-avatar">üë§</div>
                    <div class="chat-message">${message}</div>
                `;
            }

            chatContainer.appendChild(wrapperDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function processStudentAIQuery(query) {
            // Natural Language Understanding - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥
            const lowerQuery = query.toLowerCase();

            // Intent Detection - ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            const intents = {
                interest: ['‡∏™‡∏ô‡πÉ‡∏à', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏´‡∏≤', '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', '‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏°‡∏µ‡πÑ‡∏´‡∏°', '‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£', '‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', '‡∏ä‡∏≠‡∏ö'],
                about: ['‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢', 'about', 'regarding'],
                author: ['‡∏Ç‡∏≠‡∏á', '‡πÇ‡∏î‡∏¢', '‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏î‡∏¢', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢', '‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á', 'by', 'author'],
                category: ['‡∏´‡∏°‡∏ß‡∏î', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡πÅ‡∏ô‡∏ß', 'category', 'type', 'genre'],
                available: ['‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°', '‡∏ß‡πà‡∏≤‡∏á', 'available', '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏∑‡∏°', '‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ']
            };

            let detectedIntent = 'search';
            for (const [intent, patterns] of Object.entries(intents)) {
                if (patterns.some(pattern => lowerQuery.includes(pattern))) {
                    detectedIntent = intent;
                    break;
                }
            }

            // Extract main topic from query
            let cleanQuery = query;
            intents.interest.forEach(word => {
                cleanQuery = cleanQuery.replace(new RegExp(word, 'gi'), '');
            });
            intents.about.forEach(word => {
                cleanQuery = cleanQuery.replace(new RegExp(word, 'gi'), '');
            });

            const keywords = extractKeywords(cleanQuery);
            const results = [];

            books.forEach(book => {
                let score = 0;
                const searchText = `${book.title} ${book.author} ${book.category} ${book.callNumber || ''} ${book.abstract || ''}`.toLowerCase();

                keywords.forEach(keyword => {
                    if (searchText.includes(keyword)) {
                        // Weighted scoring based on field importance
                        if (book.title.toLowerCase().includes(keyword)) score += 5;
                        if (book.author.toLowerCase().includes(keyword)) score += 3;
                        if (book.category.toLowerCase().includes(keyword)) score += 4;
                        if (book.callNumber && book.callNumber.toLowerCase().includes(keyword)) score += 2;
                        if (book.abstract && book.abstract.toLowerCase().includes(keyword)) score += 1;
                    }
                });

                // Filter by availability if requested
                if (detectedIntent === 'available') {
                    const available = book.quantity - (book.borrowed || 0);
                    if (available <= 0) score = 0;
                }

                if (score > 0) {
                    results.push({ ...book, score });
                }
            });

            results.sort((a, b) => b.score - a.score);

            // Generate natural response based on intent
            let response = '';
            if (results.length === 0) {
                if (detectedIntent === 'interest') {
                    response = `üòî ‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö "<strong>${cleanQuery.trim()}</strong>" ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î\n\nüí° ‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏ä‡πà‡∏ô:\n‚Ä¢ "‡∏â‡∏±‡∏ô‡∏™‡∏ô‡πÉ‡∏à‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå"\n‚Ä¢ "‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡πÑ‡∏´‡∏°"`;
                } else {
                    response = `üòî ‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö "<strong>${query}</strong>"\n\nüí° ‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`;
                }
            } else if (results.length === 1) {
                const book = results[0];
                const available = book.quantity - (book.borrowed || 0);
                const abstractText = book.abstract ? `\nüìù ‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠: ${book.abstract.substring(0, 150)}...` : '';
                if (detectedIntent === 'interest') {
                    response = `‚ú® ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡∏ö:\n\nüî¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å: <strong>${book.callNumber || '-'}</strong>\n<strong>1. "${book.title}"</strong>\nüë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author} | üìÇ ‡∏´‡∏°‡∏ß‡∏î: ${book.category}${abstractText}\n${available > 0 ? `‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${available} ‡πÄ‡∏•‡πà‡∏°` : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ'}`;
                } else {
                    response = `üìö ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ 1 ‡πÄ‡∏•‡πà‡∏°‡∏Ñ‡∏£‡∏±‡∏ö:\n\nüî¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å: <strong>${book.callNumber || '-'}</strong>\n<strong>1. "${book.title}"</strong>\nüë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author} | üìÇ ‡∏´‡∏°‡∏ß‡∏î: ${book.category}${abstractText}\n${available > 0 ? `‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${available} ‡πÄ‡∏•‡πà‡∏°` : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ'}`;
                }
            } else {
                if (detectedIntent === 'interest') {
                    response = `‚ú® ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à <strong>${results.length} ‡πÄ‡∏•‡πà‡∏°</strong>‡∏Ñ‡∏£‡∏±‡∏ö\n\nüí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö:\n\n`;
                } else if (detectedIntent === 'available') {
                    response = `üìö ‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° <strong>${results.length} ‡πÄ‡∏•‡πà‡∏°</strong>‡∏Ñ‡∏£‡∏±‡∏ö:\n\n`;
                } else {
                    response = `üìö ‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á <strong>${results.length} ‡πÄ‡∏•‡πà‡∏°</strong>‡∏Ñ‡∏£‡∏±‡∏ö\n\nüí° ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à:\n\n`;
                }

                results.slice(0, 5).forEach((book, index) => {
                    const available = book.quantity - (book.borrowed || 0);
                    const abstractText = book.abstract ? `\n   üìù ‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠: ${book.abstract.substring(0, 100)}...` : '';
                    response += `<div class="book-item">üî¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å: <strong>${book.callNumber || '-'}</strong>\n<strong>${index + 1}. "${book.title}"</strong>\n   üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author} | üìÇ ‡∏´‡∏°‡∏ß‡∏î: ${book.category}${abstractText}\n   ${available > 0 ? `‚úÖ ‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° ${available} ‡πÄ‡∏•‡πà‡∏°` : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°'}</div>\n`;
                });
                if (results.length > 5) {
                    response += `\nüìñ ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å <strong>${results.length - 5} ‡πÄ‡∏•‡πà‡∏°</strong> ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏™‡∏ô‡πÉ‡∏à`;
                }
            }

            addStudentChatMessage(response, 'ai');
            displayStudentSearchResults(results, query);
            logSearch(query, results.length);

            // Speak AI response (remove HTML tags and emojis for speech)
            const speechText = response
                .replace(/<[^>]*>/g, '') // Remove HTML tags
                .replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '') // Remove emojis
                .replace(/[üìöüí°üòî‚úÖ‚ùåüë§üìÇüî¢üìùüìñ‚ú®]/g, '') // Remove specific emojis
                .replace(/\n/g, ' ')
                .trim();
            speak(speechText);
        }

        // Speak Results
        function speakStudentResults() {
            const resultsContent = document.getElementById('student-search-results-content');
            if (!resultsContent.innerHTML || resultsContent.innerHTML.includes('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠')) {
                speak('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
                return;
            }

            const bookCards = resultsContent.querySelectorAll('.news-card');
            if (bookCards.length === 0) {
                speak('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
                return;
            }

            let text = `‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${bookCards.length} ‡πÄ‡∏•‡πà‡∏° ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà `;
            bookCards.forEach((card, index) => {
                const title = card.querySelector('.news-title').textContent;
                const infoText = card.querySelector('.news-content > div:nth-child(2)').textContent;
                const authorMatch = infoText.match(/‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á:\s*([^\n]+)/);
                const author = authorMatch ? authorMatch[1].trim() : '';
                text += `${index + 1}. ${title} ‡πÇ‡∏î‡∏¢ ${author}. `;
            });

            speak(text);
        }

        function switchAdminSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById('admin-' + section + '-section').classList.add('active');
            event.target.classList.add('active');

            if (section === 'stats') {
                updateAdminStats();
            }
        }

        function showAlert(elementId, message, type) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 3000);
        }

        // Add Book
        async function addBook(event) {
            event.preventDefault();

            const book = {
                callNumber: document.getElementById('book-call-number').value,
                title: document.getElementById('book-title').value,
                author: document.getElementById('book-author').value,
                category: document.getElementById('book-category').value,
                quantity: parseInt(document.getElementById('book-quantity').value),
                borrowed: 0,
                abstract: document.getElementById('book-abstract').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('books').add(book);
                document.getElementById('book-form').reset();
                showAlert('books-alert', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error adding book:', error);
                showAlert('books-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠!', 'error');
            }
        }

        // Excel Upload
        async function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function (e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    let successCount = 0;
                    for (const row of jsonData) {
                        const book = {
                            callNumber: row['‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'] || row['callNumber'] || '',
                            title: row['‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'] || row['title'] || '',
                            author: row['‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á'] || row['author'] || '',
                            category: row['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'] || row['category'] || '',
                            quantity: parseInt(row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏•‡πà‡∏°'] || row['quantity']) || 1,
                            borrowed: parseInt(row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°'] || row['borrowed']) || 0,
                            abstract: row['‡∏ö‡∏ó‡∏Ñ‡∏±‡∏î‡∏¢‡πà‡∏≠'] || row['abstract'] || '',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        if (book.title && book.author) {
                            await db.collection('books').add(book);
                            successCount++;
                        }
                    }

                    showAlert('books-alert', `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£!`, 'success');
                    event.target.value = '';
                } catch (error) {
                    console.error('Error uploading Excel:', error);
                    showAlert('books-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î Excel!', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Render Books Table
        function renderBooks() {
            const tbody = document.getElementById('books-table');

            if (filteredBooks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</td></tr>';
                return;
            }

            tbody.innerHTML = filteredBooks.map(book => {
                const available = book.quantity - (book.borrowed || 0);
                return `
                    <tr>
                        <td>${book.callNumber || '-'}</td>
                        <td>${book.title}</td>
                        <td>${book.author}</td>
                        <td>${book.category}</td>
                        <td>${book.quantity}</td>
                        <td>${book.borrowed || 0}</td>
                        <td>${available}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editBook('${book.id}')" style="padding: 8px 16px; margin-right: 5px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button class="btn btn-danger" onclick="deleteBook('${book.id}')" style="padding: 8px 16px;">‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Filter and Sort Books
        function updateCategoryFilter() {
            const categories = [...new Set(books.map(book => book.category))];
            const select = document.getElementById('filter-category');
            select.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>';
            categories.forEach(cat => {
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }

        function filterBooks() {
            const searchTerm = document.getElementById('filter-search').value.toLowerCase();
            const category = document.getElementById('filter-category').value;

            filteredBooks = books.filter(book => {
                const matchSearch = !searchTerm ||
                    book.title.toLowerCase().includes(searchTerm) ||
                    book.author.toLowerCase().includes(searchTerm) ||
                    (book.callNumber && book.callNumber.toLowerCase().includes(searchTerm));

                const matchCategory = !category || book.category === category;

                return matchSearch && matchCategory;
            });

            renderBooks();
        }

        function sortBooks() {
            const sortBy = document.getElementById('sort-by').value;

            filteredBooks.sort((a, b) => {
                switch (sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title, 'th');
                    case 'borrowed':
                        return (b.borrowed || 0) - (a.borrowed || 0);
                    case 'available':
                        return (b.quantity - (b.borrowed || 0)) - (a.quantity - (a.borrowed || 0));
                    case 'category':
                        return a.category.localeCompare(b.category, 'th');
                    default:
                        return 0;
                }
            });

            renderBooks();
        }

        // Edit Book
        function editBook(id) {
            const book = books.find(b => b.id === id);
            if (!book) return;

            document.getElementById('edit-book-id').value = book.id;
            document.getElementById('edit-call-number').value = book.callNumber || '';
            document.getElementById('edit-title').value = book.title;
            document.getElementById('edit-author').value = book.author;
            document.getElementById('edit-category').value = book.category;
            document.getElementById('edit-quantity').value = book.quantity;
            document.getElementById('edit-borrowed').value = book.borrowed || 0;
            document.getElementById('edit-abstract').value = book.abstract || '';

            document.getElementById('edit-modal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            document.getElementById('edit-book-form').reset();
        }

        async function saveEditBook(event) {
            event.preventDefault();

            const id = document.getElementById('edit-book-id').value;
            const updatedBook = {
                callNumber: document.getElementById('edit-call-number').value,
                title: document.getElementById('edit-title').value,
                author: document.getElementById('edit-author').value,
                category: document.getElementById('edit-category').value,
                quantity: parseInt(document.getElementById('edit-quantity').value),
                borrowed: parseInt(document.getElementById('edit-borrowed').value),
                abstract: document.getElementById('edit-abstract').value
            };

            try {
                await db.collection('books').doc(id).update(updatedBook);
                closeEditModal();
                showAlert('books-alert', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error updating book:', error);
                showAlert('books-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠!', 'error');
            }
        }

        // Delete Book
        async function deleteBook(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    await db.collection('books').doc(id).delete();
                    showAlert('books-alert', '‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } catch (error) {
                    console.error('Error deleting book:', error);
                    showAlert('books-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠!', 'error');
                }
            }
        }

        // News Management
        async function addNews(event) {
            event.preventDefault();

            const submitBtn = document.getElementById('news-submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...';

            const imageFile = document.getElementById('news-image').files[0];

            if (!imageFile) {
                showAlert('news-alert', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û!', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß';
                return;
            }

            try {
                const imageUrl = await readFileAsDataURL(imageFile);

                const newsItem = {
                    title: document.getElementById('news-title').value,
                    content: document.getElementById('news-content').value,
                    imageUrl: imageUrl,
                    date: new Date().toLocaleDateString('th-TH'),
                    visible: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('news').add(newsItem);
                document.getElementById('news-form').reset();
                document.getElementById('news-image-preview').innerHTML = '';
                showAlert('news-alert', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error adding news:', error);
                showAlert('news-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß!', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß';
            }
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function renderAdminNews() {
            const tbody = document.getElementById('admin-news-table');

            db.collection('news').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                const allNews = [];
                snapshot.forEach((doc) => {
                    allNews.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                if (allNews.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß</td></tr>';
                    return;
                }

                tbody.innerHTML = allNews.map(item => `
                    <tr>
                        <td>
                            ${item.imageUrl ?
                        `<img src="${item.imageUrl}" style="width: 100px; height: 60px; object-fit: cover; border-radius: 8px;">` :
                        '<span style="color: #999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>'
                    }
                        </td>
                        <td>${item.title}</td>
                        <td>${item.content.substring(0, 50)}...</td>
                        <td>${item.date || '-'}</td>
                        <td>
                            <label class="toggle-switch">
                                <input type="checkbox" ${item.visible !== false ? 'checked' : ''} onchange="toggleNewsVisibility('${item.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </td>
                        <td>
                            <button class="btn btn-danger" onclick="deleteNews('${item.id}')" style="padding: 8px 16px;">‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `).join('');
            });
        }

        async function toggleNewsVisibility(id, visible) {
            try {
                await db.collection('news').doc(id).update({ visible: visible });
            } catch (error) {
                console.error('Error toggling news visibility:', error);
            }
        }

        async function deleteNews(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    await db.collection('news').doc(id).delete();
                    showAlert('news-alert', '‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } catch (error) {
                    console.error('Error deleting news:', error);
                    showAlert('news-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß!', 'error');
                }
            }
        }

        // Admin Stats
        function updateAdminStats() {
            const totalBooks = books.reduce((sum, book) => sum + book.quantity, 0);
            const totalBorrowed = books.reduce((sum, book) => sum + (book.borrowed || 0), 0);
            const totalAvailable = totalBooks - totalBorrowed;

            document.getElementById('admin-total-books').textContent = totalBooks;
            document.getElementById('admin-total-borrowed').textContent = totalBorrowed;
            document.getElementById('admin-total-available').textContent = totalAvailable;
        }

        // ==================== STUDENT MANAGEMENT ====================

        // Load Students Realtime
        function loadStudentsRealtime() {
            studentsUnsubscribe = db.collection('students').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                students = [];
                snapshot.forEach((doc) => {
                    students.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                filteredStudents = [...students];
                renderStudents();
            });
        }

        // Add Student
        async function addStudent(event) {
            event.preventDefault();

            const studentId = document.getElementById('student-id').value.trim();
            const studentName = document.getElementById('student-name').value.trim();
            const studentDepartment = document.getElementById('student-department').value;

            // Check if student ID already exists
            const existingStudent = students.find(s => s.studentId === studentId);
            if (existingStudent) {
                showAlert('students-alert', '‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß!', 'error');
                return;
            }

            const student = {
                studentId: studentId,
                studentName: studentName,
                department: studentDepartment,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('students').add(student);
                document.getElementById('student-form').reset();
                showAlert('students-alert', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error adding student:', error);
                showAlert('students-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤!', 'error');
            }
        }

        // Handle Student Excel Upload
        async function handleStudentExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function (e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    let successCount = 0;
                    let skipCount = 0;

                    for (let i = 0; i < jsonData.length; i++) {
                        const row = jsonData[i];

                        // Skip empty rows or header
                        if (!row[0] || !row[1]) continue;

                        const studentName = String(row[0]).trim();
                        const studentId = String(row[1]).trim();
                        const studentDepartment = row[2] ? String(row[2]).trim() : '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';

                        // Check if student ID already exists
                        const existingStudent = students.find(s => s.studentId === studentId);
                        if (existingStudent) {
                            skipCount++;
                            continue;
                        }

                        const student = {
                            studentId: studentId,
                            studentName: studentName,
                            department: studentDepartment,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        await db.collection('students').add(student);
                        successCount++;
                    }

                    let message = `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                    if (skipCount > 0) {
                        message += ` (‡∏Ç‡πâ‡∏≤‡∏° ${skipCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)`;
                    }
                    showAlert('students-alert', message, 'success');
                    event.target.value = '';
                } catch (error) {
                    console.error('Error uploading student Excel:', error);
                    showAlert('students-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î Excel! ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå: ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 1=‡∏ä‡∏∑‡πà‡∏≠, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 2=‡∏£‡∏´‡∏±‡∏™, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 3=‡πÅ‡∏ú‡∏ô‡∏Å', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Render Students Table
        function renderStudents() {
            const tbody = document.getElementById('students-table');

            if (filteredStudents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</td></tr>';
                return;
            }

            tbody.innerHTML = filteredStudents.map(student => {
                const date = student.createdAt ? new Date(student.createdAt.toDate()).toLocaleDateString('th-TH') : '-';
                return `
                    <tr>
                        <td>${student.studentId}</td>
                        <td>${student.studentName}</td>
                        <td>${student.department || '-'}</td>
                        <td>${date}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editStudent('${student.id}')" style="padding: 8px 16px; margin-right: 5px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button class="btn btn-danger" onclick="deleteStudent('${student.id}')" style="padding: 8px 16px;">‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Filter Students
        function filterStudents() {
            const searchTerm = document.getElementById('filter-student').value.toLowerCase();

            filteredStudents = students.filter(student => {
                return student.studentName.toLowerCase().includes(searchTerm) ||
                    student.studentId.toLowerCase().includes(searchTerm);
            });

            renderStudents();
        }

        // Edit Student
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;

            document.getElementById('edit-student-doc-id').value = student.id;
            document.getElementById('edit-student-id').value = student.studentId;
            document.getElementById('edit-student-name').value = student.studentName;
            document.getElementById('edit-student-department').value = student.department || '';

            document.getElementById('edit-student-modal').style.display = 'block';
        }

        function closeEditStudentModal() {
            document.getElementById('edit-student-modal').style.display = 'none';
            document.getElementById('edit-student-form').reset();
        }

        async function saveEditStudent(event) {
            event.preventDefault();

            const id = document.getElementById('edit-student-doc-id').value;
            const studentId = document.getElementById('edit-student-id').value.trim();

            // Check if student ID already exists (excluding current student)
            const existingStudent = students.find(s => s.studentId === studentId && s.id !== id);
            if (existingStudent) {
                showAlert('students-alert', '‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß!', 'error');
                return;
            }

            const updatedStudent = {
                studentId: studentId,
                studentName: document.getElementById('edit-student-name').value.trim(),
                department: document.getElementById('edit-student-department').value
            };

            try {
                await db.collection('students').doc(id).update(updatedStudent);
                closeEditStudentModal();
                showAlert('students-alert', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error updating student:', error);
                showAlert('students-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤!', 'error');
            }
        }

        // Delete Student
        async function deleteStudent(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    await db.collection('students').doc(id).delete();
                    showAlert('students-alert', '‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } catch (error) {
                    console.error('Error deleting student:', error);
                    showAlert('students-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤!', 'error');
                }
            }
        }

        // ==================== BORROW/RETURN MANAGEMENT ====================


        // ==================== FUNCTION: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå ====================
        function loadBorrowsRealtime() {
            borrowsUnsubscribe = db.collection('borrows').orderBy('borrowDate', 'desc').onSnapshot((snapshot) => {
                borrows = [];
                snapshot.forEach((doc) => {
                    borrows.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                filteredBorrows = [...borrows];
                renderBorrowHistory();
                updateBookSelectOptions();

                // ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°
                if (currentStudent && document.getElementById('student-borrowed-books-section').classList.contains('active')) {
                    loadStudentBorrowedBooks();
                }
            });
        }

        // Update Book Select Options
        function updateBookSelectOptions() {
            const select = document.getElementById('borrow-book-select');
            if (!select) return;

            const availableBooks = books.filter(book => {
                const available = book.quantity - (book.borrowed || 0);
                return available > 0;
            });

            select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ --</option>';
            availableBooks.forEach(book => {
                const available = book.quantity - (book.borrowed || 0);
                select.innerHTML += `<option value="${book.id}">${book.title} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${available})</option>`;
            });
        }

        // Verify Student ID
        document.getElementById('borrow-student-id')?.addEventListener('blur', async function () {
            const studentId = this.value.trim();
            if (!studentId) {
                document.getElementById('student-info').style.display = 'none';
                return;
            }

            const student = students.find(s => s.studentId === studentId);
            if (student) {
                document.getElementById('student-name-display').textContent = student.studentName;
                document.getElementById('student-info').style.display = 'block';
            } else {
                document.getElementById('student-info').style.display = 'none';
                showAlert('borrow-alert', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö!', 'error');
            }
        });

        // Add Book to Borrow List
        function addBookToBorrowList() {
            const select = document.getElementById('borrow-book-select');
            const quantityInput = document.getElementById('borrow-quantity');
            const bookId = select.value;
            const quantity = parseInt(quantityInput.value) || 1;

            if (!bookId) {
                showAlert('borrow-alert', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠!', 'error');
                return;
            }

            if (quantity < 1) {
                showAlert('borrow-alert', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0!', 'error');
                return;
            }

            const book = books.find(b => b.id === bookId);
            if (!book) return;

            const available = book.quantity - (book.borrowed || 0);

            // Check if quantity exceeds available
            if (quantity > available) {
                showAlert('borrow-alert', `‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${available} ‡πÄ‡∏•‡πà‡∏°!`, 'error');
                return;
            }

            // Calculate total books to borrow
            const currentTotal = selectedBooksForBorrow.reduce((sum, item) => sum + item.borrowQuantity, 0);
            const newTotal = currentTotal + quantity;

            // Check if total exceeds 5 books
            if (newTotal > 5) {
                showAlert('borrow-alert', `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡πÄ‡∏•‡πà‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á! (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ ${currentTotal} ‡πÄ‡∏•‡πà‡∏°)`, 'error');
                return;
            }

            // Check if book already in list
            const existingBook = selectedBooksForBorrow.find(b => b.id === bookId);
            if (existingBook) {
                // Update quantity
                const updatedQuantity = existingBook.borrowQuantity + quantity;
                if (updatedQuantity > available) {
                    showAlert('borrow-alert', `‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${available} ‡πÄ‡∏•‡πà‡∏°!`, 'error');
                    return;
                }
                if (currentTotal - existingBook.borrowQuantity + updatedQuantity > 5) {
                    showAlert('borrow-alert', `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡πÄ‡∏•‡πà‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á!`, 'error');
                    return;
                }
                existingBook.borrowQuantity = updatedQuantity;
            } else {
                selectedBooksForBorrow.push({
                    ...book,
                    borrowQuantity: quantity
                });
            }

            renderSelectedBooks();
            select.value = '';
            quantityInput.value = 1;
        }

        // Render Selected Books
        function renderSelectedBooks() {
            const container = document.getElementById('selected-books-list');

            if (selectedBooksForBorrow.length === 0) {
                container.innerHTML = '';
                return;
            }

            const totalBooks = selectedBooksForBorrow.reduce((sum, item) => sum + item.borrowQuantity, 0);

            container.innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 10px;">
                    <strong>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (${totalBooks}/5 ‡πÄ‡∏•‡πà‡∏°):</strong>
                    <div style="margin-top: 10px;">
                        ${selectedBooksForBorrow.map((book, index) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px;">
                                <div style="flex: 1;">
                                    <strong>${index + 1}. ${book.title}</strong>
                                    <div style="color: #666; font-size: 0.9em; margin-top: 5px;">
                                        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${book.borrowQuantity} ‡πÄ‡∏•‡πà‡∏°
                                    </div>
                                </div>
                                <button type="button" class="btn btn-danger" onclick="removeBookFromBorrowList(${index})" style="padding: 5px 15px;">‡∏•‡∏ö</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Remove Book from Borrow List
        function removeBookFromBorrowList(index) {
            selectedBooksForBorrow.splice(index, 1);
            renderSelectedBooks();
        }

        // Borrow Books
        async function borrowBooks(event) {
            event.preventDefault();

            const studentId = document.getElementById('borrow-student-id').value.trim();

            // Validate student
            const student = students.find(s => s.studentId === studentId);
            if (!student) {
                showAlert('borrow-alert', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö!', 'error');
                return;
            }

            // Validate books selected
            if (selectedBooksForBorrow.length === 0) {
                showAlert('borrow-alert', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°!', 'error');
                return;
            }

            try {
                const borrowDate = new Date();
                const returnDate = new Date();
                returnDate.setDate(returnDate.getDate() + 7);

                let totalBorrowed = 0;

                // Create borrow records
                for (const book of selectedBooksForBorrow) {
                    const quantity = book.borrowQuantity || 1;

                    const borrowRecord = {
                        studentId: student.studentId,
                        studentName: student.studentName,
                        bookId: book.id,
                        bookTitle: book.title,
                        quantity: quantity,
                        borrowDate: borrowDate.toISOString(),
                        returnDate: returnDate.toISOString(),
                        status: '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('borrows').add(borrowRecord);

                    // Update book borrowed count
                    const newBorrowed = (book.borrowed || 0) + quantity;
                    await db.collection('books').doc(book.id).update({
                        borrowed: newBorrowed
                    });

                    totalBorrowed += quantity;
                }

                // Reset form
                document.getElementById('borrow-form').reset();
                document.getElementById('student-info').style.display = 'none';
                selectedBooksForBorrow = [];
                renderSelectedBooks();

                showAlert('borrow-alert', `‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${totalBorrowed} ‡πÄ‡∏•‡πà‡∏°!`, 'success');
            } catch (error) {
                console.error('Error borrowing books:', error);
                showAlert('borrow-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠!', 'error');
            }
        }

        // Load Borrowed Books for Return
        function loadBorrowedBooks() {
            const studentId = document.getElementById('return-student-id').value.trim();
            const container = document.getElementById('borrowed-books-list');

            if (!studentId) {
                container.innerHTML = '';
                return;
            }

            const studentBorrows = borrows.filter(b =>
                b.studentId === studentId && b.status === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà'
            );

            if (studentBorrows.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; margin-top: 15px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</p>';
                return;
            }

            container.innerHTML = `
                <div style="margin-top: 15px;">
                    <h4 style="color: #667eea; margin-bottom: 15px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</h4>
                    ${studentBorrows.map(borrow => {
                const returnDate = new Date(borrow.returnDate);
                const today = new Date();
                const isOverdue = today > returnDate;
                const quantity = borrow.quantity || 1;

                return `
                            <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid ${isOverdue ? '#f45c43' : '#667eea'};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>${borrow.bookTitle}</strong>
                                        <div style="color: #666; font-size: 0.9em; margin-top: 5px;">
                                            ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${quantity} ‡πÄ‡∏•‡πà‡∏°<br>
                                            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°: ${new Date(borrow.borrowDate).toLocaleDateString('th-TH')}<br>
                                            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô: ${returnDate.toLocaleDateString('th-TH')}
                                            ${isOverdue ? '<span style="color: #f45c43; font-weight: 600;"> (‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î)</span>' : ''}
                                        </div>
                                    </div>
                                    <button class="btn btn-success" onclick="returnBook('${borrow.id}')" style="padding: 10px 20px;">‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
                                </div>
                            </div>
                        `;
            }).join('')}
                </div>
            `;
        }

        // Edit Borrow Status
        function editBorrowStatus(borrowId) {
            const borrow = borrows.find(b => b.id === borrowId);
            if (!borrow) return;

            document.getElementById('edit-borrow-id').value = borrow.id;
            document.getElementById('edit-borrow-student').textContent = `${borrow.studentName} (${borrow.studentId})`;
            document.getElementById('edit-borrow-book').textContent = borrow.bookTitle;
            document.getElementById('edit-borrow-date').textContent = new Date(borrow.borrowDate).toLocaleDateString('th-TH');
            document.getElementById('edit-borrow-status').value = borrow.status;

            // Set return date
            const returnDate = new Date(borrow.returnDate);
            const dateStr = returnDate.toISOString().split('T')[0];
            document.getElementById('edit-return-date').value = dateStr;

            document.getElementById('edit-borrow-modal').style.display = 'block';
        }

        function closeEditBorrowModal() {
            document.getElementById('edit-borrow-modal').style.display = 'none';
            document.getElementById('edit-borrow-form').reset();
        }

        async function saveEditBorrowStatus(event) {
            event.preventDefault();

            const borrowId = document.getElementById('edit-borrow-id').value;
            const newStatus = document.getElementById('edit-borrow-status').value;
            const newReturnDate = new Date(document.getElementById('edit-return-date').value);

            try {
                const borrow = borrows.find(b => b.id === borrowId);
                if (!borrow) return;

                const oldStatus = borrow.status;
                const quantity = borrow.quantity || 1;

                // Update borrow record
                const updateData = {
                    status: newStatus,
                    returnDate: newReturnDate.toISOString()
                };

                if (newStatus === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß' && oldStatus === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà') {
                    updateData.actualReturnDate = new Date().toISOString();
                }

                await db.collection('borrows').doc(borrowId).update(updateData);

                // Update book borrowed count if status changed
                if (oldStatus !== newStatus) {
                    const book = books.find(b => b.id === borrow.bookId);
                    if (book) {
                        let newBorrowed = book.borrowed || 0;
                        if (newStatus === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß' && oldStatus === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà') {
                            newBorrowed = Math.max(0, newBorrowed - quantity);
                        } else if (newStatus === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà' && oldStatus === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß') {
                            newBorrowed = newBorrowed + quantity;
                        }
                        await db.collection('books').doc(book.id).update({
                            borrowed: newBorrowed
                        });
                    }
                }

                closeEditBorrowModal();
                showAlert('borrow-alert', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error updating borrow status:', error);
                showAlert('borrow-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞!', 'error');
            }
        }

        // Return Book
        async function returnBook(borrowId) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠?')) return;

            try {
                const borrow = borrows.find(b => b.id === borrowId);
                if (!borrow) return;

                const quantity = borrow.quantity || 1;

                // Update borrow status
                await db.collection('borrows').doc(borrowId).update({
                    status: '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                    actualReturnDate: new Date().toISOString()
                });

                // Update book borrowed count
                const book = books.find(b => b.id === borrow.bookId);
                if (book) {
                    const newBorrowed = Math.max(0, (book.borrowed || 0) - quantity);
                    await db.collection('books').doc(book.id).update({
                        borrowed: newBorrowed
                    });
                }

                showAlert('borrow-alert', `‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${quantity} ‡πÄ‡∏•‡πà‡∏°!`, 'success');
                loadBorrowedBooks();
            } catch (error) {
                console.error('Error returning book:', error);
                showAlert('borrow-alert', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠!', 'error');
            }
        }

        // ==================== FUNCTION: ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° ====================
        function loadStudentBorrowedBooks() {
            if (!currentStudent) return;

            const container = document.getElementById('student-borrowed-books-list');
            container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>';

            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà'
            const studentBorrows = borrows.filter(borrow =>
                borrow.studentId === currentStudent.studentId && borrow.status === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà'
            );

            if (studentBorrows.length === 0) {
                container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #999; grid-column: 1 / -1;">
                <h3 style="font-size: 2em; margin-bottom: 10px;">üìö</h3>
                <p style="font-size: 1.2em;">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏î‡πÜ</p>
                <p>‡πÑ‡∏õ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
            </div>
        `;
                return;
            }

            container.innerHTML = studentBorrows.map(borrow => {
                const borrowDate = new Date(borrow.borrowDate);
                const returnDate = new Date(borrow.returnDate);
                const today = new Date();
                const daysLeft = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));
                const isOverdue = daysLeft < 0;
                const quantity = borrow.quantity || 1;

                return `
            <div class="book-card">
                <div class="book-title">${borrow.bookTitle}</div>
                <div class="book-info">
                    <div class="book-info-item">
                        <strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</strong> ${borrowDate.toLocaleDateString('th-TH')}
                    </div>
                    <div class="book-info-item">
                        <strong>üìÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</strong> ${returnDate.toLocaleDateString('th-TH')}
                    </div>
                    <div class="book-info-item">
                        <strong>‚è±Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å:</strong> 
                        <span style="color: ${isOverdue ? '#f45c43' : (daysLeft <= 3 ? '#ff9800' : '#38ef7d')}; font-weight: 600;">
                            ${isOverdue ? `‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î ${Math.abs(daysLeft)} ‡∏ß‡∏±‡∏ô` : `${daysLeft} ‡∏ß‡∏±‡∏ô`}
                        </span>
                    </div>
                    <div class="book-info-item">
                        <strong>üìö ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</strong> ${quantity} ‡πÄ‡∏•‡πà‡∏°
                    </div>
                </div>
                ${isOverdue ? `
                    <div style="margin-top: 15px; padding: 10px; background: #f8d7da; border-radius: 8px; color: #721c24;">
                        <strong>‚ö†Ô∏è ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô!</strong> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                    </div>
                ` : ''}
            </div>
        `;
            }).join('');
        }



        // Render Borrow History
        function renderBorrowHistory() {
            const tbody = document.getElementById('borrow-history-table');

            if (filteredBorrows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</td></tr>';
                return;
            }

            tbody.innerHTML = filteredBorrows.map(borrow => {
                const borrowDate = new Date(borrow.borrowDate);
                const returnDate = new Date(borrow.returnDate);
                const today = new Date();
                const quantity = borrow.quantity || 1;

                let status = borrow.status;
                let statusColor = '#667eea';

                if (status === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà' && today > returnDate) {
                    status = '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î';
                    statusColor = '#f45c43';
                } else if (status === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß') {
                    statusColor = '#38ef7d';
                } else if (status === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà') {
                    statusColor = '#667eea';
                }

                return `
                    <tr>
                        <td>${borrow.studentId}</td>
                        <td>${borrow.studentName}</td>
                        <td>${borrow.bookTitle} <span style="color: #667eea; font-weight: 600;">(${quantity} ‡πÄ‡∏•‡πà‡∏°)</span></td>
                        <td>${borrowDate.toLocaleDateString('th-TH')}</td>
                        <td>${returnDate.toLocaleDateString('th-TH')}</td>
                        <td><span style="padding: 6px 12px; border-radius: 20px; background: ${statusColor}; color: white; font-size: 0.9em; font-weight: 600;">${status}</span></td>
                        <td>
                            ${borrow.status === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà' ?
                        `<button class="btn btn-success" onclick="returnBook('${borrow.id}')" style="padding: 8px 16px; margin-right: 5px;">‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
                                 <button class="btn btn-warning" onclick="editBorrowStatus('${borrow.id}')" style="padding: 8px 16px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>` :
                        '<span style="color: #999;">-</span>'
                    }
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Filter Borrow History
        function filterBorrowHistory() {
            const statusFilter = document.getElementById('filter-borrow-status').value;

            if (!statusFilter) {
                filteredBorrows = [...borrows];
            } else {
                filteredBorrows = borrows.filter(borrow => {
                    const returnDate = new Date(borrow.returnDate);
                    const today = new Date();

                    if (statusFilter === '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î') {
                        return borrow.status === '‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà' && today > returnDate;
                    }
                    return borrow.status === statusFilter;
                });
            }

            renderBorrowHistory();
        }

        // ==================== STUDENT BOOK RECOMMENDATION ====================

        // Department to Category Mapping
        const departmentCategoryMap = {
            '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå': ['‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', 'ai', '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', 'software', 'programming', '‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏£‡∏∞‡∏î‡∏¥‡∏©‡∏ê‡πå'],
            '‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå': ['‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå', '‡∏ß‡∏á‡∏à‡∏£', '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°', 'electronics'],
            '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤': ['‡πÑ‡∏ü‡∏ü‡πâ‡∏≤', '‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°', 'electrical', 'energy'],
            '‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå': ['‡∏¢‡∏ô‡∏ï‡πå', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå', '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå', '‡∏ä‡πà‡∏≤‡∏á', 'automotive', 'mechanical'],
            '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á': ['‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á', '‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°', '‡πÇ‡∏¢‡∏ò‡∏≤', '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°', 'construction', 'civil'],
            '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ': ['‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', 'accounting', 'finance', '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
            '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î': ['‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', '‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤', 'marketing', 'business', '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢'],
            '‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°': ['‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°', '‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', '‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', 'hospitality', 'tourism', '‡∏≠‡∏≤‡∏´‡∏≤‡∏£'],
            '‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß': ['‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß', '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°', '‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', 'tourism', 'hospitality', 'travel'],
            '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à': ['‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', 'it', 'business', 'information technology'],


        };

        // Load Recommended Books based on Department
        function loadRecommendedBooks(department) {
            const container = document.getElementById('recommended-books-grid');

            if (!department || !departmentCategoryMap[department]) {
                container.innerHTML = '<p style="text-align: center; color: #999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            const keywords = departmentCategoryMap[department];
            const recommendedBooks = [];

            books.forEach(book => {
                let score = 0;
                const searchText = `${book.title} ${book.author} ${book.category} ${book.abstract || ''}`.toLowerCase();

                keywords.forEach(keyword => {
                    if (searchText.includes(keyword.toLowerCase())) {
                        if (book.category.toLowerCase().includes(keyword.toLowerCase())) score += 5;
                        if (book.title.toLowerCase().includes(keyword.toLowerCase())) score += 3;
                        if (book.abstract && book.abstract.toLowerCase().includes(keyword.toLowerCase())) score += 1;
                    }
                });

                if (score > 0) {
                    recommendedBooks.push({ ...book, score });
                }
            });

            recommendedBooks.sort((a, b) => b.score - a.score);
            const topRecommended = recommendedBooks.slice(0, 6);

            if (topRecommended.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            container.innerHTML = topRecommended.map(book => {
                const available = book.quantity - (book.borrowed || 0);
                const statusClass = available > 0 ? 'status-available' : 'status-unavailable';
                const statusText = available > 0 ? `‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° (${available} ‡πÄ‡∏•‡πà‡∏°)` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°';

                return `
                    <div class="news-card">
                        <div class="news-content">
                            <div class="news-title" style="color: #667eea;">${book.title}</div>
                            <div style="color: #666; margin: 10px 0;">
                                <strong>üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á:</strong> ${book.author}<br>
                                <strong>üìö ‡∏´‡∏°‡∏ß‡∏î:</strong> ${book.category}<br>
                                <strong>üî¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å:</strong> ${book.callNumber || '-'}
                            </div>
                            <div style="margin-top: 10px;">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            ${book.abstract ? `<div class="news-text" style="margin-top: 10px;">${book.abstract.substring(0, 100)}...</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load All Books for Student
        let allStudentBooks = [];
        let filteredStudentBooks = [];

        function loadAllBooksForStudent() {
            allStudentBooks = [...books];
            filteredStudentBooks = [...books];
            renderAllBooksForStudent();
        }

        function filterStudentBooks() {
            const searchTerm = document.getElementById('student-search-books').value.toLowerCase();

            if (!searchTerm) {
                filteredStudentBooks = [...allStudentBooks];
            } else {
                filteredStudentBooks = allStudentBooks.filter(book => {
                    return book.title.toLowerCase().includes(searchTerm) ||
                        book.author.toLowerCase().includes(searchTerm) ||
                        book.category.toLowerCase().includes(searchTerm) ||
                        (book.callNumber && book.callNumber.toLowerCase().includes(searchTerm));
                });
            }

            renderAllBooksForStudent();
        }

        function sortStudentBooks() {
            const sortBy = document.getElementById('student-sort-books').value;

            filteredStudentBooks.sort((a, b) => {
                switch (sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title, 'th');
                    case 'category':
                        return a.category.localeCompare(b.category, 'th');
                    case 'author':
                        return a.author.localeCompare(b.author, 'th');
                    case 'available':
                        const availableA = a.quantity - (a.borrowed || 0);
                        const availableB = b.quantity - (b.borrowed || 0);
                        return availableB - availableA;
                    default:
                        return 0;
                }
            });

            renderAllBooksForStudent();
        }

        function renderAllBooksForStudent() {
            const container = document.getElementById('all-books-grid');

            if (filteredStudentBooks.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</p>';
                return;
            }

            container.innerHTML = filteredStudentBooks.map(book => {
                const available = book.quantity - (book.borrowed || 0);
                const statusClass = available > 0 ? 'status-available' : 'status-unavailable';
                const statusText = available > 0 ? `‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° (${available} ‡πÄ‡∏•‡πà‡∏°)` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°';

                return `
                    <div class="news-card">
                        <div class="news-content">
                            <div class="news-title" style="color: #667eea;">${book.title}</div>
                            <div style="color: #666; margin: 10px 0;">
                                <strong>üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á:</strong> ${book.author}<br>
                                <strong>üìö ‡∏´‡∏°‡∏ß‡∏î:</strong> ${book.category}<br>
                                <strong>üî¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏Å:</strong> ${book.callNumber || '-'}
                            </div>
                            <div style="margin-top: 10px;">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            ${book.abstract ? `<div class="news-text" style="margin-top: 10px;">${book.abstract.substring(0, 100)}...</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render Student News with Slider
        function renderStudentNews() {
            const track = document.getElementById('student-news-slider-track');
            const controls = document.getElementById('student-news-slider-controls');

            if (news.length === 0) {
                track.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</p>';
                controls.style.display = 'none';
                return;
            }

            const isMobile = window.innerWidth <= 768;
            const itemsPerSlide = isMobile ? 1 : 3;

            // Create slides
            const slides = [];
            for (let i = 0; i < news.length; i += itemsPerSlide) {
                const slideItems = news.slice(i, i + itemsPerSlide);
                slides.push(slideItems);
            }

            // Show controls only if more than one slide
            if (slides.length > 1) {
                controls.style.display = 'flex';
            } else {
                controls.style.display = 'none';
            }

            // Render slides
            track.innerHTML = slides.map((slideItems, slideIndex) => `
                <div class="news-slide">
                    ${slideItems.map(item => `
                        <div class="news-card">
                            ${item.imageUrl ? `<img src="${item.imageUrl}" alt="${item.title}" class="news-image">` : ''}
                            <div class="news-content">
                                <div class="news-title">${item.title}</div>
                                <div class="news-text">${item.content}</div>
                                <div class="news-date">${item.date || new Date().toLocaleDateString('th-TH')}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');

            // Render dots
            const dotsContainer = document.getElementById('student-news-slider-dots');
            dotsContainer.innerHTML = slides.map((_, index) =>
                `<div class="slider-dot ${index === 0 ? 'active' : ''}" onclick="studentNewsSliderGoTo(${index})"></div>`
            ).join('');

            // Reset slider
            studentNewsSliderIndex = 0;
            updateStudentNewsSlider();

            // Start auto-slide
            startStudentNewsAutoSlide();
        }

        function updateStudentNewsSlider() {
            const track = document.getElementById('student-news-slider-track');
            const dots = document.querySelectorAll('#student-news-slider-dots .slider-dot');
            const slides = track.querySelectorAll('.news-slide');

            track.style.transform = `translateX(-${studentNewsSliderIndex * 100}%)`;

            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === studentNewsSliderIndex);
            });

            // Update button states
            document.getElementById('student-news-prev-btn').disabled = studentNewsSliderIndex === 0;
            document.getElementById('student-news-next-btn').disabled = studentNewsSliderIndex === slides.length - 1;
        }

        function studentNewsSliderNext() {
            const track = document.getElementById('student-news-slider-track');
            const slides = track.querySelectorAll('.news-slide');

            if (studentNewsSliderIndex < slides.length - 1) {
                studentNewsSliderIndex++;
                updateStudentNewsSlider();
                resetStudentNewsAutoSlide();
            }
        }

        function studentNewsSliderPrev() {
            if (studentNewsSliderIndex > 0) {
                studentNewsSliderIndex--;
                updateStudentNewsSlider();
                resetStudentNewsAutoSlide();
            }
        }

        function studentNewsSliderGoTo(index) {
            studentNewsSliderIndex = index;
            updateStudentNewsSlider();
            resetStudentNewsAutoSlide();
        }

        function startStudentNewsAutoSlide() {
            stopStudentNewsAutoSlide();
            studentNewsSliderInterval = setInterval(() => {
                const track = document.getElementById('student-news-slider-track');
                const slides = track.querySelectorAll('.news-slide');

                if (slides.length > 1) {
                    studentNewsSliderIndex = (studentNewsSliderIndex + 1) % slides.length;
                    updateStudentNewsSlider();
                }
            }, 5000); // Auto-slide every 5 seconds
        }

        function stopStudentNewsAutoSlide() {
            if (studentNewsSliderInterval) {
                clearInterval(studentNewsSliderInterval);
                studentNewsSliderInterval = null;
            }
        }

        function resetStudentNewsAutoSlide() {
            startStudentNewsAutoSlide();
        }

        // ==================== FUNCTION: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏µ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ====================
        function updateStudentHomeStats() {
            // Top 5 Books
            const topBooks = [...books]
                .filter(book => book.borrowed > 0)
                .sort((a, b) => b.borrowed - a.borrowed)
                .slice(0, 5);

            const topBooksContainer = document.getElementById('student-home-top-books');
            if (topBooks.length === 0) {
                topBooksContainer.innerHTML = '<p style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p>';
            } else {
                topBooksContainer.innerHTML = topBooks.map((book, index) => {
                    let rankClass = 'other';
                    if (index === 0) rankClass = 'gold';
                    else if (index === 1) rankClass = 'silver';
                    else if (index === 2) rankClass = 'bronze';

                    return `
                <div class="top-item">
                    <div class="top-rank ${rankClass}">${index + 1}</div>
                    <div class="top-info">
                        <strong>${book.title}</strong>
                        <div style="color: #666; font-size: 0.9em;">${book.author}</div>
                    </div>
                    <div class="top-count">${book.borrowed} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                </div>
            `;
                }).join('');
            }
            // Top 5 Categories
            const categoryStats = {};
            books.forEach(book => {
                if (book.borrowed > 0) {
                    if (!categoryStats[book.category]) {
                        categoryStats[book.category] = 0;
                    }
                    categoryStats[book.category] += book.borrowed;
                }
            });

            const topCategories = Object.entries(categoryStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const topCategoriesContainer = document.getElementById('student-home-top-categories');
            if (topCategories.length === 0) {
                topCategoriesContainer.innerHTML = '<p style="text-align: center; color: #999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p>';
            } else {
                topCategoriesContainer.innerHTML = topCategories.map(([category, count], index) => {
                    let rankClass = 'other';
                    if (index === 0) rankClass = 'gold';
                    else if (index === 1) rankClass = 'silver';
                    else if (index === 2) rankClass = 'bronze';

                    return `
                <div class="top-item">
                    <div class="top-rank ${rankClass}">${index + 1}</div>
                    <div class="top-info">
                        <strong>${category}</strong>
                    </div>
                    <div class="top-count">${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                </div>
            `;
                }).join('');
            }
        }

    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'99c5f867f2eea62b',t:'MTc2Mjc4MjExNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>


</html>